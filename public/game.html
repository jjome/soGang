<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Í≤åÏûÑ ÌîåÎ†àÏù¥ - ÏÜåÍ∞ï</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        

        
        /* Î™®Î∞îÏùº Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .game-info {
                flex-direction: column;
            text-align: center;
                gap: 15px;
                padding: 15px;
        }
        
            .game-phase, .round-info {
            font-size: 0.9rem;
        }
        }
        
        .community-cards {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
            min-height: 120px;
        }
        .card {
            width: 80px;
            height: 120px;
            background: white;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border: 2px solid #ddd;
            position: relative;
        }
        .card.hidden {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: transparent;
        }
        .card.red {
            color: #e74c3c;
        }
        .card.black {
            color: #2c3e50;
        }
        .players-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .player {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }
        
        .player.has-cards {
            border-color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
        }
        
        .player.no-cards {
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.1);
            animation: waitingPulse 2s ease-in-out infinite;
        }
        
        @keyframes waitingPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .card-status-icon {
            margin-left: 8px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .card-status-icon.ready {
            background: #27ae60;
            color: white;
        }
        
        .card-status-icon.waiting {
            background: #f39c12;
            color: white;
            animation: iconPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes iconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes chipShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* ÏÉàÎ°úÏö¥ Î†àÏù¥ÏïÑÏõÉ Ïä§ÌÉÄÏùº */
        .players-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
            gap: 20px;
        }

        .other-players {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 60vh;
            min-height: 100px;
            overflow-y: auto;
            padding: 15px;
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .other-player {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 80px;
        }

        .other-player.has-cards {
            border-color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
        }

        .other-player.no-cards {
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.1);
            animation: waitingPulse 2s ease-in-out infinite;
        }

        .other-player-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .other-player-name {
            color: #fff;
            font-size: 18px;
            font-weight: 600;
        }

        .other-player-cards {
            display: flex;
            gap: 5px;
        }

        .other-player-card {
            width: 30px;
            height: 42px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 6px;
            border: 1px solid #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .other-player-chips {
            display: flex;
            gap: 8px;
        }

        .other-player-chip {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            border: 2px solid #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #333;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .my-player-area {
            background: rgba(255,255,255,0.15);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(15px);
            border: 3px solid rgba(255,255,255,0.3);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            height: 250px;
            position: relative;
            flex-shrink: 0;
        }

        .my-player-area.has-cards {
            border-color: #27ae60;
            background: rgba(39, 174, 96, 0.15);
            box-shadow: 0 8px 32px rgba(39, 174, 96, 0.2);
        }

        .my-player-area.no-cards {
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.15);
            animation: waitingPulse 2s ease-in-out infinite;
        }

        .my-player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .my-player-name {
            color: #fff;
            font-size: 24px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .my-player-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .my-cards {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .my-card {
            width: 80px;
            height: 112px;
            background: linear-gradient(135deg, #fff, #f8f9fa);
            border-radius: 12px;
            border: 2px solid #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transform: perspective(300px) rotateY(0deg);
            transition: all 0.3s ease;
        }

        .my-card:hover {
            transform: perspective(300px) rotateY(-5deg) translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        .my-card-top {
            font-size: 16px;
            font-weight: bold;
            line-height: 1;
        }

        .my-card-suit {
            font-size: 32px;
            line-height: 1;
        }

        .my-card-bottom {
            font-size: 16px;
            font-weight: bold;
            line-height: 1;
            transform: rotate(180deg);
        }

        .my-card.red {
            color: #e74c3c;
        }

        .my-card.black {
            color: #2c3e50;
        }

        .my-chips {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .my-chip {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            border: 3px solid #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #333;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .my-chip:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        .my-chip.collected {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            cursor: default;
            opacity: 0.6;
        }

        .game-center {
            text-align: center;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0;
            min-height: 300px;
        }

        .game-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .room-info-compact {
            color: #bdc3c7;
            font-size: 14px;
        }

        .my-content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .my-controls-area {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex !important;
            flex-direction: column !important;
            gap: 15px;
            justify-content: flex-start;
            align-items: stretch;
            min-width: 120px;
            width: 120px;
            z-index: 100;
        }

        .game-controls {
            display: flex !important;
            flex-direction: column !important;
            gap: 15px;
            width: 100%;
            position: relative !important;
            z-index: 200;
        }

        .game-controls .btn {
            width: 100% !important;
            margin: 0 !important;
            position: relative !important;
            display: block !important;
            z-index: 201;
            background: rgba(255,255,255,0.1) !important;
            backdrop-filter: blur(10px) !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;
        }

        /* Í≤åÏûÑ Ïï°ÏÖò Î≤ÑÌäº Ïä§ÌÉÄÏùº */
        #gameActionBtn {
            position: relative !important;
            display: block !important;
            width: 100% !important;
            margin: 0 !important;
            float: none !important;
            clear: both !important;
            z-index: 202 !important;
            background: rgba(255,255,255,0.15) !important;
            transition: all 0.3s ease !important;
        }

        /* Ìå®Ïä§ Î≤ÑÌäº ÏÉÅÌÉúÏùº ÎïåÏùò Ïä§ÌÉÄÏùº */
        #gameActionBtn.pass-mode {
            border-color: #17a2b8 !important;
            color: #17a2b8 !important;
        }

        #gameActionBtn.pass-mode:hover:not(:disabled) {
            border-color: #138496 !important;
            background: rgba(23, 162, 184, 0.2) !important;
            color: #138496 !important;
        }


        .player.current {
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255,215,0,0.5);
        }
        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .player-name {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .player-chips {
            color: #ffd700;
            font-weight: bold;
        }
        .player-cards {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }
        .player-cards .card {
            width: 60px;
            height: 90px;
            font-size: 1rem;
        }
        .player-bet {
            text-align: center;
            color: #ffd700;
            font-weight: bold;
        }
        /* Í∏∞Ï°¥ fixed Ïä§ÌÉÄÏùºÏùÑ Ï£ºÏÑù Ï≤òÎ¶¨
        .game-controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        */
        .controls-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            gap: 15px;
            align-items: center;
        }
        .btn {
            padding: 12px 20px;
            background: transparent;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
            color: #fff;
            backdrop-filter: blur(10px);
        }
        
        .btn:hover {
            border-color: rgba(255,255,255,0.6);
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-primary {
            border-color: #3498db;
            color: #3498db;
        }
        
        .btn-primary:hover:not(:disabled) {
            border-color: #2980b9;
            background: rgba(52, 152, 219, 0.2);
            color: #2980b9;
        }
        .btn-info {
            border-color: #17a2b8;
            color: #17a2b8;
        }
        
        .btn-info:hover:not(:disabled) {
            border-color: #138496;
            background: rgba(23, 162, 184, 0.2);
            color: #138496;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
        }
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }
        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .bet-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .bet-input {
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            width: 100px;
            text-align: center;
        }
        .game-message {
            text-align: center;
            font-size: 1.2rem;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        .winner {
            color: #ffd700;
            font-weight: bold;
        }
        .room-info {
            text-align: center;
            margin-bottom: 20px;
        }
        .room-info h2 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        .room-info p {
            font-size: 1rem;
        }
        .room-info strong {
            font-weight: bold;
        }
        
        /* Ïπ¥ÏßÄÎÖ∏ Ïπ© Ïä§ÌÉÄÏùº */
        .casino-chips-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px 0;
            min-height: 120px;
        }
        
        .chips-stack {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 10px;
            max-width: 400px;
        }
        
        .casino-chip {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 4px solid #fff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            animation: chipGlow 2s ease-in-out infinite alternate;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .casino-chip:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(241, 196, 15, 0.8);
        }
        
        .casino-chip.clicked {
            animation: chipCollect 0.5s ease-out forwards;
        }
        
        .casino-chip.collected {
            animation: none;
            pointer-events: none;
        }
        
        .casino-chip.collected:hover {
            transform: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        /* ÏàòÏßëÌïú Ïπ© ÌëúÏãú Ïä§ÌÉÄÏùº */
        .player-cards-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .collected-chips-icons {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            align-items: center;
        }
        
        .collected-chip-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            border: 2px solid rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: default;
            position: relative;
            animation: chipGlow 2s ease-in-out infinite alternate;
        }
        
        .chip-icon-inner {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }
        
        .chip-number {
            color: #fff;
            font-size: 10px;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        
        .collected-chip-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(255,215,0,0.4);
        }
        
        .casino-chip::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
        }
        
        .casino-chip::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
        }
        
        .chip-stars {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
                align-items: center;
            width: 40px;
            height: 40px;
        }
        
        .chip-star {
            color: #fff;
            font-size: 8px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            animation: starTwinkle 1.5s ease-in-out infinite;
        }
        
        .chip-star:nth-child(odd) {
            animation-delay: 0.5s;
        }
        
        @keyframes chipGlow {
            0% {
                box-shadow: 0 4px 12px rgba(241, 196, 15, 0.4);
            }
            100% {
                box-shadow: 0 4px 20px rgba(241, 196, 15, 0.7);
            }
        }
        
        @keyframes starTwinkle {
            0%, 100% {
                opacity: 0.7;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.2);
            }
        }
        
        @keyframes chipCollect {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.3) translateY(-20px);
                opacity: 0.8;
            }
            100% {
                transform: scale(0) translateY(-50px);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="players-container">
        <!-- ÏÉÅÎã®: Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Îì§ -->
        <div class="other-players" id="otherPlayersList">
            <!-- Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Îì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
        </div>
        
        <!-- Ï§ëÏïô: Í≤åÏûÑ Ï†ïÎ≥¥ Î∞è Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú -->
        <div class="game-center">
        <div class="game-info">
                <div class="game-phase" id="gamePhase">Í≤åÏûÑ Îã®Í≥Ñ: -</div>
                <div class="round-info">ÎùºÏö¥Îìú: <span id="currentRound">-</span>/<span id="maxRounds">5</span></div>
                <div class="room-info-compact">
                    <span id="roomName"></span> | <span id="playerCount">0</span>/8Î™Ö
            </div>
        </div>
        
            <div class="community-cards" id="communityCards"></div>
            
            <!-- Ïπ¥ÏßÄÎÖ∏ Ïπ© ÏòÅÏó≠ -->
            <div class="casino-chips-container" id="casinoChipsContainer">
                <div class="chips-stack">
                    <!-- Ïπ©Îì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                </div>
        </div>
        
            <div class="game-message" id="gameMessage">Í≤åÏûÑÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§.</div>
        </div>
        
                <!-- ÌïòÎã®: ÎÇ¥ ÌîåÎ†àÏù¥Ïñ¥ ÏòÅÏó≠ -->
        <div class="my-player-area" id="myPlayerArea">
            <div class="my-content-area">
                <div class="my-player-header">
                    <div class="my-player-name" id="myPlayerName">ÎÇ¥ Ï†ïÎ≥¥</div>
                    <div class="my-player-status">
                        <span class="card-status-icon" id="myCardStatus">‚è≥</span>
                    </div>
                </div>
                
                <div class="my-cards" id="myCards">
                    <!-- ÎÇ¥ Ïπ¥ÎìúÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
                
                <div class="my-chips" id="myChips">
                    <!-- ÎÇ¥ Ïπ©Îì§Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
                
                <!-- Ïò§Î•∏Ï™Ω ÏÉÅÎã®Ïóê ÏúÑÏπòÌï† Î≤ÑÌäº -->
                <div class="my-controls-area">
                    <div class="game-controls">
                        <button class="btn btn-primary" id="gameActionBtn" onclick="handleGameAction()">Ïπ¥Îìú Î∞õÍ∏∞</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ÌÉàÏ£º ÌôïÏù∏ Î™®Îã¨ -->
    <div id="leaveModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
        <div style="background:white; color:#222; padding:2rem; border-radius:16px; min-width:300px; text-align:center;">
            <p style="margin-bottom:2rem; font-size:1.2rem;">Ï†ïÎßê ÌÉàÏ£ºÌïòÏãúÍ≤†ÏäµÎãàÍπå?</p>
            <button id="confirmLeaveBtn" class="btn btn-danger" style="margin-right:1rem;">ÎÑ§, ÌÉàÏ£º</button>
            <button id="cancelLeaveBtn" class="btn btn-success">Ï∑®ÏÜå</button>
        </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
    let socket;
    let currentPlayer = null;
    let gameState = {
        players: [],
        currentPlayer: null,
        phase: 'playing',
        roomId: null,
        pot: 0,
        isMyTurn: false,
        communityCards: [],
        collectedChips: []
    };
    let isMyTurn = false;
    let isAdmin = false;
    
    // ÏùºÎ∞ò ÏÇ¨Ïö©ÏûêÏö©ÏúºÎ°ú ÏàòÏ†ïÎêú Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
    async function checkAdminStatus() {
        return false; // ÏùºÎ∞ò ÏÇ¨Ïö©ÏûêÎäî Í¥ÄÎ¶¨ÏûêÍ∞Ä ÏïÑÎãò
    }
    
    function connectSocket() {
        socket = io();
        
        // ÏÜåÏºì Ïó∞Í≤∞ Ïã§Ìå® Ïãú Ïû¨Ïó∞Í≤∞
        socket.on('connect_error', (error) => {
            console.error('ÏÜåÏºì Ïó∞Í≤∞ Ïã§Ìå®:', error);
            setTimeout(() => {
                console.log('ÏÜåÏºì Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ...');
                socket.connect();
            }, 2000);
        });
        
        // ÏÜåÏºì Ïó∞Í≤∞ Ïãú ÏÇ¨Ïö©Ïûê Îì±Î°ù
        socket.on('connect', async () => {
            console.log('ÏÜåÏºì Ïó∞Í≤∞Îê®, socket.id:', socket.id);
            
            // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ ÏãúÎèÑ
            try {
                const response = await fetch('/api/user');
                
                if (response.ok) {
                    const userData = await response.json();
                    
                    if (userData && userData.username) {
                        console.log('ÏÇ¨Ïö©Ïûê Îì±Î°ù ÏãúÎèÑ:', userData.username);
                        
                        if (socket.connected) {
                            socket.emit('registerUser', userData.username);
                        }
                    }
                }
            } catch (error) {
                console.error('ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®:', error);
            }
        });
        
        socket.on('gameState', (state) => {
            updateGameState(state);
        });
        
        // Ïπ© ÏàòÏßë Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
        socket.on('chipCollected', (data) => {
            console.log('Ïπ© ÏàòÏßë Ïù¥Î≤§Ìä∏:', data);
            
            if (gameState) {
                gameState.collectedChips = data.remainingChips || [];
            }
            
            const collectedChips = data.remainingChips || [];
            updateCasinoChips(gameState?.players?.length || 2, collectedChips);
            
            if (gameState && gameState.players) {
                updatePlayers(gameState.players);
            }
            
            updateControls();
            showMessage(`${data.collectedBy}ÎãòÏù¥ Ïπ© ${data.chipIndex + 1}ÏùÑ ÏàòÏßëÌñàÏäµÎãàÎã§!`);
        });
        
        // ÌîåÎûç Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
        socket.on('flopDealt', (data) => {
            console.log('ÌîåÎûç Ïù¥Î≤§Ìä∏:', data);
            
            if (data.gameState) {
                updateGameState(data.gameState);
            }
            
            showMessage(data.message || 'ÌîåÎûçÏù¥ Í≥µÍ∞úÎêòÏóàÏäµÎãàÎã§!');
        });
        
        socket.on('gameMessage', (message) => {
            showMessage(message);
        });
        
        socket.on('gameOver', (result) => {
            showGameOver(result);
        });
        
        socket.on('cardsDealt', (data) => {
            console.log('Í∞úÎ≥Ñ Ïπ¥Îìú Î∂ÑÎ∞∞ ÏôÑÎ£å:', data);
            updateGameState(data.gameState);
            showMessage(data.message || 'Ïπ¥ÎìúÎ•º Î∞õÏïòÏäµÎãàÎã§!');
            
            // Ïπ¥ÎìúÎ•º Î∞õÏïòÏúºÎØÄÎ°ú Î≤ÑÌäºÏùÑ Ìå®Ïä§ Î™®ÎìúÎ°ú Ï†ÑÌôò
            switchToPassMode();
        });
        
        // Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Ïπ¥ÎìúÎ•º Î∞õÏïòÏùÑ Îïå
        socket.on('playerReceivedCards', (data) => {
            console.log('Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥ Ïπ¥Îìú Î∞õÍ∏∞:', data);
            updateGameState(data.gameState);
            showMessage(data.message || `${data.playerName}ÎãòÏù¥ Ïπ¥ÎìúÎ•º Î∞õÏïòÏäµÎãàÎã§!`);
            
            // Î≥∏Ïù∏Ïù¥ ÏïÑÏßÅ Ïπ¥ÎìúÎ•º Î∞õÏßÄ ÏïäÏùÄ Í≤ΩÏö∞ÏóêÎßå ÏßÑÌñâ ÏÉÅÌô© ÌëúÏãú
            const gameActionBtn = document.getElementById('gameActionBtn');
            if (gameActionBtn && data.gameState && gameActionMode === 'deal') {
                const progress = `${data.gameState.playersWithCards}/${data.gameState.totalPlayers}`;
                if (data.gameState.playersWithCards < data.gameState.totalPlayers) {
                    gameActionBtn.textContent = `Ïπ¥Îìú Î∞õÍ∏∞ (${progress})`;
                }
            }
            
            console.log('Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥ Ïπ¥Îìú Î∞õÍ∏∞ Ï≤òÎ¶¨ ÏôÑÎ£å - Î≥∏Ïù∏ Î≤ÑÌäº ÏÉÅÌÉú:', {
                mode: gameActionMode,
                textContent: gameActionBtn?.textContent
            });
        });
        
        // Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Ïπ¥ÎìúÎ•º Î∞õÏùÄ ÌõÑ Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú Í≥µÍ∞ú
        socket.on('communityCardsRevealed', (data) => {
            console.log('Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú Í≥µÍ∞ú Ïù¥Î≤§Ìä∏ ÏàòÏã†:', data);
            console.log('ÏàòÏã†Îêú Í≤åÏûÑ ÏÉÅÌÉúÏùò Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú:', data.gameState?.communityCards);
            console.log('ÏàòÏã†Îêú Î∞© ÏÉÅÌÉúÏùò Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú:', data.room?.communityCards);
            
            updateGameState(data.gameState);
            showMessage(data.message || 'Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥ÎìúÍ∞Ä Í≥µÍ∞úÎêòÏóàÏäµÎãàÎã§!');
            
            // ÌòÑÏû¨ ÎùºÏö¥Îìú Ï¢ÖÎ£å - Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäº Ïà®ÍπÄ
            const dealCardsBtn = document.getElementById('dealCardsBtn');
            if (dealCardsBtn) {
                dealCardsBtn.style.display = 'none'; // Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥ÎìúÍ∞Ä Í≥µÍ∞úÎêòÎ©¥ Ïà®ÍπÄ
            }
            
            // Îã§Ïùå ÎùºÏö¥ÎìúÎ•º ÏúÑÌï¥ Ïπ¥Îìú Î∞õÍ∏∞ ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî (ÌïòÏßÄÎßå Î≤ÑÌäºÏùÄ ÏÉà ÎùºÏö¥Îìú ÏãúÏûë ÏãúÍπåÏßÄ Ïà®ÍπÄ)
            cardsDealRequested = false;
        });
        
        socket.on('disconnect', (reason) => {
            console.log('Í≤åÏûÑ ÏÜåÏºì Ïó∞Í≤∞Ïù¥ ÎÅäÏñ¥Ï°åÏäµÎãàÎã§. Ïù¥Ïú†:', reason);
        });
        
        // ÏûêÎèô ÏÇ¨Ïö©Ïûê Í≤åÏûÑ ÏãúÏûë Ïù¥Î≤§Ìä∏
        socket.on('autoStartUserGame', (data) => {
            console.log('ÏûêÎèô ÏÇ¨Ïö©Ïûê Í≤åÏûÑ ÏãúÏûë:', data);
            showMessage(data.message || 'ÏÉà Í≤åÏûÑÏùÑ ÏãúÏûëÌï©ÎãàÎã§...');
            
            // ÏÇ¨Ïö©Ïûê Í≤åÏûÑ ÏãúÏûë Ìò∏Ï∂ú
            setTimeout(() => {
                socket.emit('startUserGame', { roomId: data.roomId });
            }, 500);
        });
        
        // Î∞© Ïû¨Ï∞∏Ïó¨ ÏÑ±Í≥µ Ïù¥Î≤§Ìä∏
        socket.on('roomRejoinSuccess', (data) => {
            console.log('Î∞© Ïû¨Ï∞∏Ïó¨ ÏÑ±Í≥µ:', data);
            if (data.roomId) {
                console.log('Ïû¨Ï∞∏Ïó¨Ìïú roomIdÎ°ú Í≤åÏûÑ ÏÉÅÌÉú ÏÑ§Ï†ï:', data.roomId);
                // gameStateÏóê roomId ÏÑ§Ï†ï
                if (gameState) {
                    gameState.roomId = data.roomId;
                } else {
                    gameState = { roomId: data.roomId };
                }
                
                // Î∞©Ïóê Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Í∞Ä ÏûàÏúºÎ©¥ Î©ÄÌã∞ÌîåÎ†àÏù¥Ïñ¥ Î™®Îìú
                const playerCount = data.room?.players?.length || 1;
                showMessage(`Î∞©Ïóê Ïû¨Ï∞∏Ïó¨ÌñàÏäµÎãàÎã§. (${playerCount}Î™ÖÏùò ÌîåÎ†àÏù¥Ïñ¥)`);
                
                // Í≤åÏûÑ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                if (data.room) {
                    updateGameState({
                        roomId: data.room.id,
                        players: data.room.players,
                        phase: data.room.phase || 'playing',
                        communityCards: data.room.communityCards || [],
                        currentRound: data.room.currentRound || 1,
                        maxRounds: data.room.maxRounds || 5,
                        pot: data.room.pot || 0
                    });
                }
                
                // ÏÇ¨Ïö©Ïûê Í≤åÏûÑ ÏãúÏûë Ïù¥Î≤§Ìä∏ Î∞úÏÉù
                socket.emit('startUserGame', { roomId: data.roomId });
            }
        });
        
        // Í≤åÏûÑ Î∞© Ï∞æÍ∏∞/ÏÉùÏÑ± ÏôÑÎ£å Ïù¥Î≤§Ìä∏
        socket.on('gameRoomFound', (data) => {
            console.log('Í≤åÏûÑ Î∞© Ï∞æÍ∏∞/ÏÉùÏÑ± ÏôÑÎ£å:', data);
            if (data.roomId) {
                console.log('Ï∞æÍ±∞ÎÇò ÏÉùÏÑ±Îêú roomIdÎ°ú Í≤åÏûÑ ÏÉÅÌÉú ÏÑ§Ï†ï:', data.roomId);
                // gameStateÏóê roomId ÏÑ§Ï†ï
                if (gameState) {
                    gameState.roomId = data.roomId;
                } else {
                    gameState = { roomId: data.roomId };
                }
                
                // Î∞©Ïóê Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Í∞Ä ÏûàÏúºÎ©¥ Î©ÄÌã∞ÌîåÎ†àÏù¥Ïñ¥ Î™®Îìú
                const playerCount = data.room?.players?.length || 1;
                if (playerCount > 1) {
                    showMessage(`${playerCount}Î™ÖÏùò ÌîåÎ†àÏù¥Ïñ¥ÏôÄ Ìï®Íªò Í≤åÏûÑÏùÑ ÏãúÏûëÌï©ÎãàÎã§!`);
                } else {
                    showMessage('Í≤åÏûÑ Î∞©Ïù¥ Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§. Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî.');
                }
                
                // ÏÇ¨Ïö©Ïûê Í≤åÏûÑ ÏãúÏûë Ïù¥Î≤§Ìä∏ Î∞úÏÉù
                socket.emit('startUserGame', { roomId: data.roomId });
            }
        });
        
        // ÌîåÎ†àÏù¥Ïñ¥ Ï∞∏Ïó¨ Ïù¥Î≤§Ìä∏
        socket.on('playerJoined', (data) => {
            console.log('ÏÉà ÌîåÎ†àÏù¥Ïñ¥ Ï∞∏Ïó¨:', data);
            showMessage(`${data.player.username}ÎãòÏù¥ Í≤åÏûÑÏóê Ï∞∏Ïó¨ÌñàÏäµÎãàÎã§!`);
            if (data.room) {
                updateGameState({
                    roomId: data.room.id,
                    players: data.room.players,
                    phase: data.room.phase || 'playing',
                    communityCards: data.room.communityCards || [],
                    currentRound: data.room.currentRound || 1,
                    maxRounds: data.room.maxRounds || 5,
                    pot: data.room.pot || 0
                });
            }
        });
        
        // Í¥ÄÎ¶¨Ïûê Î∞© ÏÉùÏÑ± ÏôÑÎ£å Ïù¥Î≤§Ìä∏ (Í¥ÄÎ¶¨Ïûê Ï†ÑÏö©)
        socket.on('adminRoomCreated', (data) => {
            console.log('Í¥ÄÎ¶¨Ïûê Î∞© ÏÉùÏÑ± ÏôÑÎ£å:', data);
            if (data.roomId) {
                console.log('ÏÉùÏÑ±Îêú roomIdÎ°ú Í≤åÏûÑ ÏÉÅÌÉú ÏÑ§Ï†ï:', data.roomId);
                // gameStateÏóê roomId ÏÑ§Ï†ï
                if (gameState) {
                    gameState.roomId = data.roomId;
                }
                showMessage('Í¥ÄÎ¶¨Ïûê Î∞©Ïù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§. Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî.');
            }
        });
        
        // Í≤åÏûÑ ÏãúÏûë Ïù¥Î≤§Ìä∏
        socket.on('gameStarted', (data) => {
            console.log('Í≤åÏûÑ ÏãúÏûë:', data);
            
            // roomId ÏÑ§Ï†ï (Ïö∞ÏÑ†ÏàúÏúÑ: data.roomId > data.gameState.roomId)
            const roomId = data.roomId || data.gameState?.roomId;
            if (roomId) {
                console.log('Í≤åÏûÑ ÏãúÏûë Ïãú roomId ÏÑ§Ï†ï:', roomId);
                if (gameState) {
                    gameState.roomId = roomId;
                } else {
                    gameState = { roomId: roomId };
                }
            } else {
                console.error('Í≤åÏûÑ ÏãúÏûë Ïù¥Î≤§Ìä∏Ïóê roomIdÍ∞Ä ÏóÜÏäµÎãàÎã§!', data);
            }
            
            // collectedChips Ï¥àÍ∏∞Ìôî
            if (data.gameState) {
                data.gameState.collectedChips = [];
            }
            
            // Ïπ¥Îìú Î∞õÍ∏∞ ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            cardsDealRequested = false;
            
            // Î≤ÑÌäºÏùÑ Ïπ¥Îìú Î∞õÍ∏∞ Î™®ÎìúÎ°ú Î¶¨ÏÖã
            resetToDealMode();
            
            updateGameState(data.gameState);
            
            // Î∞© Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            if (data.room) {
                updateRoomInfo(data.room);
            }
            
            // ÌîåÎ†àÏù¥Ïñ¥ Ïàò Í∞ïÏ†ú ÏóÖÎç∞Ïù¥Ìä∏
            const playerCountEl = document.getElementById('playerCount');
            if (playerCountEl) {
                playerCountEl.textContent = '1';
            }
            
            // Í≤åÏûÑ ÏÉÅÌÉúÎ•º playingÏúºÎ°ú ÏÑ§Ï†ï
            if (data.gameState) {
                data.gameState.phase = 'playing';
            }
            
            showMessage('Í≤åÏûÑÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§! Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Í∞Ä ÎèôÏãúÏóê Ïπ¥ÎìúÎ•º Î∞õÏùÑ Ïàò ÏûàÏäµÎãàÎã§.');
            
            // Í≤åÏûÑ ÏãúÏûë ÌõÑ Ï¶âÏãú Î™®Îì† ÏÇ¨Ïö©ÏûêÏùò Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäº ÌôúÏÑ±Ìôî
            setTimeout(() => {
                updateControls();
                // Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäº ÏÉÅÌÉú Î≥µÏõê (Î™®Îì† ÏÇ¨Ïö©Ïûê ÎèôÏãú ÌôúÏÑ±Ìôî)
                const dealCardsBtn = document.getElementById('dealCardsBtn');
                if (dealCardsBtn) {
                    dealCardsBtn.disabled = false;
                    dealCardsBtn.textContent = 'Ïπ¥Îìú Î∞õÍ∏∞';
                    dealCardsBtn.style.display = 'inline-block';
                }
            }, 100);
        });
        
        // ÏÇ¨Ïö©Ïûê Îì±Î°ù ÏÑ±Í≥µ Ïù¥Î≤§Ìä∏ (ÏùºÎ∞ò ÏÇ¨Ïö©ÏûêÏö©ÏúºÎ°ú ÏàòÏ†ï)
        socket.on('registerUserSuccess', (data) => {
            console.log('ÏÇ¨Ïö©Ïûê Îì±Î°ù ÏÑ±Í≥µ', data);
            
            // ÏÇ¨Ïö©ÏûêÎ™ÖÏùÑ Ïó¨Îü¨ ÏúÑÏπòÏóê ÏïàÏ†ÑÌïòÍ≤å Ï†ÄÏû•
            if (data && data.username) {
                localStorage.setItem('username', data.username);
                sessionStorage.setItem('username', data.username);
                window.currentUser = data.username;
                console.log('ÏÇ¨Ïö©ÏûêÎ™Ö Ï†ÄÏû• ÏôÑÎ£å:', data.username);
            } else {
                // URLÏóêÏÑú ÏÇ¨Ïö©ÏûêÎ™Ö Ï∂îÏ∂ú (fallback)
                const urlParams = new URLSearchParams(window.location.search);
                const urlUsername = urlParams.get('username');
                if (urlUsername) {
                    localStorage.setItem('username', urlUsername);
                    sessionStorage.setItem('username', urlUsername);
                    window.currentUser = urlUsername;
                    console.log('URLÏóêÏÑú ÏÇ¨Ïö©ÏûêÎ™Ö Ï∂îÏ∂ú:', urlUsername);
                }
            }
            
            // URLÏóêÏÑú roomId ÌôïÏù∏
            const urlParams = new URLSearchParams(window.location.search);
            const urlRoomId = urlParams.get('roomId');
            
            if (urlRoomId) {
                console.log('URLÏóêÏÑú roomId Î∞úÍ≤¨, Í∏∞Ï°¥ Î∞©ÏúºÎ°ú Î≥µÍ∑Ä ÏãúÎèÑ:', urlRoomId);
                // gameStateÏóê roomId ÏÑ§Ï†ï
                if (gameState) {
                    gameState.roomId = urlRoomId;
                } else {
                    gameState = { roomId: urlRoomId };
                }
                
                // Í∏∞Ï°¥ Î∞©ÏúºÎ°ú Î≥µÍ∑Ä ÏöîÏ≤≠
                socket.emit('rejoinRoom', { roomId: urlRoomId });
            } else {
                console.log('URLÏóê roomId ÏóÜÏùå, ÏÉà Í≤åÏûÑ Ï∞æÍ∏∞/ÏÉùÏÑ±');
                // ÏÉà Í≤åÏûÑ Ï∞æÍ∏∞/ÏÉùÏÑ± (Í¥ÄÎ¶¨Ïûê Í≤åÏûÑÏù¥ ÏïÑÎãò)
                setTimeout(() => {
                    socket.emit('findOrCreateGameRoom', {});
                }, 1000);
            }
        });
    }
    
    function updateGameState(state) {
        console.log('updateGameState Ìò∏Ï∂úÎê®:', state);
        console.log('Ï†ÑÎã¨Î∞õÏùÄ Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú:', state.communityCards);
        
        const existingCollectedChips = gameState?.collectedChips || [];
        gameState = state;
        
        if (!gameState.collectedChips) {
            gameState.collectedChips = existingCollectedChips;
        }
        
        currentPlayer = state.currentPlayer;
        isMyTurn = state.isMyTurn;
        
        console.log('updateCommunityCards Ìò∏Ï∂ú Ï†Ñ - Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú:', state.communityCards);
        updateCommunityCards(state.communityCards);
        updatePlayers(state.players);
        updateControls();
        updateGamePhase(state.phase);
        updateRoundInfo(state.currentRound, state.maxRounds);
        
        if (state.room) {
            updateRoomInfo(state.room);
        }
        
        const dealCardsBtn = document.getElementById('dealCardsBtn');
        if (dealCardsBtn) {
            // Ïó¨Îü¨ Î∞©Î≤ïÏúºÎ°ú ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê ÌôïÏù∏
            const currentUsername = socket.data?.username || localStorage.getItem('username') || 
                                   sessionStorage.getItem('username') || window.currentUser;
            
            // Î≥∏Ïù∏Ïù¥ Ïπ¥ÎìúÎ•º Î∞õÏïòÎäîÏßÄ ÌôïÏù∏ (Îã§Î•∏ ÏÇ¨Ïö©ÏûêÏùò Ïπ¥Îìú Î≥¥Ïú† Ïó¨Î∂ÄÏôÄ Î¨¥Í¥Ä)
            const myPlayer = state?.players?.find(p => p.username === currentUsername);
            const myHasCards = myPlayer && myPlayer.cards && myPlayer.cards.length > 0;
            
            if (state?.phase === 'playing') {
                if (myHasCards) {
                    // Î≥∏Ïù∏Ïù¥ Ïπ¥ÎìúÎ•º Î∞õÏïòÏúºÎ©¥ ÎπÑÌôúÏÑ±Ìôî
                    dealCardsBtn.disabled = true;
                    dealCardsBtn.textContent = 'Ïπ¥Îìú Î∞õÍ∏∞ ÏôÑÎ£å';
                    dealCardsBtn.style.opacity = '0.6';
                    dealCardsBtn.style.display = 'inline-block';
                } else {
                    // Î≥∏Ïù∏Ïù¥ Ïπ¥ÎìúÎ•º Î∞õÏßÄ ÏïäÏïòÏúºÎ©¥ ÌôúÏÑ±Ìôî Ïú†ÏßÄ
                    dealCardsBtn.disabled = false;
                    dealCardsBtn.style.opacity = '1';
                    dealCardsBtn.style.display = 'inline-block';
                    
                    // ÏßÑÌñâ ÏÉÅÌô© ÌëúÏãú (Ïù¥ÎØ∏ ÏÑ§Ï†ïÎêòÏñ¥ ÏûàÏßÄ ÏïäÎã§Î©¥ Í∏∞Î≥∏ ÌÖçÏä§Ìä∏)
                    if (!dealCardsBtn.textContent.includes('(')) {
                        dealCardsBtn.textContent = 'Ïπ¥Îìú Î∞õÍ∏∞';
                    }
                }
            }
        }
    }
    

    
    function updateCommunityCards(cards) {
        console.log('updateCommunityCards Ìò∏Ï∂úÎê® - Î∞õÏùÄ Ïπ¥Îìú:', cards);
        const container = document.getElementById('communityCards');
        if (!container) {
            console.error('communityCards Ïª®ÌÖåÏù¥ÎÑàÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§!');
            return;
        }
        
        console.log('Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú Ïª®ÌÖåÏù¥ÎÑà Î∞úÍ≤¨, Í∏∞Ï°¥ ÎÇ¥Ïö© Ï†úÍ±∞');
        container.innerHTML = '';
        
        if (!cards || !Array.isArray(cards)) {
            console.log('Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Ïπ¥Îìú Îç∞Ïù¥ÌÑ∞:', cards);
            return;
        }
        
        console.log(`${cards.length}Ïû•Ïùò Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú ÌëúÏãú ÏãúÏûë`);
        cards.forEach((card, index) => {
            console.log(`Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú ${index + 1}: ${card.rank}${card.suit}`);
            const cardElement = createCardElement(card);
            container.appendChild(cardElement);
        });
        
        console.log('Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
    }
    
    function updatePlayers(players) {
        console.log('updatePlayers Ìò∏Ï∂úÎê®:', players);
        
        // ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê ÏãùÎ≥Ñ
        const currentUsername = socket.data?.username || localStorage.getItem('username') || 
                               sessionStorage.getItem('username') || window.currentUser;
        
        // ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÏôÄ Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥ Î∂ÑÎ¶¨
        const myPlayer = players.find(p => p.username === currentUsername);
        const otherPlayers = players.filter(p => p.username !== currentUsername);
        
        // Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Îì§ ÏóÖÎç∞Ïù¥Ìä∏
        const otherPlayersContainer = document.getElementById('otherPlayersList');
        otherPlayersContainer.innerHTML = '';
        otherPlayers.forEach(player => {
            const playerElement = createOtherPlayerElement(player);
            otherPlayersContainer.appendChild(playerElement);
        });
        
        // ÎÇ¥ ÌîåÎ†àÏù¥Ïñ¥ ÏòÅÏó≠ ÏóÖÎç∞Ïù¥Ìä∏
        if (myPlayer) {
            updateMyPlayer(myPlayer);
        }
        
        // ÌîåÎ†àÏù¥Ïñ¥ Ïàò ÏóÖÎç∞Ïù¥Ìä∏
        const playerCountEl = document.getElementById('playerCount');
        if (playerCountEl) {
            playerCountEl.textContent = players.length;
        }
        
        // Ïπ¥ÏßÄÎÖ∏ Ïπ© ÏóÖÎç∞Ïù¥Ìä∏
        const collectedChips = gameState?.collectedChips || [];
        updateCasinoChips(players.length, collectedChips);
    }
    
    function createCardElement(card) {
        const cardDiv = document.createElement('div');
        cardDiv.className = `card ${card.suit === '‚ô•' || card.suit === '‚ô¶' ? 'red' : 'black'}`;
        if (card.hidden) {
            cardDiv.classList.add('hidden');
            cardDiv.innerHTML = 'üÇ†';
        } else {
            cardDiv.innerHTML = `
                <div>${card.rank}</div>
                <div>${card.suit}</div>
            `;
        }
        return cardDiv;
    }
    
    function createPlayerElement(player) {
        const playerDiv = document.createElement('div');
        const hasCards = player.cards && player.cards.length > 0;
        const cardStatus = hasCards ? 'has-cards' : 'no-cards';
        playerDiv.className = `player ${player.isCurrent ? 'current' : ''} ${cardStatus}`;
        
        let collectedChipsIcons = '';
        if (gameState && gameState.collectedChips && gameState.collectedChips.length > 0) {
            collectedChipsIcons = `
                <div class="collected-chips-icons">
                    ${gameState.collectedChips.map(chipIndex => `
                        <div class="collected-chip-icon" data-chip-index="${chipIndex}" title="Ïπ© ${chipIndex + 1}">
                            <div class="chip-icon-inner">
                                <span class="chip-number">${chipIndex + 1}</span>
            </div>
        </div>
                    `).join('')}
    </div>
            `;
        }
        
        // Ïπ¥Îìú ÏÉÅÌÉú ÌëúÏãú ÏïÑÏù¥ÏΩò
        const cardStatusIcon = hasCards ? 
            '<span class="card-status-icon ready" title="Ïπ¥Îìú Î≥¥Ïú†">‚úì</span>' : 
            '<span class="card-status-icon waiting" title="Ïπ¥Îìú ÎåÄÍ∏∞ Ï§ë">‚è≥</span>';
        
        playerDiv.innerHTML = `
            <div class="player-info">
                <div class="player-name">
                    ${player.username}
                    ${cardStatusIcon}
            </div>
        </div>
            <div class="player-cards-container">
                <div class="player-cards">
                    ${player.cards.map(card => {
                        const cardElement = createCardElement(card);
                        return cardElement.outerHTML;
                    }).join('')}
    </div>
                ${collectedChipsIcons}
    </div>
        `;
        return playerDiv;
    }
    
    // Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥ ÏöîÏÜå ÏÉùÏÑ± (Ïπ¥ÎìúÎäî Îí∑Î©¥ÏúºÎ°úÎßå ÌëúÏãú)
    function createOtherPlayerElement(player) {
        const playerDiv = document.createElement('div');
        const hasCards = player.cards && player.cards.length > 0;
        const cardStatus = hasCards ? 'has-cards' : 'no-cards';
        playerDiv.className = `other-player ${cardStatus}`;
        
        // Ïπ¥Îìú ÏÉÅÌÉú ÌëúÏãú ÏïÑÏù¥ÏΩò
        const cardStatusIcon = hasCards ? 
            '<span class="card-status-icon ready" title="Ïπ¥Îìú Î≥¥Ïú†">‚úì</span>' : 
            '<span class="card-status-icon waiting" title="Ïπ¥Îìú ÎåÄÍ∏∞ Ï§ë">‚è≥</span>';
        
        // Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Ïùò ÏàòÏßëÎêú Ïπ© ÌëúÏãú
        const playerCollectedChips = player.collectedChips || [];
        const chipIcons = playerCollectedChips.map(chipIndex => 
            `<div class="other-player-chip" title="Ïπ© ${chipIndex + 1}">‚òÖ</div>`
        ).join('');
        
        playerDiv.innerHTML = `
            <div class="other-player-info">
                <div class="other-player-name">${player.username}</div>
                ${cardStatusIcon}
                <div class="other-player-cards">
                    ${hasCards ? player.cards.map(() => 
                        '<div class="other-player-card">üÇ†</div>'
                    ).join('') : ''}
                </div>
            </div>
            <div class="other-player-chips">
                ${chipIcons}
            </div>
        `;
        
        return playerDiv;
    }
    
    // ÎÇ¥ ÌîåÎ†àÏù¥Ïñ¥ ÏòÅÏó≠ ÏóÖÎç∞Ïù¥Ìä∏
    function updateMyPlayer(player) {
        // ÎÇ¥ Ïù¥Î¶Ñ ÏóÖÎç∞Ïù¥Ìä∏
        const nameEl = document.getElementById('myPlayerName');
        if (nameEl) {
            nameEl.textContent = player.username;
        }
        
        // ÎÇ¥ Ïπ¥Îìú ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        const statusEl = document.getElementById('myCardStatus');
        const hasCards = player.cards && player.cards.length > 0;
        if (statusEl) {
            statusEl.textContent = hasCards ? '‚úì' : '‚è≥';
            statusEl.className = `card-status-icon ${hasCards ? 'ready' : 'waiting'}`;
            statusEl.title = hasCards ? 'Ïπ¥Îìú Î≥¥Ïú†' : 'Ïπ¥Îìú ÎåÄÍ∏∞ Ï§ë';
        }
        
        // ÎÇ¥ ÌîåÎ†àÏù¥Ïñ¥ ÏòÅÏó≠ Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
        const myAreaEl = document.getElementById('myPlayerArea');
        if (myAreaEl) {
            myAreaEl.className = `my-player-area ${hasCards ? 'has-cards' : 'no-cards'}`;
        }
        
        // ÎÇ¥ Ïπ¥ÎìúÎì§ ÌëúÏãú (Ïã§Ï†ú Ïπ¥Îìú ÎÇ¥Ïö© ÌëúÏãú)
        const myCardsEl = document.getElementById('myCards');
        if (myCardsEl) {
            myCardsEl.innerHTML = '';
            if (hasCards) {
                player.cards.forEach(card => {
                    const cardEl = createMyCardElement(card);
                    myCardsEl.appendChild(cardEl);
                });
            }
        }
        
        // ÎÇ¥ ÏàòÏßëÎêú Ïπ©Îì§Îßå ÌëúÏãú (ÏàòÏßëÌïú Ïπ©Îì§Îßå)
        const myChipsEl = document.getElementById('myChips');
        if (myChipsEl) {
            const playerCollectedChips = player.collectedChips || [];
            myChipsEl.innerHTML = '';
            
            // ÏàòÏßëÎêú Ïπ©Îì§Îßå ÌëúÏãú
            playerCollectedChips.forEach((chipIndex, index) => {
                const chipEl = document.createElement('div');
                chipEl.className = 'my-chip collected';
                chipEl.textContent = '‚òÖ';
                chipEl.title = `ÏàòÏßëÎêú Ïπ© ${chipIndex + 1}`;
                myChipsEl.appendChild(chipEl);
            });
            
            // ÏàòÏßëÎêú Ïπ©Ïù¥ ÏóÜÏúºÎ©¥ ÏïàÎÇ¥ Î©îÏãúÏßÄ
            if (playerCollectedChips.length === 0) {
                const emptyMsg = document.createElement('div');
                emptyMsg.style.color = '#bdc3c7';
                emptyMsg.style.fontSize = '14px';
                emptyMsg.style.fontStyle = 'italic';
                emptyMsg.textContent = 'ÏàòÏßëÎêú Ïπ©Ïù¥ ÏóÜÏäµÎãàÎã§';
                myChipsEl.appendChild(emptyMsg);
            }
        }
    }
    
    // ÎÇ¥ Ïπ¥Îìú ÏöîÏÜå ÏÉùÏÑ± (Ïã§Ï†ú Ïπ¥Îìú ÎÇ¥Ïö© ÌëúÏãú)
    function createMyCardElement(card) {
        const cardDiv = document.createElement('div');
        const isRed = card.suit === '‚ô•' || card.suit === '‚ô¶';
        cardDiv.className = `my-card ${isRed ? 'red' : 'black'}`;
        
        cardDiv.innerHTML = `
            <div class="my-card-top">${card.rank}</div>
            <div class="my-card-suit">${card.suit}</div>
            <div class="my-card-bottom">${card.rank}</div>
        `;
        
        return cardDiv;
    }
    
    function updateControls() {
        const gameActionBtn = document.getElementById('gameActionBtn');
        
        if (gameActionBtn) {
            gameActionBtn.style.display = 'inline-block';
            
            // Ìå®Ïä§ Î™®ÎìúÏùº ÎïåÎßå Ïπ© Î≥¥Ïú† ÏÉÅÌÉúÏóê Îî∞Îùº ÎπÑÌôúÏÑ±Ìôî
            if (gameActionMode === 'pass') {
                const hasCollectedChips = gameState?.collectedChips && gameState.collectedChips.length > 0;
                gameActionBtn.disabled = !hasCollectedChips;
            }
        }
    }
    
    function updateRoundInfo(currentRound, maxRounds) {
        const currentRoundEl = document.getElementById('currentRound');
        const maxRoundsEl = document.getElementById('maxRounds');
        
        if (currentRoundEl) {
            currentRoundEl.textContent = currentRound || '-';
        }
        
        if (maxRoundsEl) {
            maxRoundsEl.textContent = maxRounds || 5;
        }
    }
    
    function updateRoomInfo(room) {
        const roomNameEl = document.getElementById('roomName');
        const roomHostEl = document.getElementById('roomHost');
        
        if (roomNameEl && room) {
            roomNameEl.textContent = room.name || 'Ïïå Ïàò ÏóÜÏùå';
        }
        
        if (roomHostEl && room) {
            roomHostEl.textContent = room.host || 'Ïïå Ïàò ÏóÜÏùå';
        }
    }
    
    function updateGamePhase(phase) {
        const phaseNames = {
            'preflop': 'ÌîÑÎ¶¨ÌîåÎûç',
            'flop': 'ÌîåÎûç',
            'turn': 'ÌÑ¥',
            'river': 'Î¶¨Î≤Ñ',
            'showdown': 'ÏáºÎã§Ïö¥',
            'playing': 'Í≤åÏûÑ ÏßÑÌñâ Ï§ë'
        };
        document.getElementById('gamePhase').textContent = `Í≤åÏûÑ Îã®Í≥Ñ: ${phaseNames[phase] || phase}`;
    }
    

    
    function showMessage(message) {
        document.getElementById('gameMessage').textContent = message;
    }
    
    function showGameOver(result) {
        const message = `Í≤åÏûÑ Ï¢ÖÎ£å! ${result.winner}ÎãòÏù¥ ÏäπÎ¶¨ÌñàÏäµÎãàÎã§!`;
        document.getElementById('gameMessage').innerHTML = `<span class=\"winner\">${message}</span>`;
        setTimeout(() => { window.location.href = '/lobby.html'; }, 3000);
    }

    let cardsDealRequested = false; // Í∞úÎ≥Ñ ÏÇ¨Ïö©ÏûêÏùò Ïπ¥Îìú Î∞õÍ∏∞ ÏöîÏ≤≠ ÏÉÅÌÉú
    let gameActionMode = 'deal'; // 'deal' ÎòêÎäî 'pass'
    
    // ÌÜµÌï©Îêú Í≤åÏûÑ Ïï°ÏÖò Ìï®Ïàò
    function handleGameAction() {
        console.log('Í≤åÏûÑ Ïï°ÏÖò Î≤ÑÌäº ÌÅ¥Î¶≠Îê®, ÌòÑÏû¨ Î™®Îìú:', gameActionMode);
        
        if (gameActionMode === 'deal') {
            dealCards();
        } else if (gameActionMode === 'pass') {
            pass();
        }
    }
    
    // Î≤ÑÌäºÏùÑ Ìå®Ïä§ Î™®ÎìúÎ°ú Ï†ÑÌôòÌïòÎäî Ìï®Ïàò
    function switchToPassMode() {
        const btn = document.getElementById('gameActionBtn');
        if (btn) {
            gameActionMode = 'pass';
            btn.textContent = 'Ìå®Ïä§';
            btn.className = 'btn btn-info pass-mode';
            
            // ÏàòÏßëÎêú Ïπ©Ïù¥ ÏûàÎäîÏßÄ ÌôïÏù∏Ìï¥ÏÑú Î≤ÑÌäº ÌôúÏÑ±Ìôî/ÎπÑÌôúÏÑ±Ìôî
            const hasCollectedChips = gameState?.collectedChips && gameState.collectedChips.length > 0;
            btn.disabled = !hasCollectedChips;
            
            console.log('Î≤ÑÌäºÏù¥ Ìå®Ïä§ Î™®ÎìúÎ°ú Ï†ÑÌôòÎê®, Ïπ© Î≥¥Ïú†:', hasCollectedChips);
        }
    }
    
    // Î≤ÑÌäºÏùÑ Ïπ¥Îìú Î∞õÍ∏∞ Î™®ÎìúÎ°ú Î¶¨ÏÖãÌïòÎäî Ìï®Ïàò
    function resetToDealMode() {
        const btn = document.getElementById('gameActionBtn');
        if (btn) {
            gameActionMode = 'deal';
            btn.textContent = 'Ïπ¥Îìú Î∞õÍ∏∞';
            btn.className = 'btn btn-primary';
            btn.disabled = false;
            
            console.log('Î≤ÑÌäºÏù¥ Ïπ¥Îìú Î∞õÍ∏∞ Î™®ÎìúÎ°ú Î¶¨ÏÖãÎê®');
        }
    }
    
    function dealCards() {
        console.log('Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
        console.log('ÌòÑÏû¨ gameState:', gameState);
        
        // Ïù¥ÎØ∏ Ïù¥ ÏÇ¨Ïö©ÏûêÍ∞Ä Ïπ¥ÎìúÎ•º Î∞õÏïòÎäîÏßÄ ÌôïÏù∏ (Í∞úÏù∏Î≥Ñ Ï≤¥ÌÅ¨)
        if (cardsDealRequested) {
            console.log('Ïù¥ÎØ∏ Ïπ¥Îìú Î∞õÍ∏∞ ÏöîÏ≤≠ÏùÑ ÌñàÏäµÎãàÎã§.');
            showMessage('Ïù¥ÎØ∏ Ïπ¥ÎìúÎ•º ÏöîÏ≤≠ÌñàÏäµÎãàÎã§.');
            return;
        }
        
        // Ïù¥ÎØ∏ Ïπ¥ÎìúÎ•º Î≥¥Ïú†ÌïòÍ≥† ÏûàÎäîÏßÄ ÌôïÏù∏
        const myPlayer = gameState?.players?.find(p => p.username === socket.data?.username);
        if (myPlayer && myPlayer.cards && myPlayer.cards.length > 0) {
            console.log('Ïù¥ÎØ∏ Ïπ¥ÎìúÎ•º Î≥¥Ïú†ÌïòÍ≥† ÏûàÏäµÎãàÎã§.');
            showMessage('Ïù¥ÎØ∏ Ïπ¥ÎìúÎ•º Î≥¥Ïú†ÌïòÍ≥† ÏûàÏäµÎãàÎã§.');
            return;
        }
        
        // socket Ïó∞Í≤∞ ÏÉÅÌÉú ÌôïÏù∏
        if (!socket) {
            console.error('SocketÏù¥ Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
            showMessage('Ïó∞Í≤∞ÏùÑ ÌôïÏù∏ Ï§ëÏûÖÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
            return;
        }
        
        let roomId = null;
        
        // 1. gameStateÏóêÏÑú roomId Í∞ÄÏ†∏Ïò§Í∏∞ (Ïö∞ÏÑ†ÏàúÏúÑ 1)
        if (gameState?.roomId) {
            roomId = gameState.roomId;
            console.log('gameStateÏóêÏÑú Í∞ÄÏ†∏Ïò® roomId:', roomId);
        }
        
        // 2. URLÏóêÏÑú roomId Í∞ÄÏ†∏Ïò§Í∏∞ (Ïö∞ÏÑ†ÏàúÏúÑ 2)
        if (!roomId) {
            const urlParams = new URLSearchParams(window.location.search);
            roomId = urlParams.get('roomId');
            console.log('URLÏóêÏÑú Í∞ÄÏ†∏Ïò® roomId:', roomId);
        }
        
        // 3. socket.dataÏóêÏÑú roomId Í∞ÄÏ†∏Ïò§Í∏∞ (Ïö∞ÏÑ†ÏàúÏúÑ 3)
        if (!roomId && socket?.data?.roomId) {
            roomId = socket.data.roomId;
            console.log('socket.dataÏóêÏÑú Í∞ÄÏ†∏Ïò® roomId:', roomId);
        }
        
        // roomIdÍ∞Ä ÏóÜÏúºÎ©¥ Í∏∞Ï°¥ ÎåÄÍ∏∞ Î∞©Ïóê Ï∞∏Ïó¨ÌïòÍ±∞ÎÇò ÏÉà Î∞© ÏÉùÏÑ± ÏöîÏ≤≠
        if (!roomId) {
            console.log('roomIdÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏñ¥ Í≤åÏûÑ Î∞© Ï∞æÍ∏∞ ÎòêÎäî ÏÉùÏÑ± ÏöîÏ≤≠...');
            socket.emit('findOrCreateGameRoom', {});
            showMessage('Í≤åÏûÑ Î∞©ÏùÑ Ï∞æÎäî Ï§ëÏûÖÎãàÎã§...');
            return;
        }
        
        console.log('ÏµúÏ¢Ö ÏÇ¨Ïö©Ìï† roomId:', roomId);
        
        // Ïù¥ ÏÇ¨Ïö©ÏûêÎßå Ïπ¥Îìú Î∞õÍ∏∞ ÏöîÏ≤≠ ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤Ω (Îã§Î•∏ ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏòÅÌñ• ÏóÜÏùå)
        cardsDealRequested = true;
        
        // Î≥∏Ïù∏Îßå Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäº ÏûÑÏãú ÎπÑÌôúÏÑ±Ìôî
        const dealCardsBtn = document.getElementById('dealCardsBtn');
        if (dealCardsBtn) {
            dealCardsBtn.disabled = true;
            dealCardsBtn.textContent = 'ÎÇ¥ Ïπ¥Îìú Î∞õÎäî Ï§ë...';
        }
        
        // Ïπ¥Îìú Î∞õÍ∏∞ Ïï†ÎãàÎ©îÏù¥ÏÖò ÏãúÏûë
        showCardDealingAnimation();
        
        socket.emit('requestDealCards', { roomId: roomId });
        showMessage('Ïπ¥ÎìúÎ•º Î∞õÍ≥† ÏûàÏäµÎãàÎã§...');
    }
    
    function pass() {
        console.log('Ìå®Ïä§ Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
        
        if (!gameState?.collectedChips || gameState.collectedChips.length === 0) {
            showMessage('Ìå®Ïä§ÌïòÎ†§Î©¥ Î®ºÏ†Ä Ïπ©ÏùÑ ÏàòÏßëÌï¥Ïïº Ìï©ÎãàÎã§.');
            return;
        }
        
        showMessage('Ìå®Ïä§ÌñàÏäµÎãàÎã§!');
        
        const passBtn = document.getElementById('passBtn');
        if (passBtn) {
            passBtn.disabled = true;
        }
    }
    
    // Ïπ©Í≥º Î≥Ñ ÏÉùÏÑ± Ìï®Ïàò
    function updateCasinoChips(playerCount, collectedChips = []) {
        console.log('updateCasinoChips Ìò∏Ï∂úÎê®:', { playerCount, collectedChips });
        
        const chipsContainer = document.getElementById('casinoChipsContainer');
        const chipsStack = chipsContainer.querySelector('.chips-stack');
        
        if (!chipsContainer || !chipsStack) {
            console.error('Ïπ© Ïª®ÌÖåÏù¥ÎÑàÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå');
            return;
        }
        
        chipsStack.innerHTML = '';
        
        for (let i = 0; i < playerCount; i++) {
            const chip = document.createElement('div');
            chip.className = 'casino-chip';
            chip.dataset.chipIndex = i;
            
            const isCollected = collectedChips.includes(i);
            
            if (isCollected) {
                chip.classList.add('collected');
                chip.style.background = 'linear-gradient(135deg, #95a5a6, #7f8c8d)';
                chip.style.cursor = 'default';
                chip.style.opacity = '0.6';
            } else {
                // Ïó¨Îü¨ Î∞©Î≤ïÏúºÎ°ú ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê ÌôïÏù∏
                const currentUsername = socket.data?.username || localStorage.getItem('username') || 
                                       sessionStorage.getItem('username') || window.currentUser;
                
                // ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÍ∞Ä Ïπ¥ÎìúÎ•º Î∞õÏïòÎäîÏßÄ ÌôïÏù∏
                const myPlayer = gameState?.players?.find(p => p.username === currentUsername);
                const hasMyCards = myPlayer && myPlayer.cards && myPlayer.cards.length > 0;
                
                if (hasMyCards) {
                    // Ïπ¥ÎìúÎ•º Î∞õÏùÄ ÏÇ¨Ïö©Ïûê: ÏùºÎ∞ò ÎÖ∏ÎûÄÏÉâ Ïπ© (ÌÅ¥Î¶≠ Í∞ÄÎä•)
                    chip.style.background = 'linear-gradient(135deg, #f1c40f, #f39c12)';
                    chip.style.border = '4px solid #fff';
                    chip.style.boxShadow = '0 4px 12px rgba(241, 196, 15, 0.4)';
                    chip.style.cursor = 'pointer';
                    
                    chip.addEventListener('click', function() {
                        collectChip(this, i);
                    });
                } else {
                    // Ïπ¥ÎìúÎ•º Î∞õÏßÄ ÏïäÏùÄ ÏÇ¨Ïö©Ïûê: ÌùêÎ¶øÌïú Ïπ© (ÌÅ¥Î¶≠ Ïãú ÏïàÎÇ¥ Î©îÏãúÏßÄ)
                    chip.style.background = 'linear-gradient(135deg, #f1c40f, #f39c12)';
                    chip.style.border = '4px solid #fff';
                    chip.style.boxShadow = '0 4px 12px rgba(241, 196, 15, 0.4)';
                    chip.style.opacity = '0.5';
                    chip.style.cursor = 'not-allowed';
                    chip.style.filter = 'grayscale(50%)';
                    
                    chip.addEventListener('click', function() {
                        collectChip(this, i);
                    });
                }
            }
            
            const starsContainer = document.createElement('div');
            starsContainer.className = 'chip-stars';
            
            // Í∞Å Ïπ©ÎßàÎã§ Îã§Î•∏ Î≥Ñ Î™®Ïñë Î∞∞Ïó¥
            const starSymbols = ['‚òÖ', '‚òÜ', '‚ú¶', '‚úß', '‚ú™', '‚≠ê', 'üåü', '‚ú®'];
            
            // Í∞Å Ïπ©Ïóê Í≥†Ïú†Ìïú Î≥Ñ ÌïòÎÇòÏî© ÌëúÏãú
            const star = document.createElement('div');
            star.className = 'chip-star';
            star.textContent = starSymbols[i % starSymbols.length];
            star.style.fontSize = '24px';
            star.style.color = '#fff';
            star.style.textShadow = '0 2px 4px rgba(0,0,0,0.5)';
            star.style.animation = 'starTwinkle 2s ease-in-out infinite alternate';
            star.style.animationDelay = `${i * 0.3}s`;
            starsContainer.appendChild(star);
            
            chip.appendChild(starsContainer);
            chipsStack.appendChild(chip);
        }
    }
    
    // Ïπ© ÏàòÏßë Ìï®Ïàò
    function collectChip(chipElement, chipIndex) {
        console.log('collectChip Ìò∏Ï∂úÎê®:', chipIndex);
        console.log('ÌòÑÏû¨ gameState:', gameState);
        console.log('socket.data:', socket.data);
        console.log('localStorage username:', localStorage.getItem('username'));
        
        // Ïó¨Îü¨ Î∞©Î≤ïÏúºÎ°ú ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê ÌôïÏù∏
        const currentUsername = socket.data?.username || localStorage.getItem('username') || 
                               sessionStorage.getItem('username') || window.currentUser;
        
        console.log('ÌôïÏù∏Îêú ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÎ™Ö:', currentUsername);
        console.log('gameState.players:', gameState?.players);
        
        // Ïπ¥ÎìúÎ•º Î∞õÏïòÎäîÏßÄ ÌôïÏù∏
        const myPlayer = gameState?.players?.find(p => p.username === currentUsername);
        console.log('Ï∞æÏùÄ ÎÇ¥ ÌîåÎ†àÏù¥Ïñ¥:', myPlayer);
        console.log('ÎÇ¥ Ïπ¥Îìú:', myPlayer?.cards);
        
        if (!myPlayer || !myPlayer.cards || myPlayer.cards.length === 0) {
            console.log('Ïπ¥ÎìúÎ•º Î®ºÏ†Ä Î∞õÏïÑÏïº Ïπ©ÏùÑ ÏàòÏßëÌï† Ïàò ÏûàÏäµÎãàÎã§');
            console.log('Ï°∞Í±¥ Ï≤¥ÌÅ¨:', {
                myPlayer: !!myPlayer,
                hasCards: !!(myPlayer?.cards),
                cardsLength: myPlayer?.cards?.length
            });
            showMessage('Ïπ¥ÎìúÎ•º Î®ºÏ†Ä Î∞õÏïÑÏïº Ïπ©ÏùÑ ÏàòÏßëÌï† Ïàò ÏûàÏäµÎãàÎã§!');
            
            // Ïπ©ÏùÑ ÌùîÎì§Ïñ¥ÏÑú ÏãúÍ∞ÅÏ†Å ÌîºÎìúÎ∞± Ï†úÍ≥µ
            chipElement.style.animation = 'chipShake 0.5s ease-in-out';
            setTimeout(() => {
                chipElement.style.animation = '';
            }, 500);
            return;
        }
        
        if (chipElement.classList.contains('clicked') || chipElement.classList.contains('collected')) {
            console.log('Ïù¥ÎØ∏ ÏàòÏßëÎêú Ïπ©ÏûÖÎãàÎã§');
            return;
        }
        
        chipElement.classList.add('clicked');
        
        // ÏÑúÎ≤ÑÏóê Ïπ© ÏàòÏßë Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ°
        socket.emit('collectChip', {
            roomId: gameState.roomId,
            chipIndex: chipIndex
        });
        
        setTimeout(() => {
            chipElement.classList.remove('clicked');
            chipElement.classList.add('collected');
            chipElement.style.background = 'linear-gradient(135deg, #95a5a6, #7f8c8d)';
            chipElement.style.cursor = 'default';
            chipElement.style.opacity = '0.6';
            chipElement.style.pointerEvents = 'none';
        }, 500);
        
        showMessage(`Ïπ© ${chipIndex + 1}ÏùÑ ÏàòÏßëÌñàÏäµÎãàÎã§!`);
    }
    
    // Ïπ¥Îìú Î∞õÍ∏∞ Ïï†ÎãàÎ©îÏù¥ÏÖò
    function showCardDealingAnimation() {
        const existingAnimation = document.querySelector('.card-dealing-animation');
        if (existingAnimation) {
            existingAnimation.remove();
        }
        
        const animationContainer = document.createElement('div');
        animationContainer.className = 'card-dealing-animation';
        animationContainer.style.cssText = `
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
                gap: 10px;
        `;
        
        for (let i = 0; i < 2; i++) {
            const card = document.createElement('div');
            card.className = 'dealing-card';
            card.style.cssText = `
                width: 60px;
                height: 90px;
                background: linear-gradient(45deg, #2c3e50, #34495e);
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                transform: translateY(-100px);
                opacity: 0;
                transition: all 0.6s ease-out;
                border: 2px solid #fff;
            `;
            
            card.innerHTML = `
                <div style="
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    font-size: 24px;
                    color: #fff;
                    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
                ">‚ô†</div>
            `;
            
            animationContainer.appendChild(card);
        }
        
        document.body.appendChild(animationContainer);
        
        setTimeout(() => {
            const cards = animationContainer.querySelectorAll('.dealing-card');
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.style.transform = 'translateY(0)';
                    card.style.opacity = '1';
                }, index * 200);
            });
        }, 100);
        
        setTimeout(() => {
            if (animationContainer.parentNode) {
                animationContainer.remove();
            }
        }, 3000);
    }
    
    window.addEventListener('load', async () => {
        // Ï¥àÍ∏∞ ÌîåÎ†àÏù¥Ïñ¥ Ïàò ÏÑ§Ï†ï
        const playerCountEl = document.getElementById('playerCount');
        if (playerCountEl) {
            playerCountEl.textContent = '1';
            console.log('Ï¥àÍ∏∞ ÌîåÎ†àÏù¥Ïñ¥ ÏàòÎ•º 1Î°ú ÏÑ§Ï†ïÌñàÏäµÎãàÎã§.');
        }
        
        // Ï¥àÍ∏∞ Í≤åÏûÑ ÏÉÅÌÉú ÏÑ§Ï†ï
        gameState.phase = 'playing';
        updateControls();
        console.log('Ï¥àÍ∏∞ Í≤åÏûÑ ÏÉÅÌÉú ÏÑ§Ï†ï ÏôÑÎ£å');
        
        // URLÏóêÏÑú roomId Í∞ÄÏ†∏ÏôÄÏÑú gameStateÏóê ÏÑ§Ï†ï
        const urlParams = new URLSearchParams(window.location.search);
        const roomId = urlParams.get('roomId');
        if (roomId) {
            gameState.roomId = roomId;
            console.log('ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú roomId ÏÑ§Ï†ï:', roomId);
        }
        
        connectSocket();
        
        // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
        isAdmin = await checkAdminStatus();
        console.log('Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏ Í≤∞Í≥º:', isAdmin);
        
        // Í≤åÏûÑ ÏãúÏûëÏùÄ registerUserSuccess Ïù¥Î≤§Ìä∏ÏóêÏÑú Ï≤òÎ¶¨Îê®
        console.log('ÌéòÏù¥ÏßÄ Î°úÎìú ÏôÑÎ£å, ÏÇ¨Ïö©Ïûê Îì±Î°ù ÎåÄÍ∏∞ Ï§ë...');
        
        // Í≤åÏûÑ ÏûêÎèô ÏãúÏûëÏùÄ registerUserSuccess Ïù¥Î≤§Ìä∏ÏóêÏÑú Ï≤òÎ¶¨Îê®
        console.log('ÏÇ¨Ïö©Ïûê Îì±Î°ù ÏôÑÎ£å ÎåÄÍ∏∞ Ï§ë... (registerUserSuccess Ïù¥Î≤§Ìä∏ÏóêÏÑú Í≤åÏûÑ ÏãúÏûë)');
        
        // Ï¥àÍ∏∞ Ïπ© ÌëúÏãú (Í∏∞Î≥∏Í∞í 2Í∞ú, ÏàòÏßëÎêú Ïπ© ÏóÜÏùå)
        console.log('ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞ Ïπ© ÌëúÏãú');
        updateCasinoChips(2, []);
    });
    </script>
</body>
</html> 