<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Í≤åÏûÑ ÌîåÎ†àÏù¥ - ÏÜåÍ∞ï v2.1</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
                 .game-info {
             display: flex !important;
             flex-direction: column !important;
             background: rgba(255,255,255,0.15);
             padding: 25px 30px;
             border-radius: 0 0 20px 20px;
             margin-bottom: 40px;
             backdrop-filter: blur(15px);
             border: 2px solid rgba(255,255,255,0.3);
             border-top: none;
             box-shadow: 0 8px 32px rgba(0,0,0,0.3);
             /* position: sticky Ï†úÍ±∞ - ÏùºÎ∞ò ÏÉÅÎã® Î∞∞ÏπòÎ°ú Î≥ÄÍ≤Ω */
             z-index: 100;
         }
         
         .game-info-header {
             display: flex !important;
             flex-direction: row !important;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 20px;
         }
        
        .game-info .room-info-compact {
            flex: 0 0 auto;
            text-align: left;
            min-width: 120px;
            font-weight: 600;
            font-size: 1.1rem;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .game-info .game-phase {
            flex: 1;
            text-align: center;
            min-width: 200px;
            font-weight: 700;
            font-size: 1.2rem;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .game-info .round-info {
            flex: 0 0 auto;
            text-align: right;
            min-width: 120px;
            font-weight: 600;
            font-size: 1.1rem;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        
         

        

        
                          /* Î™®Î∞îÏùº Î∞òÏùëÌòï */
         @media (max-width: 768px) {
             .game-info {
                 flex-direction: column;
                 gap: 15px;
                 padding: 20px 15px;
                 border-radius: 0 0 15px 15px;
                 margin-bottom: 30px;
             }
             
             .game-info-header {
                 flex-direction: column;
                 gap: 15px;
                 margin-bottom: 15px;
             }
             
             .game-info .room-info-compact,
             .game-info .game-phase,
             .game-info .round-info {
                 flex: none;
                 text-align: center;
                 font-size: 1rem;
             }
             
             .game-info .game-phase {
                 font-size: 1.1rem;
             }
             
                           .all-players {
                  max-height: 30vh;
                  padding: 12px;
              }
              
              .all-player-chips-after-cards {
                  margin-left: 8px;
                  gap: 3px;
              }
              
                             .all-player-chips-after-cards .all-player-chip {
                   width: 18px;
                   height: 18px;
                   font-size: 7px;
                   background: linear-gradient(135deg, #ffffff, #f0f0f0);
                   border: 1px solid rgba(200,200,200,0.8);
                   color: #333;
                   text-shadow: 0 1px 2px rgba(255,255,255,0.8);
                   box-shadow: 0 1px 4px rgba(255, 255, 255, 0.6);
               }
         }
        
        .community-cards {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
            min-height: 120px;
        }
        .card {
            width: 80px;
            height: 120px;
            background: white;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border: 2px solid #ddd;
            position: relative;
        }
        .card.hidden {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: transparent;
        }
        .card.red {
            color: #e74c3c;
        }
                 .card.black {
             color: #2c3e50;
         }
         
         /* Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú ÏÉâÏÉÅ Í∞ïÌôî */
         .card.red {
             color: #e74c3c;
             text-shadow: 0 1px 2px rgba(0,0,0,0.8);
             font-weight: bold;
         }
         
         .card.black {
             color: #2c3e50;
             text-shadow: 0 1px 2px rgba(255,255,255,0.8);
             font-weight: bold;
         }
         
         /* Ïπ¥Îìú Î¨∏Ïñë ÌÅ¨Í∏∞ Î∞è Í∞ÄÏãúÏÑ± Í∞úÏÑ† */
         .card div:last-child {
             font-size: 1.5rem !important;
             margin-top: 5px;
             text-shadow: 0 2px 4px rgba(0,0,0,0.5);
         }
        .players-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .player {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }
        
        .player.has-cards {
            border-color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
        }
        
        .player.no-cards {
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.1);
            animation: waitingPulse 2s ease-in-out infinite;
        }
        
        @keyframes waitingPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .card-status-icon {
            margin-left: 8px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .card-status-icon.ready {
            background: #27ae60;
            color: white;
        }
        
        .card-status-icon.waiting {
            background: #f39c12;
            color: white;
            animation: iconPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes iconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes chipShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* ÏÉàÎ°úÏö¥ Î†àÏù¥ÏïÑÏõÉ Ïä§ÌÉÄÏùº */
        .players-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
            gap: 20px;
        }

                 .all-players {
             display: flex !important;
             flex-direction: column;
             gap: 10px;
             max-height: 40vh;
             min-height: 120px;
             overflow-y: auto;
             padding: 15px;
             background: rgba(255,255,255,0.2) !important;
             border-radius: 12px;
             border: 3px solid #00ff00 !important;
             margin: 10px 0;
             position: relative;
             z-index: 999;
         }

                 .all-player {
             background: rgba(255,255,255,0.1);
             border-radius: 12px;
             padding: 15px 20px;
             backdrop-filter: blur(10px);
             border: 2px solid rgba(255,255,255,0.2);
             transition: all 0.3s ease;
             display: flex;
             justify-content: space-between;
             align-items: center;
             min-height: 80px;
         }
         
         /* ÏûêÏã†Í≥º Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥ Íµ¨Î∂Ñ Ïä§ÌÉÄÏùº */
         .all-player.current-user {
             border-color: #3498db;
             background: rgba(52, 152, 219, 0.15);
             box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
         }
         
         .all-player.other-user {
             border-color: rgba(255,255,255,0.2);
             background: rgba(255,255,255,0.1);
         }

                 .all-player.has-cards {
             border-color: #27ae60;
             background: rgba(39, 174, 96, 0.1);
             box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
         }
         
         .all-player.no-cards {
             border-color: #f39c12;
             background: rgba(243, 156, 18, 0.1);
             animation: waitingPulse 2s ease-in-out infinite;
         }
         
         .all-player-info {
             display: flex;
             align-items: center;
             gap: 15px;
         }
         
         .all-player-name {
             color: #fff;
             font-size: 18px;
             font-weight: 600;
         }
         
         .all-player-cards {
             display: flex;
             gap: 5px;
         }
         
         .all-player-card {
             width: 30px;
             height: 42px;
             background: linear-gradient(135deg, #2c3e50, #34495e);
             border-radius: 6px;
             border: 1px solid #fff;
             display: flex;
             align-items: center;
             justify-content: center;
             color: #fff;
             font-size: 12px;
             box-shadow: 0 2px 4px rgba(0,0,0,0.3);
         }
         
         /* Ïπ¥Îìú ÏÉâÏÉÅ Ïä§ÌÉÄÏùº */
         .all-player-card.red {
             color: #e74c3c;
             text-shadow: 0 1px 2px rgba(0,0,0,0.8);
             font-weight: bold;
         }
         
         .all-player-card.black {
             color: #2c3e50;
             text-shadow: 0 1px 2px rgba(255,255,255,0.8);
             font-weight: bold;
         }
         
         /* ÏöîÏïΩÏ∞Ω Ïπ¥Îìú Î¨∏Ïñë Í∞ÄÏãúÏÑ± Í∞úÏÑ† */
         .all-player-card {
             font-weight: bold;
             text-shadow: 0 1px 2px rgba(0,0,0,0.5);
         }
         
         .all-player-chips {
             display: flex;
             gap: 8px;
         }
         
         .all-player-chip {
             width: 25px;
             height: 25px;
             border-radius: 50%;
             background: linear-gradient(135deg, #ffffff, #f0f0f0);
             border: 2px solid rgba(200,200,200,0.8);
             display: flex;
             align-items: center;
             justify-content: center;
             color: #333;
             font-size: 10px;
             font-weight: bold;
             text-shadow: 0 1px 2px rgba(255,255,255,0.8);
             animation: chipGlow 2s ease-in-out infinite alternate;
             box-shadow: 0 2px 8px rgba(255, 255, 255, 0.6);
         }
         
         /* Ïπ¥Îìú Îí§Ïóê ÌëúÏãúÎêòÎäî Ïπ©Îì§ */
         .all-player-chips-after-cards {
             display: flex;
             gap: 5px;
             margin-left: 10px;
             align-items: center;
         }
         
         .all-player-chips-after-cards .all-player-chip {
             width: 20px;
             height: 20px;
             font-size: 8px;
             background: linear-gradient(135deg, #ffffff, #f0f0f0);
             border: 1px solid rgba(200,200,200,0.8);
             color: #333;
             text-shadow: 0 1px 2px rgba(255,255,255,0.8);
             box-shadow: 0 1px 4px rgba(255, 255, 255, 0.6);
         }

        .my-player-area {
            background: rgba(255,255,255,0.15);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(15px);
            border: 3px solid rgba(255,255,255,0.3);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            height: 250px;
            position: relative;
            flex-shrink: 0;
        }

        .my-player-area.has-cards {
            border-color: #27ae60;
            background: rgba(39, 174, 96, 0.15);
            box-shadow: 0 8px 32px rgba(39, 174, 96, 0.2);
        }

        .my-player-area.no-cards {
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.15);
            animation: waitingPulse 2s ease-in-out infinite;
        }

        .my-player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .my-player-name {
            color: #fff;
            font-size: 24px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .my-player-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .my-cards {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

                 .my-card {
             width: 80px;
             height: 112px;
             background: linear-gradient(135deg, #fff, #f8f9fa);
             border-radius: 12px;
             border: 2px solid #333;
             display: flex;
             flex-direction: column;
             align-items: center;
             justify-content: space-between;
             padding: 8px;
             box-shadow: 0 4px 12px rgba(0,0,0,0.3);
             transform: perspective(300px) rotateY(0deg);
             transition: all 0.3s ease;
         }

         .my-card:hover {
             transform: perspective(300px) rotateY(-5deg) translateY(-5px);
             box-shadow: 0 8px 20px rgba(0,0,0,0.4);
         }

        .my-card-top {
            font-size: 16px;
            font-weight: bold;
            line-height: 1;
        }

        .my-card-suit {
            font-size: 32px;
            line-height: 1;
        }

        .my-card-bottom {
            font-size: 16px;
            font-weight: bold;
            line-height: 1;
            transform: rotate(180deg);
        }

        .my-card.red {
            color: #e74c3c;
        }

                 .my-card.black {
             color: #2c3e50;
         }
         
         /* ÎÇ¥ Ïπ¥Îìú ÏÉâÏÉÅ Í∞ïÌôî */
         .my-card.red {
             color: #e74c3c;
             text-shadow: 0 1px 2px rgba(0,0,0,0.8);
             font-weight: bold;
         }
         
         .my-card.black {
             color: #2c3e50;
             text-shadow: 0 1px 2px rgba(255,255,255,0.8);
             font-weight: bold;
         }
         
         /* ÎÇ¥ Ïπ¥Îìú Î¨∏Ïñë ÌÅ¨Í∏∞ Î∞è Í∞ÄÏãúÏÑ± Í∞úÏÑ† */
         .my-card-suit {
             font-size: 32px !important;
             text-shadow: 0 2px 4px rgba(0,0,0,0.5);
             font-weight: bold;
         }

        .my-chips {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

                 .my-chip {
             width: 40px;
             height: 40px;
             border-radius: 50%;
             background: linear-gradient(135deg, #ffffff, #f0f0f0);
             border: 3px solid #ddd;
             display: flex;
             align-items: center;
             justify-content: center;
             font-size: 14px;
             color: #333;
             font-weight: bold;
             box-shadow: 0 4px 8px rgba(0,0,0,0.3);
             cursor: pointer;
             transition: all 0.3s ease;
         }

         .my-chip:hover {
             transform: translateY(-3px);
             box-shadow: 0 6px 12px rgba(0,0,0,0.4);
         }

        .my-chip.collected {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            cursor: default;
            opacity: 0.6;
        }

        .game-center {
            text-align: center;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0;
            min-height: 300px;
        }

        /* Ï§ëÎ≥µÎêú Ïä§ÌÉÄÏùº Ï†úÍ±∞ - ÏúÑÏùò .game-info Ïä§ÌÉÄÏùºÍ≥º ÌÜµÌï©Îê® */

        .room-info-compact {
            color: #bdc3c7;
            font-size: 14px;
        }

        .my-content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .my-controls-area {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex !important;
            flex-direction: column !important;
            gap: 15px;
            justify-content: flex-start;
            align-items: stretch;
            min-width: 120px;
            width: 120px;
            z-index: 100;
        }

        .game-controls {
            display: flex !important;
            flex-direction: column !important;
            gap: 15px;
            width: 100%;
            position: relative !important;
            z-index: 200;
        }

        .game-controls .btn {
            width: 100% !important;
            margin: 0 !important;
            position: relative !important;
            display: block !important;
            z-index: 201;
            background: rgba(255,255,255,0.1) !important;
            backdrop-filter: blur(10px) !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;
        }

        /* Í≤åÏûÑ Ïï°ÏÖò Î≤ÑÌäº Ïä§ÌÉÄÏùº */
        #gameActionBtn {
            position: relative !important;
            display: block !important;
            width: 100% !important;
            margin: 0 !important;
            float: none !important;
            clear: both !important;
            z-index: 202 !important;
            background: rgba(255,255,255,0.15) !important;
            transition: all 0.3s ease !important;
        }

                 /* Ìå®Ïä§ Î≤ÑÌäº ÏÉÅÌÉúÏùº ÎïåÏùò Ïä§ÌÉÄÏùº */
         #gameActionBtn.pass-mode {
             border-color: #17a2b8 !important;
             color: #17a2b8 !important;
         }

         #gameActionBtn.pass-mode:hover:not(:disabled) {
             border-color: #138496 !important;
             background: rgba(23, 162, 184, 0.2) !important;
             color: #138496 !important;
         }


        .player.current {
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255,215,0,0.5);
        }
        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .player-name {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .player-chips {
            color: #ffd700;
            font-weight: bold;
        }
        .player-cards {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }
        .player-cards .card {
            width: 60px;
            height: 90px;
            font-size: 1rem;
        }
        .player-bet {
            text-align: center;
            color: #ffd700;
            font-weight: bold;
        }
        /* Í∏∞Ï°¥ fixed Ïä§ÌÉÄÏùºÏùÑ Ï£ºÏÑù Ï≤òÎ¶¨
        .game-controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        */
        .controls-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            gap: 15px;
            align-items: center;
        }
                 .btn {
             padding: 12px 20px;
             background: transparent;
             border: 2px solid rgba(255,255,255,0.3);
             border-radius: 12px;
             font-size: 1rem;
             font-weight: 600;
             cursor: pointer;
             transition: all 0.3s ease;
             min-width: 100px;
             color: #fff;
             backdrop-filter: blur(10px);
         }

         .btn:hover {
             border-color: rgba(255,255,255,0.6);
             background: rgba(255,255,255,0.1);
             transform: translateY(-2px);
             box-shadow: 0 4px 12px rgba(0,0,0,0.2);
         }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
                 .btn-primary {
             border-color: #3498db;
             color: #3498db;
         }

         .btn-primary:hover:not(:disabled) {
             border-color: #2980b9;
             background: rgba(52, 152, 219, 0.2);
             color: #2980b9;
         }
                 .btn-info {
             border-color: #17a2b8;
             color: #17a2b8;
         }

         .btn-info:hover:not(:disabled) {
             border-color: #138496;
             background: rgba(23, 162, 184, 0.2);
             color: #138496;
         }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
        }
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }
        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }
                 .btn:disabled {
             opacity: 0.5;
             cursor: not-allowed;
         }

         .btn:hover:not(:disabled) {
             transform: translateY(-2px);
             box-shadow: 0 4px 12px rgba(0,0,0,0.3);
         }
        .bet-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .bet-input {
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            width: 100px;
            text-align: center;
        }
        .game-message {
            text-align: center;
            font-size: 1.2rem;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        .winner {
            color: #ffd700;
            font-weight: bold;
        }
        .room-info {
            text-align: center;
            margin-bottom: 20px;
        }
        .room-info h2 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        .room-info p {
            font-size: 1rem;
        }
        .room-info strong {
            font-weight: bold;
        }
        
        /* Ïπ¥ÏßÄÎÖ∏ Ïπ© Ïä§ÌÉÄÏùº */
        .casino-chips-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px 0;
            min-height: 120px;
        }
        
        .chips-stack {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 10px;
            max-width: 400px;
        }
        
                 .casino-chip {
             width: 60px;
             height: 60px;
             border-radius: 50%;
             background: linear-gradient(135deg, #ffffff, #f0f0f0);
             border: 4px solid #ddd;
             box-shadow: 0 4px 12px rgba(0,0,0,0.3);
             display: flex;
             justify-content: center;
             align-items: center;
             position: relative;
             animation: chipGlow 2s ease-in-out infinite alternate;
             cursor: pointer;
             transition: all 0.3s ease;
         }

         .casino-chip:hover {
             transform: scale(1.1);
             box-shadow: 0 6px 20px rgba(255, 255, 255, 0.8);
         }
        
        .casino-chip.clicked {
            animation: chipCollect 0.5s ease-out forwards;
        }
        
        .casino-chip.collected {
            animation: none;
            pointer-events: none;
        }
        
        .casino-chip.collected:hover {
            transform: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        /* ÎùºÏö¥ÎìúÎ≥Ñ Ïπ© ÏÉâÏÉÅ */
        .casino-chip.white {
            background: linear-gradient(135deg, #ffffff, #f0f0f0);
            border-color: #ddd;
        }
        
        .casino-chip.yellow {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border-color: #e6c200;
        }
        
        .casino-chip.orange {
            background: linear-gradient(135deg, #ff8c00, #ffab40);
            border-color: #e67e00;
        }
        
        .casino-chip.red {
            background: linear-gradient(135deg, #dc3545, #ff6b7a);
            border-color: #c82333;
        }

        /* ÏáºÎã§Ïö¥ UI Ïä§ÌÉÄÏùº */
        .showdown-container {
            display: none;
            flex-direction: column;
            gap: 15px;
            margin: 20px auto;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            max-width: 900px;
        }

        .showdown-container.active {
            display: flex;
        }

        .showdown-player-row {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .showdown-red-chip {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #dc3545, #ff6b7a);
            border: 3px solid #c82333;
            box-shadow: 0 3px 10px rgba(0,0,0,0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: white;
            flex-shrink: 0;
        }

        .showdown-player-name {
            min-width: 100px;
            font-weight: bold;
            font-size: 1.1rem;
            color: white;
            flex-shrink: 0;
        }

        .showdown-pocket-cards {
            display: flex;
            gap: 5px;
            flex-shrink: 0;
        }

        .showdown-pocket-cards .card {
            width: 60px;
            height: 90px;
            font-size: 1rem;
        }

        .showdown-hand-name {
            flex: 1;
            text-align: center;
            font-weight: 600;
            font-size: 1rem;
            color: #ffd700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .showdown-result-badge {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .showdown-result-badge.success {
            background: linear-gradient(135deg, #28a745, #20c997);
            box-shadow: 0 0 15px rgba(40, 167, 69, 0.6);
        }

        .showdown-result-badge.fail {
            background: linear-gradient(135deg, #dc3545, #c82333);
            box-shadow: 0 0 15px rgba(220, 53, 69, 0.6);
        }

        /* Í∏àÍ≥†/Í≤ΩÎ≥¥ Ïπ¥Ïö¥ÌÑ∞ Ïä§ÌÉÄÏùº */
        .heist-score-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            margin: 10px auto;
            max-width: 600px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .heist-score-container.visible {
            opacity: 1;
            visibility: visible;
        }

        .heist-score-badge {
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            border: 3px solid rgba(255,255,255,0.3);
        }

        .heist-score-badge.success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .heist-score-badge.fail {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
        }

        /* ÌôïÏù∏ ÏÑπÏÖò Ïä§ÌÉÄÏùº */
        .showdown-confirm-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .confirm-button {
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
            transition: all 0.3s ease;
        }

        .confirm-button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
        }

        .confirm-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }

        .confirm-progress {
            font-size: 1rem;
            color: #ffd700;
            font-weight: 600;
        }

        /* ÏàòÏßëÌïú Ïπ© ÌëúÏãú Ïä§ÌÉÄÏùº */
        .player-cards-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .collected-chips-icons {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            align-items: center;
        }
        
                 .collected-chip-icon {
             width: 24px;
             height: 24px;
             border-radius: 50%;
             background: linear-gradient(135deg, #95a5a6, #7f8c8d);
             border: 2px solid rgba(255,255,255,0.3);
             display: flex;
             align-items: center;
             justify-content: center;
             cursor: default;
             position: relative;
             animation: chipGlow 2s ease-in-out infinite alternate;
         }

         .collected-chip-icon:hover {
             transform: scale(1.1);
             box-shadow: 0 2px 8px rgba(255,215,0,0.4);
         }

         .chip-icon-inner {
             display: flex;
             align-items: center;
             justify-content: center;
             width: 100%;
             height: 100%;
         }

         .chip-number {
             color: #fff;
             font-size: 10px;
             font-weight: bold;
             text-shadow: 0 1px 2px rgba(0,0,0,0.5);
         }
        
        .casino-chip::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
        }
        
        .casino-chip::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
        }
        
        .chip-stars {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            width: 50px;
            height: 50px;
            gap: 2px;
            z-index: 20;
        }
        
        .chip-star {
            color: #fff;
            font-size: 12px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
            animation: starTwinkle 1.5s ease-in-out infinite;
            line-height: 1;
            font-weight: bold;
            z-index: 10;
            position: relative;
        }
        
        .chip-star:nth-child(odd) {
            animation-delay: 0.5s;
        }
        
        /* Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Ïùò ÏàòÏßëÎêú Ïπ© ÌëúÏãú Ïä§ÌÉÄÏùº */
        .other-player-chips {
            display: flex;
            gap: 5px;
            margin-top: 5px;
            justify-content: center;
        }
        
                 .other-player-chip {
             width: 20px;
             height: 20px;
             border-radius: 50%;
             background: linear-gradient(135deg, #95a5a6, #7f8c8d);
             border: 2px solid rgba(255,255,255,0.3);
             display: flex;
             align-items: center;
             justify-content: center;
             color: #fff;
             font-size: 12px;
             font-weight: bold;
             text-shadow: 0 1px 2px rgba(0,0,0,0.5);
             animation: chipGlow 2s ease-in-out infinite alternate;
         }

         .other-player-chip:hover {
             transform: scale(1.1);
             box-shadow: 0 2px 8px rgba(255,215,0,0.4);
         }
        
        @keyframes chipGlow {
            0% {
                box-shadow: 0 4px 12px rgba(255, 255, 255, 0.4);
            }
            100% {
                box-shadow: 0 4px 20px rgba(255, 255, 255, 0.7);
            }
        }
        
        @keyframes starTwinkle {
            0%, 100% {
                opacity: 0.7;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.2);
            }
        }
        
        @keyframes chipCollect {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.3) translateY(-20px);
                opacity: 0.8;
            }
            100% {
                transform: scale(0) translateY(-50px);
                opacity: 0;
            }
        }

        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .current-turn {
            border: 2px solid #ffd700 !important;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5) !important;
        }
        /* Ïò§ÌîÑÎùºÏù∏ ÌîåÎ†àÏù¥Ïñ¥ Ïä§ÌÉÄÏùº */
        .all-player.offline {
            opacity: 0.6;
            border-color: #e74c3c !important;
            background: rgba(231, 76, 60, 0.1) !important;
        }
        
        .all-player.offline .all-player-name {
            color: #ff4444 !important;
        }
    </style>
</head>
<body>
         <div class="players-container">
                   <!-- ÏÉÅÎã®: Í≤åÏûÑ Ï†ïÎ≥¥ Î∞è ÏßÑÌñâ Îã®Í≥Ñ -->
          <div class="game-info">
              <div class="game-info-header">
                  <div class="room-info-compact">
                      üè† <span id="roomName"></span> | üë• <span id="playerCount">0</span>/8Î™Ö
                  </div>
                  <div class="game-phase" id="gamePhase">üéÆ Í≤åÏûÑ Îã®Í≥Ñ: -</div>
                  <div class="round-info">üîÑ ÎùºÏö¥Îìú: <span id="currentRound">-</span>/<span id="maxRounds">5</span></div>
                  <button id="backToLobbyBtn" class="btn btn-secondary" style="margin-left:1rem; padding:0.5rem 1rem;">Î°úÎπÑÎ°ú</button>
              </div>
              
                             <!-- Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Îì§ Ï†ïÎ≥¥ -->
               <div class="all-players" id="allPlayersList">
                   <div style="color: white; padding: 10px; text-align: center;">ÌîåÎ†àÏù¥Ïñ¥ ÏöîÏïΩÌëú (Î°úÎî© Ï§ë...)</div>
                   <!-- Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Îì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
               </div>
          </div>

        <!-- Í∏àÍ≥†/Í≤ΩÎ≥¥ Ïπ¥Ïö¥ÌÑ∞ (Í≤åÏûÑÌåêÍ≥º ÏöîÏïΩÌåê ÏÇ¨Ïù¥) -->
        <div class="heist-score-container visible" id="heistScoreContainer">
            <div class="heist-score-badge success">
                <span>‚úÖ SUCCESS:</span><span id="vaultCount">0</span>
            </div>
            <div class="heist-score-badge fail">
                <span>‚ùå FAIL:</span><span id="alarmCount">0</span>
            </div>
        </div>

        <!-- Ï§ëÏïô: Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú Î∞è Í≤åÏûÑ ÏöîÏÜåÎì§ -->
        <div class="game-center">
            <div class="community-cards" id="communityCards"></div>

            <!-- ÏáºÎã§Ïö¥ UI -->
            <div class="showdown-container" id="showdownContainer">
                <div id="showdownPlayersContainer">
                    <!-- ÏáºÎã§Ïö¥ ÌîåÎ†àÏù¥Ïñ¥ ÌñâÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                </div>
                <div class="showdown-confirm-section" id="showdownConfirmSection">
                    <button class="confirm-button" id="confirmShowdownBtn">ÌôïÏù∏</button>
                    <div class="confirm-progress" id="confirmProgress"></div>
                </div>
            </div>

            <!-- Ïπ¥ÏßÄÎÖ∏ Ïπ© ÏòÅÏó≠ -->
            <div class="casino-chips-container" id="casinoChipsContainer">
                <div class="chips-stack">
                    <!-- Ïπ©Îì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                </div>
            </div>
            
            <div class="game-message" id="gameMessage">Í≤åÏûÑÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§.</div>
        </div>
        
                <!-- ÌïòÎã®: ÎÇ¥ ÌîåÎ†àÏù¥Ïñ¥ ÏòÅÏó≠ -->
        <div class="my-player-area" id="myPlayerArea">
            <div class="my-content-area">
                <div class="my-player-header">
                    <div class="my-player-name" id="myPlayerName">ÎÇ¥ Ï†ïÎ≥¥</div>
                    <div class="my-player-status">
                        <span class="card-status-icon" id="myCardStatus">‚è≥</span>
                    </div>
                </div>
                
                <div class="my-cards" id="myCards">
                    <!-- ÎÇ¥ Ïπ¥ÎìúÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
                
                <div class="my-chips" id="myChips">
                    <!-- ÎÇ¥ Ïπ©Îì§Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
                
                <!-- Ïò§Î•∏Ï™Ω ÏÉÅÎã®Ïóê ÏúÑÏπòÌï† Î≤ÑÌäº -->
                <div class="my-controls-area">
                    <div class="game-controls">
                        <button class="btn btn-secondary" id="passBtn" onclick="pass()" style="display: none;">Ìå®Ïä§</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ÌÉàÏ£º ÌôïÏù∏ Î™®Îã¨ -->
    <div id="leaveModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
        <div style="background:white; color:#222; padding:2rem; border-radius:16px; min-width:300px; text-align:center;">
            <p style="margin-bottom:2rem; font-size:1.2rem;">Ï†ïÎßê ÌÉàÏ£ºÌïòÏãúÍ≤†ÏäµÎãàÍπå?</p>
            <button id="confirmLeaveBtn" class="btn btn-danger" style="margin-right:1rem;">ÎÑ§, ÌÉàÏ£º</button>
            <button id="cancelLeaveBtn" class="btn btn-success">Ï∑®ÏÜå</button>
        </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
    let socket;
    let currentPlayer = null;
    let gameState = {
        players: [],
        currentPlayer: null,
        phase: 'playing',
        roomId: null,
        pot: 0,
        isMyTurn: false,
        communityCards: [],
        collectedChips: []
    };
    let isMyTurn = true; // Ïã§ÏãúÍ∞Ñ Í≤åÏûÑÏúºÎ°ú Î≥ÄÍ≤Ω - Ìï≠ÏÉÅ Ïï°ÏÖò Í∞ÄÎä•
    let isAdmin = false;
    
    // URL ÌååÎùºÎØ∏ÌÑ∞Î•º Ï†ÑÏó≠ÏóêÏÑú Ìïú Î≤àÎßå ÏÑ†Ïñ∏
    const urlParams = new URLSearchParams(window.location.search);
    
    // ÏùºÎ∞ò ÏÇ¨Ïö©ÏûêÏö©ÏúºÎ°ú ÏàòÏ†ïÎêú Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
    async function checkAdminStatus() {
        return false; // ÏùºÎ∞ò ÏÇ¨Ïö©ÏûêÎäî Í¥ÄÎ¶¨ÏûêÍ∞Ä ÏïÑÎãò
    }
    
    function connectSocket() {
        console.log('\n=== [SOCKET CONNECTION START] ===');
        socket = io();
        
        socket.on('connect', async () => {
            console.log('[SOCKET] Successfully connected with ID:', socket.id);
            
            // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ Î∞è Îì±Î°ù
            try {
                const response = await fetch('/api/user');
                
                if (response.ok) {
                    const userData = await response.json();
                    
                    if (userData && userData.username) {
                        console.log('[USER] ÏÇ¨Ïö©Ïûê Îì±Î°ù ÏãúÎèÑ:', userData.username);
                        
                        if (socket.connected) {
                            socket.emit('registerUser', userData.username);
                        }
                    }
                }
            } catch (error) {
                console.error('ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®:', error);
            }
            
            // URLÏóêÏÑú roomId Í∞ÄÏ†∏ÏôÄÏÑú Î∞© Ï∞∏Ïó¨
            const roomId = urlParams.get('roomId');
            console.log('[ROOM] Attempting to join room:', roomId);
            
            if (roomId) {
                console.log('[ROOM] Sending joinRoom event for:', roomId);
                socket.emit('joinRoom', { roomId: roomId });
            } else {
                console.log('[ROOM] No roomId in URL, staying in lobby');
            }
        });
        
        // ÏÜåÏºì Ïó∞Í≤∞ Ïã§Ìå® Ïãú Ïû¨Ïó∞Í≤∞
        socket.on('connect_error', (error) => {
            console.error('ÏÜåÏºì Ïó∞Í≤∞ Ïã§Ìå®:', error);
            setTimeout(() => {
                console.log('ÏÜåÏºì Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ...');
                socket.connect();
            }, 2000);
        });
        
        socket.on('gameState', (state) => {
            updateGameState(state);
        });
        
                 // Ïπ© ÏàòÏßë Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
         socket.on('chipCollected', (data) => {
             console.log('Ïπ© ÏàòÏßë Ïù¥Î≤§Ìä∏:', data);
             
             // Í≤åÏûÑ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
             if (gameState) {
                 // ÏÑúÎ≤ÑÏóêÏÑú Î∞õÏùÄ Îç∞Ïù¥ÌÑ∞Î°ú collectedChips ÏóÖÎç∞Ïù¥Ìä∏
                 if (data.remainingChips && Array.isArray(data.remainingChips)) {
                     gameState.collectedChips = data.remainingChips;
                 } else if (data.chipIndex !== undefined) {
                     // remainingChipsÍ∞Ä ÏóÜÏúºÎ©¥ ÌòÑÏû¨ Ïπ© Ïù∏Îç±Ïä§ Ï∂îÍ∞Ä
                     if (!gameState.collectedChips) {
                         gameState.collectedChips = [];
                     }
                     if (!gameState.collectedChips.includes(data.chipIndex)) {
                         gameState.collectedChips.push(data.chipIndex);
                     }
                 }
                 
                 console.log('Ïπ© ÏàòÏßë ÌõÑ gameState.collectedChips ÏóÖÎç∞Ïù¥Ìä∏:', gameState.collectedChips);
             }
             
             // Ïπ¥ÏßÄÎÖ∏ Ïπ© UI ÏóÖÎç∞Ïù¥Ìä∏
             const collectedChips = gameState?.collectedChips || [];
             // updateCasinoChips(gameState?.players?.length || 2, collectedChips); // ÎπÑÌôúÏÑ±Ìôî: updateCenterChips ÏÇ¨Ïö©
             
             // ÏöîÏïΩÏ∞Ω ÏóÖÎç∞Ïù¥Ìä∏Î•º ÏúÑÌï¥ ÌîåÎ†àÏù¥Ïñ¥ Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
             if (gameState && gameState.players) {
                 console.log('Ïπ© ÏàòÏßë ÌõÑ ÌîåÎ†àÏù¥Ïñ¥ Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë');
                 updatePlayers(gameState.players);
                 console.log('Ïπ© ÏàòÏßë ÌõÑ ÌîåÎ†àÏù¥Ïñ¥ Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
             }
             
             // ÎÇ¥ ÌîåÎ†àÏù¥Ïñ¥ Ï†ïÎ≥¥ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏ (Ïπ© ÏàòÏßë ÏÉÅÌÉú Î∞òÏòÅ)
             const currentUsername = socket.data?.username || localStorage.getItem('username') || 
                                    sessionStorage.getItem('username') || window.currentUser;
             const myPlayer = gameState?.players?.find(p => p.username === currentUsername);
             if (myPlayer) {
                 console.log('Ïπ© ÏàòÏßë ÌõÑ ÎÇ¥ ÌîåÎ†àÏù¥Ïñ¥ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë');
                 updateMyPlayer(myPlayer);
                 console.log('Ïπ© ÏàòÏßë ÌõÑ ÎÇ¥ ÌîåÎ†àÏù¥Ïñ¥ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
             }
             
             // Ïª®Ìä∏Î°§ ÏóÖÎç∞Ïù¥Ìä∏
             updateControls();
             
             // Î©îÏãúÏßÄ ÌëúÏãú
             showMessage(`${data.collectedBy}ÎãòÏù¥ Ïπ© ${data.chipIndex + 1}ÏùÑ ÏàòÏßëÌñàÏäµÎãàÎã§!`);
             
             console.log('Ïπ© ÏàòÏßë Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨ ÏôÑÎ£å');
         });
        
        // ÌîåÎûç Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
        socket.on('flopDealt', (data) => {
            console.log('ÌîåÎûç Ïù¥Î≤§Ìä∏:', data);
            
            if (data.gameState) {
                updateGameState(data.gameState);
            }
            
            showMessage(data.message || 'ÌîåÎûçÏù¥ Í≥µÍ∞úÎêòÏóàÏäµÎãàÎã§!');
        });
        
        socket.on('gameMessage', (message) => {
            showMessage(message);
        });
        
        socket.on('gameOver', (result) => {
            showGameOver(result);
        });
        
        socket.on('cardsDealt', (data) => {
            console.log('Í∞úÎ≥Ñ Ïπ¥Îìú Î∂ÑÎ∞∞ ÏôÑÎ£å:', data);
            updateGameState(data.gameState);
            showMessage(data.message || 'Ïπ¥ÎìúÎ•º Î∞õÏïòÏäµÎãàÎã§!');
            
            // Ïπ¥ÎìúÎ•º Î∞õÏïòÏúºÎØÄÎ°ú Î≤ÑÌäºÏùÑ Ìå®Ïä§ Î™®ÎìúÎ°ú Ï†ÑÌôò
            switchToPassMode();
        });
        
        // Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Ïπ¥ÎìúÎ•º Î∞õÏïòÏùÑ Îïå
        socket.on('playerReceivedCards', (data) => {
            console.log('Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥ Ïπ¥Îìú Î∞õÍ∏∞:', data);
            updateGameState(data.gameState);
            showMessage(data.message || `${data.playerName}ÎãòÏù¥ Ïπ¥ÎìúÎ•º Î∞õÏïòÏäµÎãàÎã§!`);
            
            // Î≥∏Ïù∏Ïù¥ ÏïÑÏßÅ Ïπ¥ÎìúÎ•º Î∞õÏßÄ ÏïäÏùÄ Í≤ΩÏö∞ÏóêÎßå ÏßÑÌñâ ÏÉÅÌô© ÌëúÏãú
            const gameActionBtn = document.getElementById('gameActionBtn');
            if (gameActionBtn && data.gameState && gameActionMode === 'deal') {
                const progress = `${data.gameState.playersWithCards}/${data.gameState.totalPlayers}`;
                if (data.gameState.playersWithCards < data.gameState.totalPlayers) {
                    gameActionBtn.textContent = `Ïπ¥Îìú Î∞õÍ∏∞ (${progress})`;
                }
            }
            
            console.log('Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥ Ïπ¥Îìú Î∞õÍ∏∞ Ï≤òÎ¶¨ ÏôÑÎ£å - Î≥∏Ïù∏ Î≤ÑÌäº ÏÉÅÌÉú:', {
                mode: gameActionMode,
                textContent: gameActionBtn?.textContent
            });
        });
        
        // Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Ïπ¥ÎìúÎ•º Î∞õÏùÄ ÌõÑ Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú Í≥µÍ∞ú
        socket.on('communityCardsRevealed', (data) => {
            console.log('Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú Í≥µÍ∞ú Ïù¥Î≤§Ìä∏ ÏàòÏã†:', data);
            console.log('ÏàòÏã†Îêú Í≤åÏûÑ ÏÉÅÌÉúÏùò Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú:', data.gameState?.communityCards);
            console.log('ÏàòÏã†Îêú Î∞© ÏÉÅÌÉúÏùò Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú:', data.room?.communityCards);
            
            updateGameState(data.gameState);
            showMessage(data.message || 'Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥ÎìúÍ∞Ä Í≥µÍ∞úÎêòÏóàÏäµÎãàÎã§!');
            
            // ÌòÑÏû¨ ÎùºÏö¥Îìú Ï¢ÖÎ£å - Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäº Ïà®ÍπÄ
            // Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäº Ï†úÍ±∞Îê®
            // const dealCardsBtn = document.getElementById('dealCardsBtn');
            // Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäº Ï†úÍ±∞Îê®
            if (false && dealCardsBtn) {
                dealCardsBtn.style.display = 'none'; // Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥ÎìúÍ∞Ä Í≥µÍ∞úÎêòÎ©¥ Ïà®ÍπÄ
            }
            
            // Îã§Ïùå ÎùºÏö¥ÎìúÎ•º ÏúÑÌï¥ Ïπ¥Îìú Î∞õÍ∏∞ ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî (ÌïòÏßÄÎßå Î≤ÑÌäºÏùÄ ÏÉà ÎùºÏö¥Îìú ÏãúÏûë ÏãúÍπåÏßÄ Ïà®ÍπÄ)
            cardsDealRequested = false;
        });
        
        socket.on('disconnect', (reason) => {
            console.log('Í≤åÏûÑ ÏÜåÏºì Ïó∞Í≤∞Ïù¥ ÎÅäÏñ¥Ï°åÏäµÎãàÎã§. Ïù¥Ïú†:', reason);
        });
        
        // ÏûêÎèô ÏÇ¨Ïö©Ïûê Í≤åÏûÑ ÏãúÏûë Ïù¥Î≤§Ìä∏
        socket.on('autoStartUserGame', (data) => {
            console.log('ÏûêÎèô ÏÇ¨Ïö©Ïûê Í≤åÏûÑ ÏãúÏûë:', data);
            showMessage(data.message || 'ÏÉà Í≤åÏûÑÏùÑ ÏãúÏûëÌï©ÎãàÎã§...');
            
            // ÏÇ¨Ïö©Ïûê Í≤åÏûÑ ÏãúÏûë Ìò∏Ï∂ú
            setTimeout(() => {
                socket.emit('startUserGame', { roomId: data.roomId });
            }, 500);
        });
        
        // Î∞© Ïû¨Ï∞∏Ïó¨ ÏÑ±Í≥µ Ïù¥Î≤§Ìä∏
        socket.on('roomRejoinSuccess', (data) => {
            console.log('Î∞© Ïû¨Ï∞∏Ïó¨ ÏÑ±Í≥µ:', data);
            if (data.roomId) {
                console.log('Ïû¨Ï∞∏Ïó¨Ìïú roomIdÎ°ú Í≤åÏûÑ ÏÉÅÌÉú ÏÑ§Ï†ï:', data.roomId);
                // gameStateÏóê roomId ÏÑ§Ï†ï
                if (gameState) {
                    gameState.roomId = data.roomId;
                } else {
                    gameState = { roomId: data.roomId };
                }
                
                // Î∞©Ïóê Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Í∞Ä ÏûàÏúºÎ©¥ Î©ÄÌã∞ÌîåÎ†àÏù¥Ïñ¥ Î™®Îìú
                const playerCount = data.room?.players?.length || 1;
                showMessage(`Î∞©Ïóê Ïû¨Ï∞∏Ïó¨ÌñàÏäµÎãàÎã§. (${playerCount}Î™ÖÏùò ÌîåÎ†àÏù¥Ïñ¥)`);
                
                // Í≤åÏûÑ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                if (data.room) {
                    updateGameState({
                        roomId: data.room.id,
                        players: data.room.players,
                        phase: data.room.phase || 'playing',
                        communityCards: data.room.communityCards || [],
                        currentRound: data.room.currentRound || 1,
                        maxRounds: data.room.maxRounds || 5,
                        pot: data.room.pot || 0
                    });
                }
                
                // ÏÇ¨Ïö©Ïûê Í≤åÏûÑ ÏãúÏûë Ïù¥Î≤§Ìä∏ Î∞úÏÉù
                socket.emit('startUserGame', { roomId: data.roomId });
            }
        });
        
        // Í≤åÏûÑ Î∞© Ï∞æÍ∏∞/ÏÉùÏÑ± ÏôÑÎ£å Ïù¥Î≤§Ìä∏
        socket.on('gameRoomFound', (data) => {
            console.log('Í≤åÏûÑ Î∞© Ï∞æÍ∏∞/ÏÉùÏÑ± ÏôÑÎ£å:', data);
            if (data.roomId) {
                console.log('Ï∞æÍ±∞ÎÇò ÏÉùÏÑ±Îêú roomIdÎ°ú Í≤åÏûÑ ÏÉÅÌÉú ÏÑ§Ï†ï:', data.roomId);
                // gameStateÏóê roomId ÏÑ§Ï†ï
                if (gameState) {
                    gameState.roomId = data.roomId;
                } else {
                    gameState = { roomId: data.roomId };
                }
                
                // Î∞©Ïóê Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Í∞Ä ÏûàÏúºÎ©¥ Î©ÄÌã∞ÌîåÎ†àÏù¥Ïñ¥ Î™®Îìú
                const playerCount = data.room?.players?.length || 1;
                if (playerCount > 1) {
                    showMessage(`${playerCount}Î™ÖÏùò ÌîåÎ†àÏù¥Ïñ¥ÏôÄ Ìï®Íªò Í≤åÏûÑÏùÑ ÏãúÏûëÌï©ÎãàÎã§!`);
                } else {
                    showMessage('Í≤åÏûÑ Î∞©Ïù¥ Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§. Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî.');
                }
                
                // ÏÇ¨Ïö©Ïûê Í≤åÏûÑ ÏãúÏûë Ïù¥Î≤§Ìä∏ Î∞úÏÉù
                socket.emit('startUserGame', { roomId: data.roomId });
            }
        });
        
        // ÌîåÎ†àÏù¥Ïñ¥ Ï∞∏Ïó¨ Ïù¥Î≤§Ìä∏
        socket.on('playerJoined', (data) => {
            console.log('ÏÉà ÌîåÎ†àÏù¥Ïñ¥ Ï∞∏Ïó¨:', data);
            
            // gameStateÍ∞Ä ÏûàÏúºÎ©¥ Î∞îÎ°ú ÏóÖÎç∞Ïù¥Ìä∏
            if (data.gameState) {
                updateGameState(data.gameState);
                showMessage(`${data.username}ÎãòÏù¥ Í≤åÏûÑÏóê Ï∞∏Ïó¨ÌñàÏäµÎãàÎã§!`);
            } else if (data.room) {
                // Í∏∞Ï°¥ Î∞©Ïãù Ìò∏ÌôòÏÑ± Ïú†ÏßÄ
                updateGameState({
                    roomId: data.room.id,
                    players: data.room.players,
                    phase: data.room.phase || 'playing',
                    communityCards: data.room.communityCards || [],
                    currentRound: data.room.currentRound || 1,
                    maxRounds: data.room.maxRounds || 5,
                    pot: data.room.pot || 0
                });
                showMessage(`${data.player?.username || data.username}ÎãòÏù¥ Í≤åÏûÑÏóê Ï∞∏Ïó¨ÌñàÏäµÎãàÎã§!`);
            } else {
                showMessage(`${data.username}ÎãòÏù¥ Í≤åÏûÑÏóê Ï∞∏Ïó¨ÌñàÏäµÎãàÎã§!`);
            }
        });
        
        // Í¥ÄÎ¶¨Ïûê Î∞© ÏÉùÏÑ± ÏôÑÎ£å Ïù¥Î≤§Ìä∏ (Í¥ÄÎ¶¨Ïûê Ï†ÑÏö©)
        socket.on('adminRoomCreated', (data) => {
            console.log('Í¥ÄÎ¶¨Ïûê Î∞© ÏÉùÏÑ± ÏôÑÎ£å:', data);
            if (data.roomId) {
                console.log('ÏÉùÏÑ±Îêú roomIdÎ°ú Í≤åÏûÑ ÏÉÅÌÉú ÏÑ§Ï†ï:', data.roomId);
                // gameStateÏóê roomId ÏÑ§Ï†ï
                if (gameState) {
                    gameState.roomId = data.roomId;
                }
                showMessage('Í¥ÄÎ¶¨Ïûê Î∞©Ïù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§. Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî.');
            }
        });
        
        // Í≤åÏûÑ ÏãúÏûë Ïù¥Î≤§Ìä∏
        socket.on('gameStarted', (data) => {
            console.log('Í≤åÏûÑ ÏãúÏûë:', data);
            
            // roomId ÏÑ§Ï†ï (Ïö∞ÏÑ†ÏàúÏúÑ: data.roomId > data.gameState.roomId)
            const roomId = data.roomId || data.gameState?.roomId;
            if (roomId) {
                console.log('Í≤åÏûÑ ÏãúÏûë Ïãú roomId ÏÑ§Ï†ï:', roomId);
                if (gameState) {
                    gameState.roomId = roomId;
                } else {
                    gameState = { roomId: roomId };
                }
            } else {
                console.error('Í≤åÏûÑ ÏãúÏûë Ïù¥Î≤§Ìä∏Ïóê roomIdÍ∞Ä ÏóÜÏäµÎãàÎã§!', data);
            }
            
            // collectedChips Ï¥àÍ∏∞Ìôî
            if (data.gameState) {
                data.gameState.collectedChips = [];
            }
            
            // Ïπ¥Îìú Î∞õÍ∏∞ ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            cardsDealRequested = false;
            
            // Î≤ÑÌäºÏùÑ Ïπ¥Îìú Î∞õÍ∏∞ Î™®ÎìúÎ°ú Î¶¨ÏÖã
            resetToDealMode();
            
            updateGameState(data.gameState);
            
            // Î∞© Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            if (data.room) {
                updateRoomInfo(data.room);
            }
            
            // ÌîåÎ†àÏù¥Ïñ¥ ÏàòÎäî Ïã§Ï†ú Í≤åÏûÑ ÏÉÅÌÉúÏóêÏÑú ÏóÖÎç∞Ïù¥Ìä∏Îê®
            
            // Í≤åÏûÑ ÏÉÅÌÉúÎ•º playingÏúºÎ°ú ÏÑ§Ï†ï
            if (data.gameState) {
                data.gameState.phase = 'playing';
            }
            
            showMessage('Í≤åÏûÑÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§! Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Í∞Ä ÎèôÏãúÏóê Ïπ¥ÎìúÎ•º Î∞õÏùÑ Ïàò ÏûàÏäµÎãàÎã§.');
            
            // Í≤åÏûÑ ÏãúÏûë ÌõÑ Ï¶âÏãú Î™®Îì† ÏÇ¨Ïö©ÏûêÏùò Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäº ÌôúÏÑ±Ìôî
            setTimeout(() => {
                updateControls();
                // Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäº ÏÉÅÌÉú Î≥µÏõê (Î™®Îì† ÏÇ¨Ïö©Ïûê ÎèôÏãú ÌôúÏÑ±Ìôî)
                // Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäº Ï†úÍ±∞Îê®
            // const dealCardsBtn = document.getElementById('dealCardsBtn');
                // Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäº Ï†úÍ±∞Îê®
            if (false && dealCardsBtn) {
                    dealCardsBtn.disabled = false;
                    dealCardsBtn.textContent = 'Ïπ¥Îìú Î∞õÍ∏∞';
                    dealCardsBtn.style.display = 'inline-block';
                }
            }, 100);
        });
        
        // ÏÇ¨Ïö©Ïûê Îì±Î°ù ÏÑ±Í≥µ Ïù¥Î≤§Ìä∏ (ÏùºÎ∞ò ÏÇ¨Ïö©ÏûêÏö©ÏúºÎ°ú ÏàòÏ†ï)
        socket.on('registerUserSuccess', (data) => {
            console.log('ÏÇ¨Ïö©Ïûê Îì±Î°ù ÏÑ±Í≥µ', data);
            
            // ÏÇ¨Ïö©ÏûêÎ™ÖÏùÑ Ïó¨Îü¨ ÏúÑÏπòÏóê ÏïàÏ†ÑÌïòÍ≤å Ï†ÄÏû•
            if (data && data.username) {
                localStorage.setItem('username', data.username);
                sessionStorage.setItem('username', data.username);
                window.currentUser = data.username;
                console.log('ÏÇ¨Ïö©ÏûêÎ™Ö Ï†ÄÏû• ÏôÑÎ£å:', data.username);
            } else {
                // URLÏóêÏÑú ÏÇ¨Ïö©ÏûêÎ™Ö Ï∂îÏ∂ú (fallback)
                // urlParamsÎäî Ï†ÑÏó≠ÏóêÏÑú ÏÑ†Ïñ∏Îê®
                const urlUsername = urlParams.get('username');
                if (urlUsername) {
                    localStorage.setItem('username', urlUsername);
                    sessionStorage.setItem('username', urlUsername);
                    window.currentUser = urlUsername;
                    console.log('URLÏóêÏÑú ÏÇ¨Ïö©ÏûêÎ™Ö Ï∂îÏ∂ú:', urlUsername);
                }
            }
            
            // URLÏóêÏÑú roomId ÌôïÏù∏
            // urlParamsÎäî Ï†ÑÏó≠ÏóêÏÑú ÏÑ†Ïñ∏Îê®
            const urlRoomId = urlParams.get('roomId');
            
            if (urlRoomId) {
                console.log('URLÏóêÏÑú roomId Î∞úÍ≤¨, Í∏∞Ï°¥ Î∞©ÏúºÎ°ú Î≥µÍ∑Ä ÏãúÎèÑ:', urlRoomId);
                console.log('ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÎ™Ö:', data.username || window.currentUser);
                
                // gameStateÏóê roomId ÏÑ§Ï†ï
                if (gameState) {
                    gameState.roomId = urlRoomId;
                } else {
                    gameState = { roomId: urlRoomId };
                }
                
                // ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ ÌõÑ Ïû¨ÏûÖÏû• ÏöîÏ≤≠ (ÏÑúÎ≤ÑÏóêÏÑú Îì±Î°ù Ï≤òÎ¶¨ ÏôÑÎ£å ÎåÄÍ∏∞)
                setTimeout(() => {
                    console.log('rejoinRoom Ïù¥Î≤§Ìä∏ Ï†ÑÏÜ° - roomId:', urlRoomId);
                    socket.emit('rejoinRoom', { roomId: urlRoomId });
                }, 500);
            } else {
                console.log('URLÏóê roomId ÏóÜÏùå, ÏÉà Í≤åÏûÑ Ï∞æÍ∏∞/ÏÉùÏÑ±');
                // ÏÉà Í≤åÏûÑ Ï∞æÍ∏∞/ÏÉùÏÑ± (Í¥ÄÎ¶¨Ïûê Í≤åÏûÑÏù¥ ÏïÑÎãò)
                setTimeout(() => {
                    socket.emit('findOrCreateGameRoom', {});
                }, 1000);
            }
        });
        
        // ÏÉàÎ°úÏö¥ Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨Îì§ Ï∂îÍ∞Ä
        socket.on('rejoinRoomSuccess', (roomState) => {
            console.log('Î∞© Ïû¨ÏûÖÏû• ÏÑ±Í≥µ:', roomState);
            updateGameState(roomState);
            showMessage('Í≤åÏûÑÏóê Îã§Ïãú Ïó∞Í≤∞ÎêòÏóàÏäµÎãàÎã§.');
        });

        socket.on('gameStateUpdate', (roomState) => {
            console.log('\n=== [GAME STATE UPDATE] ===');
            console.log('Received roomState:', roomState);
            console.log('CenterChips in update:', roomState?.centerChips?.length);
            
            updateGameState(roomState);
            console.log('=== [GAME STATE UPDATE END] ===\n');
        });
        
        // Ï§ëÏïô Ïπ© Ï†ÑÏö© ÏóÖÎç∞Ïù¥Ìä∏ Ïù¥Î≤§Ìä∏
        socket.on('centerChipsUpdate', (data) => {
            console.log('\n=== [CENTER CHIPS UPDATE] ===');
            console.log('Received centerChips:', data.centerChips?.length);
            
            if (data.centerChips !== undefined) {
                gameState.centerChips = data.centerChips;
                updateCenterChips(data.centerChips);
            }
            
            console.log('=== [CENTER CHIPS UPDATE END] ===\n');
        });

        socket.on('redirectToLobby', (data) => {
            console.log('Î°úÎπÑÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏:', data);
            console.error('Í≤åÏûÑ ÌéòÏù¥ÏßÄ Ïò§Î•ò - Î°úÎπÑÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏Îê®:', data);
            if (data.message) {
                console.error('Ïò§Î•ò Î©îÏãúÏßÄ:', data.message);
                alert(data.message);
            }
            window.location.href = '/';
        });

        // ÏÜåÏºì Ïù¥Î≤§Ìä∏ ÌÖåÏä§Ìä∏
        socket.on('connect', () => {
            console.log('[SOCKET] Connected with ID:', socket.id);
        });
        
        socket.on('disconnect', () => {
            console.log('[SOCKET] Disconnected');
        });
        
        // Î™®Îì† Ïù¥Î≤§Ìä∏ Ï∫êÏπò (Socket Ï∞∏Ï°∞ Ïò§Î•ò ÏàòÏ†ï)
        const originalOnevent = socket.onevent;
        socket.onevent = function(packet) {
            console.log('[SOCKET EVENT]', packet.data[0], packet.data[1]);
            if (originalOnevent) {
                originalOnevent.call(this, packet);
            }
        };

        // Ïπ© Í∞ÄÏ†∏Í∞ÄÍ∏∞ Ïù¥Î≤§Ìä∏ - ÏôÑÏ†Ñ Ïû¨ÏûëÏÑ±
        socket.on('chipTaken', (data) => {
            console.log('\n=== [CLIENT CHIP TAKEN RECEIVED] ===');
            console.log('Socket ID:', socket.id);
            console.log('Received data:', data);
            console.log('Current gameState centerChips:', gameState.centerChips?.length);
            
            showMessage(data.message);
            
            // ÏÑúÎ≤ÑÏóêÏÑú Î∞õÏùÄ ÏµúÏã† Í≤åÏûÑ ÏÉÅÌÉúÎ°ú ÏôÑÏ†Ñ ÍµêÏ≤¥
            if (data.gameState) {
                console.log('[CLIENT] Updating with server gameState');
                console.log('Server centerChips:', data.gameState.centerChips?.length);
                console.log('Server players:', data.gameState.players?.length);
                
                // Ï†ÑÏ≤¥ Í≤åÏûÑ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                updateGameState(data.gameState);
            }
            
            console.log('=== [CLIENT CHIP TAKEN END] ===\n');
        });
        
        socket.on('chipsExchanged', (data) => {
            console.log('Ïπ© ÍµêÌôò Ïù¥Î≤§Ìä∏:', data);
            showMessage(data.message);
            
            // Ï§ëÏïô Ïπ© Ï¶âÏãú ÏóÖÎç∞Ïù¥Ìä∏
            if (data.centerChips) {
                updateCenterChips(data.centerChips);
            }
            
            if (data.gameState) {
                updateGameState(data.gameState);
            }
        });
        
        // Ìå®Ïä§ ÏÉÅÌÉú Ìï¥Ï†ú ÏïåÎ¶º Ï≤òÎ¶¨
        socket.on('passStatusReset', (data) => {
            console.log('Ìå®Ïä§ ÏÉÅÌÉú Ìï¥Ï†ú:', data);
            showMessage(data.message || 'Ïπ© Ï†ïÎ≥¥Í∞Ä Î≥ÄÍ≤ΩÎêòÏñ¥ Ìå®Ïä§Í∞Ä Ìï¥Ï†úÎêòÏóàÏäµÎãàÎã§.');
            
            // Ìå®Ïä§ Î≤ÑÌäº Îã§Ïãú ÌôúÏÑ±Ìôî
            const passBtn = document.getElementById('passBtn');
            if (passBtn) {
                passBtn.disabled = false;
            }
            
            // Ìå®Ïä§ Î≤ÑÌäº ÏóÖÎç∞Ïù¥Ìä∏
            updateControls();
        });

        // The Gang Í≤åÏûÑ Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨Îì§
        socket.on('round1Started', (data) => {
            console.log('1ÎùºÏö¥Îìú ÏãúÏûë:', data);
            updateGameState(data.gameState);
            showMessage(data.message);
            
            // ÎùºÏö¥Îìú Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            if (data.roundConfig) {
                updateGamePhase(`${data.roundConfig.name}: ${data.roundConfig.description}`);
            } else {
                updateGamePhase('1ÎùºÏö¥Îìú ÏßÑÌñâ Ï§ë');
            }
            
            // Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏ (1ÎùºÏö¥ÎìúÏóêÏÑúÎäî Îπà Î∞∞Ïó¥)
            if (data.communityCards !== undefined) {
                updateCommunityCards(data.communityCards);
            }
            
            // ÎùºÏö¥Îìú Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            if (data.round && data.maxRounds) {
                updateRoundInfo(data.round, data.maxRounds);
            }
        });

        // 2ÎùºÏö¥Îìú ÏãúÏûë Ïù¥Î≤§Ìä∏
        socket.on('round2Started', (data) => {
            console.log('2ÎùºÏö¥Îìú ÏãúÏûë:', data);
            updateGameState(data.gameState);
            showMessage(data.message);
            
            // Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
            if (data.communityCards !== undefined) {
                updateCommunityCards(data.communityCards);
            }
            
            // ÎùºÏö¥Îìú Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            updateGamePhase('2ÎùºÏö¥Îìú(Flop) ÏßÑÌñâ Ï§ë');
        });

        // 3ÎùºÏö¥Îìú ÏãúÏûë Ïù¥Î≤§Ìä∏
        socket.on('round3Started', (data) => {
            console.log('3ÎùºÏö¥Îìú ÏãúÏûë:', data);
            updateGameState(data.gameState);
            showMessage(data.message);
            
            // Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
            if (data.communityCards !== undefined) {
                updateCommunityCards(data.communityCards);
            }
            
            // ÎùºÏö¥Îìú Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            updateGamePhase('3ÎùºÏö¥Îìú(Turn) ÏßÑÌñâ Ï§ë');
        });

        // 4ÎùºÏö¥Îìú ÏãúÏûë Ïù¥Î≤§Ìä∏
        socket.on('round4Started', (data) => {
            console.log('4ÎùºÏö¥Îìú ÏãúÏûë:', data);
            updateGameState(data.gameState);
            showMessage(data.message);
            
            // Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
            if (data.communityCards !== undefined) {
                updateCommunityCards(data.communityCards);
            }
            
            // ÎùºÏö¥Îìú Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            updateGamePhase('4ÎùºÏö¥Îìú(River) ÏßÑÌñâ Ï§ë');
        });

        socket.on('yourTurn', (data) => {
            console.log('ÌÑ¥ ÏïåÎ¶º (Ïã§ÏãúÍ∞Ñ Í≤åÏûÑÏúºÎ°ú Ïù∏Ìï¥ Î¨¥Ïãú):', data);
            // Ïã§ÏãúÍ∞Ñ Í≤åÏûÑÏúºÎ°ú Î≥ÄÍ≤Ω - ÌÑ¥ Í∞úÎÖê Ï†úÍ±∞
            // isMyTurn = true;
            // showMessage(data.message);
            // updateActionButtons(data.availableActions);
            // updatePlayerTurnIndicators(getCurrentUsername());
        });

        socket.on('playerTurn', (data) => {
            console.log('ÌîåÎ†àÏù¥Ïñ¥ ÌÑ¥ ÏïåÎ¶º (Ïã§ÏãúÍ∞Ñ Í≤åÏûÑÏúºÎ°ú Ïù∏Ìï¥ Î¨¥Ïãú):', data);
            // Ïã§ÏãúÍ∞Ñ Í≤åÏûÑÏúºÎ°ú Î≥ÄÍ≤Ω - ÌÑ¥ Í∞úÎÖê Ï†úÍ±∞
            // isMyTurn = false;
            // showMessage(data.message);
            // updateActionButtons([]);
            // updatePlayerTurnIndicators(data.currentPlayer);
        });

        // Ï§ëÎ≥µ Ï†úÍ±∞ - Ïù¥ÎØ∏ ÏúÑÏóê Ï†ïÏùòÎêòÏñ¥ ÏûàÏùå

        socket.on('playerPassed', (data) => {
            console.log('ÌîåÎ†àÏù¥Ïñ¥ Ìå®Ïä§:', data);
            showMessage(data.message);
            // Í≤åÏûÑ ÏÉÅÌÉúÍ∞Ä ÏóÖÎç∞Ïù¥Ìä∏ÎêòÎ©¥ UIÎèÑ ÏûêÎèôÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏Îê† Í≤ÉÏûÑ
        });

        socket.on('roundEnded', (data) => {
            console.log('ÎùºÏö¥Îìú Ï¢ÖÎ£å:', data);
            showMessage(`${data.round}ÎùºÏö¥Îìú Ï¢ÖÎ£å: ${data.message}`);
            
            // Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Ïùò Ìå®Ïä§ ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            if (gameState && gameState.players) {
                gameState.players.forEach(player => {
                    player.hasPassed = false;
                });
                updatePlayers(gameState.players);
            }
        });

        socket.on('nextRoundStarted', (data) => {
            console.log('Îã§Ïùå ÎùºÏö¥Îìú ÏãúÏûë:', data);
            showMessage(data.message);
            
            // Í≤åÏûÑ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            updateGameState(data.gameState);
            updateRoundInfo(data.round, data.maxRounds);
            
            // Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
            if (data.communityCards) {
                updateCommunityCards(data.communityCards);
            }
            
            // ÎùºÏö¥Îìú Ï†ïÎ≥¥ ÌëúÏãú
            if (data.roundConfig) {
                const gamePhaseEl = document.getElementById('gamePhase');
                if (gamePhaseEl) {
                    gamePhaseEl.textContent = `üéÆ ${data.roundConfig.name}: ${data.roundConfig.description}`;
                }
            }
        });

        socket.on('showdownResult', (data) => {
            console.log('ÏáºÎã§Ïö¥ Í≤∞Í≥º:', data);
            renderShowdown(data);
        });

        socket.on('showdownConfirmUpdate', (data) => {
            console.log('ÏáºÎã§Ïö¥ ÌôïÏù∏ ÏóÖÎç∞Ïù¥Ìä∏:', data);
            const progressEl = document.getElementById('confirmProgress');
            if (progressEl) {
                progressEl.textContent = `ÎåÄÍ∏∞Ï§ë: ${data.confirmed}/${data.total}Î™Ö ÌôïÏù∏`;
            }
        });

        socket.on('gameEnded', (data) => {
            console.log('Í≤åÏûÑ Ï¢ÖÎ£å:', data);

            // ÌåÄ Í≤∞Í≥º ÌëúÏãú
            let resultMessage = '\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n';

            if (data.victory) {
                resultMessage += 'üéâ Ï∂ïÌïòÌï©ÎãàÎã§! ÌåÄ ÏäπÎ¶¨!\n';
                resultMessage += `‚úÖ Í∏àÍ≥† ${data.totalVaults}Í∞ú ÌöçÎìù\n`;
                showMessage('üéâ ÌåÄ ÏäπÎ¶¨!');
            } else {
                resultMessage += 'üí• ÏïÑÏâΩÏäµÎãàÎã§! ÌåÄ Ìå®Î∞∞...\n';
                resultMessage += `‚ùå Í≤ΩÎ≥¥ ${data.totalAlarms}Ìöå Î∞úÏÉù\n`;
                showMessage('üí• ÌåÄ Ìå®Î∞∞...');
            }

            resultMessage += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n';

            // ÌïòÏù¥Ïä§Ìä∏Î≥Ñ Í≤∞Í≥º ÏöîÏïΩ
            resultMessage += 'üìä ÌïòÏù¥Ïä§Ìä∏ Í≤∞Í≥º:\n';
            if (data.heistHistory && data.heistHistory.length > 0) {
                data.heistHistory.forEach((heist) => {
                    const icon = heist.success ? '‚úÖ' : '‚ùå';
                    resultMessage += `${icon} ÌïòÏù¥Ïä§Ìä∏ ${heist.heistNumber}: ${heist.success ? 'ÏÑ±Í≥µ' : 'Ïã§Ìå®'}\n`;

                    // Í∞Å ÌïòÏù¥Ïä§Ìä∏Ïùò Ïπ© ÏàúÏÑú ÌëúÏãú
                    if (heist.chipOrder && heist.chipOrder.length > 0) {
                        const chipOrderStr = heist.chipOrder
                            .map(p => `${p.username}(${p.chipStars}Î≥Ñ)`)
                            .join(' ‚Üí ');
                        resultMessage += `   Ïπ©: ${chipOrderStr}\n`;
                    }
                });
            } else {
                resultMessage += '   (Í∏∞Î°ù ÏóÜÏùå)\n';
            }

            resultMessage += '\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n';

            console.log(resultMessage);
            alert(resultMessage);

            // Î°úÎπÑÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞ Î≤ÑÌäº ÌëúÏãú
            const backBtn = document.getElementById('backToLobbyBtn');
            if (backBtn) {
                backBtn.style.display = 'inline-block';
                backBtn.textContent = 'Í≤åÏûÑ Ï¢ÖÎ£å - Î°úÎπÑÎ°ú';
            }
        });

        socket.on('round1Ended', (data) => {
            console.log('1ÎùºÏö¥Îìú Ï¢ÖÎ£å:', data);
            updateGameState(data.finalState);
            showMessage(data.message);
            updateGamePhase('1ÎùºÏö¥Îìú ÏôÑÎ£å');
        });

        // Í≤åÏûÑ Ï§ëÏßÄ Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
        socket.on('gameStopped', (data) => {
            console.log('Í≤åÏûÑ Ï§ëÏßÄ:', data);
            updateGameState(data.gameState);
            showMessage(`üõë ${data.message}`, 'danger');
            updateGamePhase('Í≤åÏûÑ Ï§ëÏßÄÎê®');
            
            // Ï¶âÏãú ÏïåÎ¶ºÏùÑ Î≥¥Ïó¨Ï£ºÍ≥† 3Ï¥à ÌõÑ Î°úÎπÑÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏
            alert(`üõë ${data.message}\n\n3Ï¥à ÌõÑ Î°úÎπÑÎ°ú ÎèåÏïÑÍ∞ëÎãàÎã§.`);
            setTimeout(() => {
                window.location.href = '/';
            }, 3000);
        });

        // ÌîåÎ†àÏù¥Ïñ¥ Ïó∞Í≤∞ ÎÅäÍπÄ Ïù¥Î≤§Ìä∏
        socket.on('playerDisconnected', (data) => {
            console.log('ÌîåÎ†àÏù¥Ïñ¥ Ïó∞Í≤∞ ÎÅäÍπÄ:', data);
            if (data.gameState) {
                updateGameState(data.gameState);
            }
            showMessage(data.message, 'warning');
        });
        
        // ÌîåÎ†àÏù¥Ïñ¥ Ïû¨Ïó∞Í≤∞ Ïù¥Î≤§Ìä∏
        socket.on('playerReconnected', (data) => {
            console.log('ÌîåÎ†àÏù¥Ïñ¥ Ïû¨Ïó∞Í≤∞:', data);
            if (data.gameState) {
                updateGameState(data.gameState);
            }
            showMessage(data.message, 'success');
        });
        
        // ÌîåÎ†àÏù¥Ïñ¥ Ìá¥Ïû• Ïù¥Î≤§Ìä∏
        socket.on('playerLeft', (data) => {
            console.log('ÌîåÎ†àÏù¥Ïñ¥ Ìá¥Ïû•:', data);
            if (data.gameState) {
                updateGameState(data.gameState);
            }
            showMessage(`${data.username}ÎãòÏù¥ Î∞©ÏùÑ ÎÇòÍ∞îÏäµÎãàÎã§.`, 'info');
        });

        socket.on('error', (data) => {
            console.error('ÏÜåÏºì Ïò§Î•ò:', data);
            if (data.message) {
                console.error('Ïò§Î•ò Î©îÏãúÏßÄ:', data.message);
                showMessage(data.message, 'error');
                
                // Ïπ© Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå® Ïãú UI Î≥µÍµ¨
                if (data.message.includes('Ïπ©') && data.message.includes('Í∞ÄÏ†∏')) {
                    // ÏÑúÎ≤ÑÏóêÏÑú ÏµúÏã† ÏÉÅÌÉú ÏöîÏ≤≠
                    socket.emit('requestGameState', { roomId: gameState.roomId });
                }
            }
        });

        // Î∞© Ìè≠Ìåå ÏïåÎ¶º
        socket.on('roomDestroyed', (data) => {
            console.log('[Room Destroyed]', data);
            showMessage(`üí• ${data.message}`, 'warning');
            
            // 3Ï¥à ÌõÑ Î°úÎπÑÎ°ú ÏûêÎèô Ïù¥Îèô
            setTimeout(() => {
                alert(`Î∞©Ïù¥ Ìè≠ÌååÎêòÏñ¥ Î°úÎπÑÎ°ú ÎèåÏïÑÍ∞ëÎãàÎã§.`);
                window.location.href = '/';
            }, 3000);
        });

        socket.on('gameStarted', (data) => {
            console.log('Í≤åÏûÑÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§:', data);
            if (data.gameId) {
                gameState.gameId = data.gameId;
            }
            showMessage('Í≤åÏûÑÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§! 1ÎùºÏö¥ÎìúÍ∞Ä Í≥ß ÏãúÏûëÎê©ÎãàÎã§...');
            updateGamePhase('Í≤åÏûÑ ÏãúÏûë');
        });
    }
    
    function updateGameState(state) {
        console.log('updateGameState Ìò∏Ï∂úÎê®:', state);
        
        // stateÍ∞Ä ÏóÜÏúºÎ©¥ Î¶¨ÌÑ¥
        if (!state) {
            console.error('[updateGameState] stateÍ∞Ä undefinedÏûÖÎãàÎã§');
            return;
        }
        
        // roomId Î≥¥Ï°¥
        const existingRoomId = gameState?.roomId;
        
        // gameStateÍ∞Ä ÏóÜÏúºÎ©¥ Îπà Í∞ùÏ≤¥Î°ú Ï¥àÍ∏∞Ìôî
        if (!gameState) {
            gameState = {};
        }
        
        // stateÎ•º gameStateÏóê Î≥ëÌï©
        Object.assign(gameState, state);
        
        // roomIdÍ∞Ä ÏóÜÏúºÎ©¥ Í∏∞Ï°¥ Í∞í ÎòêÎäî URLÏóêÏÑú Í∞ÄÏ†∏Ïò§Í∏∞
        if (!gameState.roomId && existingRoomId) {
            gameState.roomId = existingRoomId;
        } else if (!gameState.roomId) {
            // urlParamsÎäî Ï†ÑÏó≠ÏóêÏÑú ÏÑ†Ïñ∏Îê®
            const urlRoomId = urlParams.get('roomId');
            if (urlRoomId) {
                gameState.roomId = urlRoomId;
            }
        }

        // The Gang Í≤åÏûÑ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        if (state.centerChips !== undefined) {  // Îπà Î∞∞Ïó¥ÎèÑ Ï≤òÎ¶¨ÌïòÎèÑÎ°ù ÏàòÏ†ï
            console.log('[updateGameState] Ï§ëÏïô Ïπ© ÏóÖÎç∞Ïù¥Ìä∏:', state.centerChips);
            // gameState Í∞ùÏ≤¥ÏóêÎèÑ centerChips Ï†ÄÏû•
            gameState.centerChips = state.centerChips;
            updateCenterChips(state.centerChips);
        }

        if (state.players) {
            console.log('[updateGameState] ÌîåÎ†àÏù¥Ïñ¥ ÏóÖÎç∞Ïù¥Ìä∏:', state.players);
            // gameState Í∞ùÏ≤¥ÏóêÎèÑ players Ï†ÄÏû•
            gameState.players = state.players;
            updatePlayerChips(state.players);
            updatePlayers(state.players);
        }

        if (state.currentRound) {
            updateRoundInfo(state.currentRound, state.maxRounds || 5);
        }

        if (state.phase) {
            updateGamePhase(state.phase);

            // ÏáºÎã§Ïö¥Ïù¥ ÏïÑÎãå ÌéòÏù¥Ï¶àÎ°ú ÎèåÏïÑÏò¨ Îïå UI Î≥µÏõê
            if (state.phase !== 'showdown') {
                const showdownContainer = document.getElementById('showdownContainer');
                if (showdownContainer) {
                    showdownContainer.classList.remove('active');
                }

                const playersGrid = document.querySelector('.players-grid');
                if (playersGrid) {
                    playersGrid.style.display = '';
                }

                const chipsContainer = document.getElementById('casinoChipsContainer');
                if (chipsContainer) {
                    chipsContainer.style.display = '';
                }

                // Í∏àÍ≥†/Í≤ΩÎ≥¥ Ïπ¥Ïö¥ÌÑ∞Îäî Ìï≠ÏÉÅ ÌëúÏãú (Ïà®Í∏∞ÏßÄ ÏïäÏùå)
            }
        }

        // ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        if (state.currentPlayer !== undefined && state.players) {
            const currentPlayerData = state.players[state.currentPlayer];
            if (currentPlayerData) {
                showMessage(`ÌòÑÏû¨ ÌÑ¥: ${currentPlayerData.username}`);
                
                // ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
                const currentUsername = getCurrentUsername();
                // isMyTurn = (currentPlayerData.username === currentUsername); // Ïã§ÏãúÍ∞Ñ Í≤åÏûÑÏúºÎ°ú Î≥ÄÍ≤Ω
                
                // ÌÑ¥ ÌëúÏãú UI ÏóÖÎç∞Ïù¥Ìä∏
                updatePlayerTurnIndicators(currentPlayerData.username);
            }
        }

        console.log('updateGameState ÏôÑÎ£å:', state);
        
        if (!gameState.collectedChips) {
            gameState.collectedChips = [];
        }
        
        // Í≤åÏûÑÏù¥ ÏÉàÎ°ú ÏãúÏûëÎêòÍ±∞ÎÇò ÎùºÏö¥ÎìúÍ∞Ä Î≥ÄÍ≤ΩÎê† Îïå ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ï∏° Ïπ© ÏàòÏßë Î≥ÄÏàò Ï¥àÍ∏∞Ìôî
        if (state.phase === 'waiting' || state.phase === 'dealing' || 
            (gameState.phase !== state.phase && state.phase === 'playing')) {
            myCollectedChipIndex = null;
            console.log('Í≤åÏûÑ ÏÉÅÌÉú Î≥ÄÍ≤ΩÏúºÎ°ú Ïπ© ÏàòÏßë Î≥ÄÏàò Ï¥àÍ∏∞ÌôîÎê®');
        }
        
        currentPlayer = state.currentPlayer;
        // isMyTurn = state.isMyTurn; // Ïã§ÏãúÍ∞Ñ Í≤åÏûÑÏúºÎ°ú Î≥ÄÍ≤Ω
        
        console.log('updateCommunityCards Ìò∏Ï∂ú Ï†Ñ - Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú:', state.communityCards);
        updateCommunityCards(state.communityCards);
        updatePlayers(state.players);
        updateControls();
        updateGamePhase(state.phase);
        updateRoundInfo(state.currentRound, state.maxRounds);
        
        // Î∞© Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ - state ÏûêÏ≤¥Í∞Ä Î∞© Ï†ïÎ≥¥Î•º Ìè¨Ìï®ÌïòÍ≥† ÏûàÏùå
        updateRoomInfo(state);
        
        const dealCardsBtn = document.getElementById('dealCardsBtn');
        // Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäº Ï†úÍ±∞Îê®
        if (false && dealCardsBtn) {
            // Ïó¨Îü¨ Î∞©Î≤ïÏúºÎ°ú ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê ÌôïÏù∏
            const currentUsername = socket.data?.username || localStorage.getItem('username') || 
                                   sessionStorage.getItem('username') || window.currentUser;
            
            // Î≥∏Ïù∏Ïù¥ Ïπ¥ÎìúÎ•º Î∞õÏïòÎäîÏßÄ ÌôïÏù∏ (Îã§Î•∏ ÏÇ¨Ïö©ÏûêÏùò Ïπ¥Îìú Î≥¥Ïú† Ïó¨Î∂ÄÏôÄ Î¨¥Í¥Ä)
            const myPlayer = state?.players?.find(p => p.username === currentUsername);
            const myHasCards = myPlayer && myPlayer.cards && myPlayer.cards.length > 0;
            
            if (state?.phase === 'playing') {
                if (myHasCards) {
                    // Î≥∏Ïù∏Ïù¥ Ïπ¥ÎìúÎ•º Î∞õÏïòÏúºÎ©¥ ÎπÑÌôúÏÑ±Ìôî
                    dealCardsBtn.disabled = true;
                    dealCardsBtn.textContent = 'Ïπ¥Îìú Î∞õÍ∏∞ ÏôÑÎ£å';
                    dealCardsBtn.style.opacity = '0.6';
                    dealCardsBtn.style.display = 'inline-block';
                } else {
                    // Î≥∏Ïù∏Ïù¥ Ïπ¥ÎìúÎ•º Î∞õÏßÄ ÏïäÏïòÏúºÎ©¥ ÌôúÏÑ±Ìôî Ïú†ÏßÄ
                    dealCardsBtn.disabled = false;
                    dealCardsBtn.style.opacity = '1';
                    dealCardsBtn.style.display = 'inline-block';
                    
                    // ÏßÑÌñâ ÏÉÅÌô© ÌëúÏãú (Ïù¥ÎØ∏ ÏÑ§Ï†ïÎêòÏñ¥ ÏûàÏßÄ ÏïäÎã§Î©¥ Í∏∞Î≥∏ ÌÖçÏä§Ìä∏)
                    if (!dealCardsBtn.textContent.includes('(')) {
                        dealCardsBtn.textContent = 'Ïπ¥Îìú Î∞õÍ∏∞';
                    }
                }
            }
        }
    }
    

    
    function updateCommunityCards(cards) {
        console.log('updateCommunityCards Ìò∏Ï∂úÎê® - Î∞õÏùÄ Ïπ¥Îìú:', cards);
        const container = document.getElementById('communityCards');
        if (!container) {
            console.error('communityCards Ïª®ÌÖåÏù¥ÎÑàÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§!');
            return;
        }

        // Ïπ¥ÎìúÍ∞Ä ÏóÜÍ±∞ÎÇò Îπà Î∞∞Ïó¥Ïù¥Î©¥ ÏïÑÎ¨¥Í≤ÉÎèÑ ÌïòÏßÄ ÏïäÏùå (Í∏∞Ï°¥ Ïπ¥Îìú Ïú†ÏßÄ)
        if (!cards || !Array.isArray(cards) || cards.length === 0) {
            console.log('Ïú†Ìö®ÌïòÏßÄ ÏïäÍ±∞ÎÇò Îπà Ïπ¥Îìú Îç∞Ïù¥ÌÑ∞ - Í∏∞Ï°¥ Ïπ¥Îìú Ïú†ÏßÄ:', cards);
            return;
        }

        console.log('Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú Ïª®ÌÖåÏù¥ÎÑà Î∞úÍ≤¨, Í∏∞Ï°¥ ÎÇ¥Ïö© Ï†úÍ±∞');
        container.innerHTML = '';

        console.log(`${cards.length}Ïû•Ïùò Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú ÌëúÏãú ÏãúÏûë`);
        cards.forEach((card, index) => {
            console.log(`Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú ${index + 1}: ${card.rank}${card.suit}`);
            const cardElement = createCardElement(card);
            container.appendChild(cardElement);
        });

        console.log('Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
    }
    
         function updatePlayers(players) {
         console.log('updatePlayers Ìò∏Ï∂úÎê®:', players);
         console.log('ÌòÑÏû¨ gameState.collectedChips:', gameState?.collectedChips);
         console.log('ÌòÑÏû¨ myCollectedChipIndex:', myCollectedChipIndex);
         
         // ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê ÏãùÎ≥Ñ
         const currentUsername = socket.data?.username || localStorage.getItem('username') || 
                                sessionStorage.getItem('username') || window.currentUser;
         console.log('ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÎ™Ö:', currentUsername);
         
         // Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥ ÌëúÏãú (ÏûêÏã† Ìè¨Ìï®)
         const allPlayersContainer = document.getElementById('allPlayersList');
         console.log('allPlayersContainer:', allPlayersContainer);
         console.log('allPlayersContainer style:', allPlayersContainer ? allPlayersContainer.style : 'null');
         console.log('allPlayersContainer computed style:', allPlayersContainer ? getComputedStyle(allPlayersContainer).display : 'null');
         
         if (!allPlayersContainer) {
             console.error('allPlayersList Ïª®ÌÖåÏù¥ÎÑàÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§!');
             return;
         }
         
         allPlayersContainer.innerHTML = '<div style="color: white; font-weight: bold;">üîç ÌîåÎ†àÏù¥Ïñ¥ ÏöîÏïΩÌëú ÎîîÎ≤ÑÍπÖ Ï§ë...</div>';
         console.log('ÌîåÎ†àÏù¥Ïñ¥ ÏöîÏÜå ÏÉùÏÑ± ÏãúÏûë...');
         console.log('Î∞õÏùÄ ÌîåÎ†àÏù¥Ïñ¥ Îç∞Ïù¥ÌÑ∞:', players);
         
         players.forEach((player, index) => {
             console.log(`ÌîåÎ†àÏù¥Ïñ¥ ${index + 1} ÏöîÏÜå ÏÉùÏÑ±:`, player.username);
             const playerElement = createAllPlayerElement(player, currentUsername);
             allPlayersContainer.appendChild(playerElement);
         });
         
         console.log('Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥ ÏöîÏÜå ÏÉùÏÑ± ÏôÑÎ£å');
         
         // ÎÇ¥ ÌîåÎ†àÏù¥Ïñ¥ ÏòÅÏó≠ ÏóÖÎç∞Ïù¥Ìä∏ (Í∏∞Ï°¥ Ïú†ÏßÄ)
         const myPlayer = players.find(p => p.username === currentUsername);
         if (myPlayer) {
             console.log('ÎÇ¥ ÌîåÎ†àÏù¥Ïñ¥ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë');
             updateMyPlayer(myPlayer);
             console.log('ÎÇ¥ ÌîåÎ†àÏù¥Ïñ¥ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
         }
         
         // ÌîåÎ†àÏù¥Ïñ¥ Ïàò ÏóÖÎç∞Ïù¥Ìä∏
         const playerCountEl = document.getElementById('playerCount');
         if (playerCountEl) {
             playerCountEl.textContent = players.length;
         }
         
         // Ïπ¥ÏßÄÎÖ∏ Ïπ© ÏóÖÎç∞Ïù¥Ìä∏
         const collectedChips = gameState?.collectedChips || [];
         console.log('Ïπ¥ÏßÄÎÖ∏ Ïπ© ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë, collectedChips:', collectedChips);
         // updateCasinoChips(players.length, collectedChips); // ÎπÑÌôúÏÑ±Ìôî: updateCenterChips ÏÇ¨Ïö©
         console.log('Ïπ¥ÏßÄÎÖ∏ Ïπ© ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å');
         
         console.log('updatePlayers ÏôÑÎ£å');
     }
    
         // ÏáºÎã§Ïö¥ Í≤∞Í≥º Î†åÎçîÎßÅ Ìï®Ïàò
         function renderShowdown(data) {
             console.log('[renderShowdown] ÏãúÏûë:', data);

             // 1. Í≤åÏûÑ ÌéòÏù¥Ï¶à ÏóÖÎç∞Ïù¥Ìä∏
             updateGamePhase('üé≠ ÏáºÎã§Ïö¥');

             // 2. ÌîåÎ†àÏù¥Ïñ¥ ÏòÅÏó≠ Ïà®Í∏∞Í∏∞
             const playersGrid = document.querySelector('.players-grid');
             if (playersGrid) {
                 playersGrid.style.display = 'none';
             }

             // 3. Ïπ¥ÏßÄÎÖ∏ Ïπ© Ïª®ÌÖåÏù¥ÎÑà Ïà®Í∏∞Í∏∞
             const chipsContainer = document.getElementById('casinoChipsContainer');
             if (chipsContainer) {
                 chipsContainer.style.display = 'none';
             }

             // 4. ÏáºÎã§Ïö¥ Ïª®ÌÖåÏù¥ÎÑà ÌëúÏãú
             const showdownContainer = document.getElementById('showdownContainer');
             if (!showdownContainer) {
                 console.error('[renderShowdown] ÏáºÎã§Ïö¥ Ïª®ÌÖåÏù¥ÎÑàÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                 return;
             }

             showdownContainer.classList.add('active');

             // 5. Í∏àÍ≥†/Í≤ΩÎ≥¥ Ïπ¥Ïö¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
             const vaultCountEl = document.getElementById('vaultCount');
             const alarmCountEl = document.getElementById('alarmCount');
             if (vaultCountEl) vaultCountEl.textContent = data.currentVaults || 0;
             if (alarmCountEl) alarmCountEl.textContent = data.currentAlarms || 0;

             // 6. ÌîåÎ†àÏù¥Ïñ¥Î≥Ñ ÏáºÎã§Ïö¥ Ï†ïÎ≥¥ Î†åÎçîÎßÅ
             const playersContainer = document.getElementById('showdownPlayersContainer');
             if (!playersContainer) {
                 console.error('[renderShowdown] showdownPlayersContainerÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                 return;
             }
             playersContainer.innerHTML = '';

             if (data.showdownPlayers && data.showdownPlayers.length > 0) {
                 data.showdownPlayers.forEach((player, index) => {
                     const playerRow = document.createElement('div');
                     playerRow.className = 'showdown-player-row';

                     // Îπ®Í∞Ñ Ïπ©
                     const redChip = document.createElement('div');
                     redChip.className = 'showdown-red-chip';
                     redChip.textContent = `${player.redChipStars}‚òÖ`;
                     playerRow.appendChild(redChip);

                     // ÌîåÎ†àÏù¥Ïñ¥ Ïù¥Î¶Ñ
                     const playerName = document.createElement('div');
                     playerName.className = 'showdown-player-name';
                     playerName.textContent = player.username;
                     playerRow.appendChild(playerName);

                     // Í∞úÏù∏ Ïπ¥Îìú 2Ïû•
                     const pocketCards = document.createElement('div');
                     pocketCards.className = 'showdown-pocket-cards';
                     if (player.pocketCards && player.pocketCards.length === 2) {
                         player.pocketCards.forEach(card => {
                             const cardEl = createCardElement(card);
                             pocketCards.appendChild(cardEl);
                         });
                     }
                     playerRow.appendChild(pocketCards);

                     // Ìè¨Ïª§ Ìï∏Îìú Ïù¥Î¶Ñ
                     const handName = document.createElement('div');
                     handName.className = 'showdown-hand-name';
                     handName.textContent = player.handName || 'Unknown';
                     if (player.tied) {
                         handName.textContent += ' (ÎèôÏ†ê)';
                     }
                     playerRow.appendChild(handName);

                     // ÏÑ±Í≥µ/Ïã§Ìå® Î∞∞ÏßÄ (Í∞úÏù∏Î≥Ñ ÏÑ±Í≥µÏùÄ Ï†ÑÏ≤¥ heistSuccessÏôÄ ÎèôÏùº)
                     const resultBadge = document.createElement('div');
                     resultBadge.className = 'showdown-result-badge';
                     if (data.heistSuccess) {
                         resultBadge.classList.add('success');
                         resultBadge.textContent = '‚úÖ';
                     } else {
                         resultBadge.classList.add('fail');
                         resultBadge.textContent = '‚ùå';
                     }
                     playerRow.appendChild(resultBadge);

                     playersContainer.appendChild(playerRow);
                 });
             }

             // 7. ÌôïÏù∏ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
             const confirmBtn = document.getElementById('confirmShowdownBtn');
             if (confirmBtn) {
                 // Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï†úÍ±∞ (Ï§ëÎ≥µ Î∞©ÏßÄ)
                 const newBtn = confirmBtn.cloneNode(true);
                 confirmBtn.parentNode.replaceChild(newBtn, confirmBtn);

                 // Î≤ÑÌäº Ï¥àÍ∏∞ ÏÉÅÌÉúÎ°ú Î¶¨ÏÖã
                 newBtn.disabled = false;

                 newBtn.addEventListener('click', () => {
                     console.log('[Confirm] ÏáºÎã§Ïö¥ ÌôïÏù∏ Î≤ÑÌäº ÌÅ¥Î¶≠');
                     newBtn.disabled = true;
                     socket.emit('confirmShowdown', { roomId: gameState.roomId });
                 });
             }

             // 8. ÏßÑÌñâ ÏÉÅÌô© Ï¥àÍ∏∞Ìôî
             const progressEl = document.getElementById('confirmProgress');
             if (progressEl) {
                 progressEl.textContent = 'ÎåÄÍ∏∞Ï§ë: 0Î™Ö ÌôïÏù∏';
             }

             // 9. Í≤∞Í≥º Î©îÏãúÏßÄ ÌëúÏãú
             if (data.message) {
                 showMessage(data.message);
             }

             // 10. Í∏àÍ≥†/Í≤ΩÎ≥¥ Ïàò ÏóÖÎç∞Ïù¥Ìä∏
             console.log(`[renderShowdown] Í∏àÍ≥†: ${data.currentVaults}, Í≤ΩÎ≥¥: ${data.currentAlarms}`);

             // 11. gameStateÏóê ÏáºÎã§Ïö¥ ÌéòÏù¥Ï¶à Ï†ÄÏû• (updateGameStateÍ∞Ä Ìò∏Ï∂úÎêòÏñ¥ÎèÑ UI Ïú†ÏßÄ)
             gameState.phase = 'showdown';
         }

         function createCardElement(card) {
         console.log('createCardElement Ìò∏Ï∂úÎê®, Ïπ¥Îìú:', card);
         
         if (!card || !card.suit) {
             console.error('Ïπ¥Îìú Îç∞Ïù¥ÌÑ∞Í∞Ä Ïú†Ìö®ÌïòÏßÄ ÏïäÏäµÎãàÎã§:', card);
             return document.createElement('div');
         }
         
         const cardDiv = document.createElement('div');
         const suitSymbol = getSuitSymbol(card.suit);
         console.log('Ïπ¥Îìú Î¨∏Ïñë Î≥ÄÌôò Í≤∞Í≥º:', card.suit, '->', suitSymbol);
         
         cardDiv.className = `card ${suitSymbol === '‚ô•' || suitSymbol === '‚ô¶' ? 'red' : 'black'}`;
         
         if (card.hidden) {
             cardDiv.classList.add('hidden');
             cardDiv.innerHTML = 'üÇ†';
         } else {
             console.log('Ïª§ÎÆ§ÎãàÌã∞ Ïπ¥Îìú ÏÉùÏÑ±:', card.rank, suitSymbol);
             cardDiv.innerHTML = `
                 <div style="font-size: 1.2rem; font-weight: bold;">${card.rank}</div>
                 <div style="font-size: 1.5rem; margin-top: 5px;">${suitSymbol}</div>
             `;
         }
         return cardDiv;
     }
    
    function createPlayerElement(player) {
        const playerDiv = document.createElement('div');
        const hasCards = player.cards && player.cards.length > 0;
        const cardStatus = hasCards ? 'has-cards' : 'no-cards';
        playerDiv.className = `player ${player.isCurrent ? 'current' : ''} ${cardStatus}`;
        
        let collectedChipsIcons = '';
        if (gameState && gameState.collectedChips && gameState.collectedChips.length > 0) {
            collectedChipsIcons = `
                <div class="collected-chips-icons">
                    ${gameState.collectedChips.map(chipIndex => {
                        // Ïπ©Ïùò Ïã§Ï†ú Î≥Ñ Í∞úÏàò Í≥ÑÏÇ∞ (Ïπ© Ïù∏Îç±Ïä§ + 1)
                        const starCount = chipIndex + 1;
                        
                        // Î≥ÑÎì§ÏùÑ ÌëúÏãúÌïòÎäî HTML ÏÉùÏÑ±
                        let starsHTML = '';
                        for (let j = 0; j < starCount; j++) {
                            let starSize = '12px'; // Í∏∞Î≥∏ ÌÅ¨Í∏∞
                            if (starCount > 4) {
                                starSize = '8px';
                            } else if (starCount > 2) {
                                starSize = '9px';
                            }
                            starsHTML += `<span style="font-size: ${starSize}; animation-delay: ${j * 0.2}s;">‚òÖ</span>`;
                        }
                        
                        return `
                            <div class="collected-chip-icon" data-chip-index="${chipIndex}" title="Ïπ© ${chipIndex + 1} (${starCount}Í∞ú Î≥Ñ)">
                                <div class="chip-icon-inner">
                                    <span class="chip-number">${chipIndex + 1}</span>
                                    <div class="chip-stars-display" style="margin-top: 2px; text-align: center;">
                                        ${starsHTML}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }
        
        // Ìå®Ïä§ ÏÉÅÌÉú ÌëúÏãú ÏïÑÏù¥ÏΩò
        const passStatusIcon = player.hasPassed ? 
            '<span class="pass-status-icon passed" title="Ìå®Ïä§Ìï®">‚úì</span>' : 
            '<span class="pass-status-icon active" title="Í≤åÏûÑ Ï§ë">üéÆ</span>';
        
        playerDiv.innerHTML = `
            <div class="player-info">
                <div class="player-name">
                    ${player.username}
                    ${passStatusIcon}
            </div>
        </div>
            <div class="player-cards-container">
                <div class="player-cards">
                    ${player.cards.map(card => {
                        const cardElement = createCardElement(card);
                        return cardElement.outerHTML;
                    }).join('')}
    </div>
                ${collectedChipsIcons}
    </div>
        `;
        return playerDiv;
    }
    
         // Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥ ÏöîÏÜå ÏÉùÏÑ± (ÏûêÏã†Í≥º Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥ Íµ¨Î∂Ñ)
     function createAllPlayerElement(player, currentUsername) {
         const isCurrentUser = player.username === currentUsername;
         const playerDiv = document.createElement('div');
         const hasCards = player.cards && player.cards.length > 0;
         const cardStatus = hasCards ? 'has-cards' : 'no-cards';
         const isOnline = player.isOnline !== false; // Ïò®ÎùºÏù∏ ÏÉÅÌÉú ÌôïÏù∏
         
         console.log(`ÌîåÎ†àÏù¥Ïñ¥ ${player.username} ÏöîÏÜå ÏÉùÏÑ±:`, {
             isCurrentUser,
             hasCards,
             cardStatus,
             cards: player.cards,
             isOnline
         });
         
         // ÏûêÏã†Í≥º Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Î•º Íµ¨Î∂ÑÌïòÏó¨ ÌÅ¥ÎûòÏä§ ÏÑ§Ï†ï
         if (isCurrentUser) {
             playerDiv.className = `all-player current-user ${cardStatus} ${!isOnline ? 'offline' : ''}`;
         } else {
             playerDiv.className = `all-player other-user ${cardStatus} ${!isOnline ? 'offline' : ''}`;
         }
         
         // Ìå®Ïä§ ÏÉÅÌÉú ÌëúÏãú ÏïÑÏù¥ÏΩò
         const passStatusIcon = player.hasPassed ? 
             '<span class="pass-status-icon passed" title="Ìå®Ïä§Ìï®">‚úì</span>' : 
             '<span class="pass-status-icon active" title="Í≤åÏûÑ Ï§ë">üéÆ</span>';
         
         // Ïπ¥Îìú ÏÉÅÌÉú ÌëúÏãú ÏïÑÏù¥ÏΩò
         const cardStatusIcon = hasCards ? 
             '<span class="card-status-icon ready" title="Ïπ¥Îìú Î≥¥Ïú†">‚úì</span>' : 
             '<span class="card-status-icon waiting" title="Ïπ¥Îìú ÎåÄÍ∏∞ Ï§ë">‚è≥</span>';
         
                   // ÏàòÏßëÎêú Ïπ© ÌëúÏãú (Í∞Å ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Í∞ÄÏ†∏Í∞Ñ Ïã§Ï†ú Ïπ© ÌëúÏãú)
          let chipIcons = '';
          
          console.log(`ÌîåÎ†àÏù¥Ïñ¥ ${player.username} Ïπ© ÌëúÏãú Î°úÏßÅ:`, {
             isCurrentUser,
             playerChips: player.chips
          });
          
          // ÎùºÏö¥ÎìúÎ≥ÑÎ°ú ÏàòÏßëÎêú Ïπ©Îì§ ÌëúÏãú
          let allChipsToDisplay = [];
          
          // Ïù¥Ï†Ñ ÎùºÏö¥Îìú Ïπ©Îì§ (ÏöîÏïΩÌåêÏóêÎßå ÌëúÏãú)
          if (player.roundChips) {
              for (let round in player.roundChips) {
                  if (player.roundChips[round] && player.roundChips[round].length > 0) {
                      allChipsToDisplay = allChipsToDisplay.concat(player.roundChips[round]);
                  }
              }
          }
          
          // ÌòÑÏû¨ ÎùºÏö¥Îìú Ïπ©Îì§
          if (player.chips && player.chips.length > 0) {
              allChipsToDisplay = allChipsToDisplay.concat(player.chips);
          }
          
          // ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Í∞ÄÏ†∏Í∞Ñ Ïπ©Îì§ÏùÑ Î≥Ñ ÎîîÏûêÏù∏ÏúºÎ°ú ÌëúÏãú
          if (allChipsToDisplay.length > 0) {
              let chipsHTML = '';
              allChipsToDisplay.forEach((chip, index) => {
                  const starCount = chip.stars || chip.value || (index + 1);
                  let starsHTML = '';
                  for (let j = 0; j < starCount; j++) {
                      starsHTML += `<div class="chip-star" style="
                          font-size: 6px;
                          color: black;
                          text-shadow: 0 0 1px rgba(255,255,255,0.8);
                          animation: sparkle 2s infinite;
                          animation-delay: ${j * 0.2}s;
                          line-height: 1;
                      ">‚òÖ</div>`;
                  }

                  const chipId = String(chip.id || '').replace(/'/g, "\\'");
                  const playerName = String(player.username || '').replace(/'/g, "\\'");

                  chipsHTML += `
                      <div class="casino-chip summary-chip ${chip.color}"
                           data-chip-id="${chip.id}"
                           data-chip-index="${index}"
                           onclick="handleChipClick('${chipId}', 'player', '${playerName}')"
                           title="Ïπ© ${chip.id} (Í∞í: ${chip.value}, Î≥Ñ: ${starCount}Í∞ú)"
                           style="
                               display: inline-block;
                               margin: 2px;
                               width: 22px;
                               height: 22px;
                               cursor: pointer;
                               transition: all 0.2s;
                           ">
                          <div class="chip-stars" style="
                              display: flex;
                              flex-wrap: wrap;
                              justify-content: center;
                              align-items: center;
                              width: 100%;
                              height: 100%;
                              gap: 0;
                          ">${starsHTML}</div>
                      </div>
                  `;
              });
              chipIcons = `<div class="all-player-chips-container">${chipsHTML}</div>`;
              console.log(`ÌîåÎ†àÏù¥Ïñ¥ ${player.username} Ïπ© ÌëúÏãú: ${allChipsToDisplay.length}Í∞ú Ïπ© (Î≥Ñ ÎîîÏûêÏù∏)`);
          }
         
                   // Ïπ¥Îìú ÌëúÏãú (ÏûêÏã†ÏùÄ Ïã§Ï†ú Ïπ¥Îìú, Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Îäî Îí∑Î©¥)
          let cardsHTML = '';
          if (hasCards && player.cards && Array.isArray(player.cards)) {
              if (isCurrentUser) {
                  // ÏûêÏã†Ïùò Ïπ¥ÎìúÎäî Ïã§Ï†ú ÎÇ¥Ïö© ÌëúÏãú
                  cardsHTML = player.cards.map(card => {
                      if (!card) return '';
                      console.log('Ïπ¥Îìú Ï†ïÎ≥¥:', card);
                      const suitSymbol = getSuitSymbol(card.suit);
                      const isRed = suitSymbol === '‚ô•' || suitSymbol === '‚ô¶';
                      console.log('Ïπ¥Îìú ÏÉùÏÑ±:', card.rank, suitSymbol, isRed ? 'red' : 'black');
                      return `<div class="all-player-card ${isRed ? 'red' : 'black'}">${card.rank}${suitSymbol}</div>`;
                  }).join('');
              } else {
                  // Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Ïùò Ïπ¥ÎìúÎäî Îí∑Î©¥ ÌëúÏãú (ÎÇ¥ Ïπ¥ÎìúÎèÑ Îã§Î•∏ ÏÇ¨Ïö©ÏûêÏóêÍ≤åÎäî Îí∑Î©¥ÏúºÎ°ú Î≥¥ÏûÑ)
                  cardsHTML = player.cards.map(() => '<div class="all-player-card">üÇ†</div>').join('');
              }
          }
         
                   playerDiv.innerHTML = `
              <div class="all-player-info">
                  <div class="all-player-name" ${!isOnline ? 'style="color: #ff4444;"' : ''}>
                      ${passStatusIcon} ${isCurrentUser ? 'üë§ ' : ''}${player.username}${!isOnline ? ' (Ïò§ÌîÑÎùºÏù∏)' : ''}
                  </div>
                  <div class="all-player-cards">
                      ${cardsHTML}
                      ${chipIcons ? `<div class="all-player-chips-after-cards">${chipIcons}</div>` : ''}
                  </div>
              </div>
          `;
         
         return playerDiv;
     }
    
    // ÎÇ¥ ÌîåÎ†àÏù¥Ïñ¥ ÏòÅÏó≠ ÏóÖÎç∞Ïù¥Ìä∏
    function updateMyPlayer(player) {
        // ÎÇ¥ Ïù¥Î¶Ñ ÏóÖÎç∞Ïù¥Ìä∏
        const nameEl = document.getElementById('myPlayerName');
        if (nameEl) {
            nameEl.textContent = player.username;
        }
        
        // ÎÇ¥ Ïπ¥Îìú ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        const statusEl = document.getElementById('myCardStatus');
        const hasCards = player.cards && player.cards.length > 0;
        if (statusEl) {
            statusEl.textContent = hasCards ? '‚úì' : '‚è≥';
            statusEl.className = `card-status-icon ${hasCards ? 'ready' : 'waiting'}`;
            statusEl.title = hasCards ? 'Ïπ¥Îìú Î≥¥Ïú†' : 'Ïπ¥Îìú ÎåÄÍ∏∞ Ï§ë';
        }
        
        // ÎÇ¥ ÌîåÎ†àÏù¥Ïñ¥ ÏòÅÏó≠ Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
        const myAreaEl = document.getElementById('myPlayerArea');
        if (myAreaEl) {
            myAreaEl.className = `my-player-area ${hasCards ? 'has-cards' : 'no-cards'}`;
        }
        
        // ÎÇ¥ Ïπ¥ÎìúÎì§ ÌëúÏãú (Ïã§Ï†ú Ïπ¥Îìú ÎÇ¥Ïö© ÌëúÏãú)
        const myCardsEl = document.getElementById('myCards');
        if (myCardsEl) {
            myCardsEl.innerHTML = '';
            if (hasCards) {
                player.cards.forEach(card => {
                    const cardEl = createMyCardElement(card);
                    myCardsEl.appendChild(cardEl);
                });
            }
        }
        
        // ÎÇ¥ ÏàòÏßëÎêú Ïπ©Îì§ÏùÄ updatePlayerChips Ìï®ÏàòÏóêÏÑú Ï≤òÎ¶¨ÌïòÎØÄÎ°ú Ïó¨Í∏∞ÏÑúÎäî Ï†úÍ±∞
        // updatePlayerChipsÏóêÏÑú ÏÑúÎ≤Ñ Îç∞Ïù¥ÌÑ∞Î•º Í∏∞Î∞òÏúºÎ°ú Ïò¨Î∞îÎ•¥Í≤å ÌëúÏãúÎê®
    }
    
         // ÎÇ¥ Ïπ¥Îìú ÏöîÏÜå ÏÉùÏÑ± (Ïã§Ï†ú Ïπ¥Îìú ÎÇ¥Ïö© ÌëúÏãú)
     function createMyCardElement(card) {
         console.log('createMyCardElement Ìò∏Ï∂úÎê®, Ïπ¥Îìú:', card);
         
         if (!card || !card.suit) {
             console.error('ÎÇ¥ Ïπ¥Îìú Îç∞Ïù¥ÌÑ∞Í∞Ä Ïú†Ìö®ÌïòÏßÄ ÏïäÏäµÎãàÎã§:', card);
             return document.createElement('div');
         }
         
         const cardDiv = document.createElement('div');
         const suitSymbol = getSuitSymbol(card.suit);
         const isRed = suitSymbol === '‚ô•' || suitSymbol === '‚ô¶';
         cardDiv.className = `my-card ${isRed ? 'red' : 'black'}`;
         
         console.log('ÎÇ¥ Ïπ¥Îìú ÏÉùÏÑ±:', card.rank, suitSymbol, isRed ? 'red' : 'black');
         
         cardDiv.innerHTML = `
             <div class="my-card-top">${card.rank}</div>
             <div class="my-card-suit">${suitSymbol}</div>
             <div class="my-card-bottom">${card.rank}</div>
         `;
         
         return cardDiv;
     }
    
    function updateControls() {
        const gameActionBtn = document.getElementById('gameActionBtn');
        const passBtn = document.getElementById('passBtn');
        
        if (gameActionBtn) {
            gameActionBtn.style.display = 'inline-block';
            
            // Ìå®Ïä§ Î°úÏßÅ Í∞úÏÑ†: Ïπ©ÏùÑ Í∞ÄÏßÄÍ≥† ÏûàÏúºÎ©¥ Ïñ∏Ï†úÎì† Ìå®Ïä§ Í∞ÄÎä•
            if (gameActionMode === 'pass') {
                const currentUsername = getCurrentUsername();
                const myPlayer = gameState?.players?.find(p => p.username === currentUsername);
                const hasChips = myPlayer?.chips && myPlayer.chips.length > 0;
                
                gameActionBtn.disabled = !hasChips;
                if (hasChips) {
                    gameActionBtn.textContent = 'Ìå®Ïä§';
                } else {
                    gameActionBtn.textContent = 'Ìå®Ïä§ (Ïπ© ÌïÑÏöî)';
                }
            }
        }
        
        // Ìå®Ïä§ Î≤ÑÌäº ÌëúÏãú: Í≤åÏûÑ Ï§ëÏùº Îïå Ìï≠ÏÉÅ Î≥¥Ïù¥ÎèÑÎ°ù
        const isPlayingPhase = gameState?.phase === 'playing' ||
                               gameState?.phase?.startsWith('round');
        if (passBtn && isPlayingPhase) {
            passBtn.style.display = 'inline-block';

            // ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê Ï∞æÍ∏∞
            const currentUsername = (socket?.data?.username) || localStorage.getItem('username') ||
                                   sessionStorage.getItem('username') || window.currentUser;
            const myPlayer = gameState?.players?.find(p => p.username === currentUsername);

            // Ìå®Ïä§ Î≤ÑÌäº ÌôúÏÑ±Ìôî Ï°∞Í±¥:
            // 1. Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥Í∞Ä ÏµúÏÜå ÌïòÎÇòÏî© Ïπ©ÏùÑ Í∞ÄÏßÄÍ≥† ÏûàÏùÑ Îïå
            // 2. ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÍ∞Ä ÏïÑÏßÅ Ìå®Ïä§ÌïòÏßÄ ÏïäÏïòÏùÑ Îïå
            let allPlayersHaveChips = false;
            if (gameState?.players && Array.isArray(gameState.players)) {
                allPlayersHaveChips = gameState.players.every(player =>
                    player.chips && player.chips.length > 0
                );
            }

            const hasNotPassed = !myPlayer?.hasPassed;

            passBtn.disabled = !allPlayersHaveChips || !hasNotPassed;
        } else if (passBtn) {
            passBtn.style.display = 'none';
        }
    }
    
    function updateRoundInfo(currentRound, maxRounds) {
        const currentRoundEl = document.getElementById('currentRound');
        const maxRoundsEl = document.getElementById('maxRounds');
        
        if (currentRoundEl) {
            currentRoundEl.textContent = currentRound || '-';
        }
        
        if (maxRoundsEl) {
            maxRoundsEl.textContent = maxRounds || 5;
        }
    }
    
    function updateRoomInfo(room) {
        const roomNameEl = document.getElementById('roomName');
        const roomHostEl = document.getElementById('roomHost');
        const roomInfoCompactEl = document.querySelector('.room-info-compact');
        
        if (roomNameEl && room) {
            roomNameEl.textContent = room.name || 'Ïïå Ïàò ÏóÜÏùå';
        }
        
        if (roomHostEl && room) {
            roomHostEl.textContent = room.host || 'Ïïå Ïàò ÏóÜÏùå';
        }
        
        if (roomInfoCompactEl && room) {
            roomInfoCompactEl.innerHTML = `
                üìç Î∞©: ${room.name || 'Ïïå Ïàò ÏóÜÏùå'}<br>
                üëë Î∞©Ïû•: ${room.host || 'Ïïå Ïàò ÏóÜÏùå'}<br>
                üë• Ïù∏Ïõê: ${room.players?.length || 0}/${room.maxPlayers || 4}
            `;
        }
        
        console.log('Î∞© Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å:', room);
    }
    
    // The Gang Í≤åÏûÑ UI ÏóÖÎç∞Ïù¥Ìä∏ Ìï®ÏàòÎì§
    function updateActionButtons(availableActions) {
        const gameActionBtn = document.getElementById('gameActionBtn');
        const gameControlsContainer = document.querySelector('.game-controls');
        
        if (!gameControlsContainer) return;
        
        // Í∏∞Ï°¥ Î≤ÑÌäºÎì§ Ï†úÍ±∞
        gameControlsContainer.innerHTML = '';
        
        // Ïã§ÏãúÍ∞Ñ Í≤åÏûÑÏúºÎ°ú Î≥ÄÍ≤Ω - Ìå®Ïä§ Î≤ÑÌäºÎßå Ï†úÍ≥µ
        if (!availableActions || availableActions.length === 0) {
            // Ìå®Ïä§ Î≤ÑÌäºÎßå Ï†úÍ≥µ (Ïπ© Í∞ÄÏ†∏Ïò§Í∏∞Îäî ÏßÅÏ†ë ÌÅ¥Î¶≠ÏúºÎ°ú)
            availableActions = ['pass'];
        }

        // ÏïàÎÇ¥ Î©îÏãúÏßÄ Ï∂îÍ∞Ä
        const instructionMsg = document.createElement('div');
        instructionMsg.className = 'action-instruction';
        instructionMsg.innerHTML = 'üí° Ïπ©ÏùÑ ÌÅ¥Î¶≠Ìï¥ÏÑú Í∞ÄÏ†∏Ïò§Í±∞ÎÇò ÍµêÌôòÌïòÏÑ∏Ïöî!';
        instructionMsg.style.cssText = `
            color: #ffd700;
            font-size: 12px;
            margin-bottom: 10px;
            text-align: center;
        `;
        gameControlsContainer.appendChild(instructionMsg);

        // Ìå®Ïä§ Î≤ÑÌäºÎßå ÌëúÏãú (Îã§Î•∏ Ïï°ÏÖòÏùÄ Ïπ© ÌÅ¥Î¶≠ÏúºÎ°ú Ï≤òÎ¶¨)
        const passButton = document.createElement('button');
        passButton.className = 'btn btn-warning';
        passButton.textContent = 'Ìå®Ïä§';
        passButton.style.cssText = `
            background-color: #ff9800;
            border-color: #ff9800;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        `;
        passButton.onclick = () => handlePlayerAction('pass');
        gameControlsContainer.appendChild(passButton);
    }

    function showChipSelection(actionType) {
        if (!gameState || !gameState.centerChips || gameState.centerChips.length === 0) {
            showMessage('Í∞ÄÏö¥Îç∞Ïóê Í∞ÄÏ†∏Ïò¨ Ïπ©Ïù¥ ÏóÜÏäµÎãàÎã§.');
            return;
        }

        const chipId = gameState.centerChips[0].id; // Ï≤´ Î≤àÏß∏ Ïπ© ÏÑ†ÌÉù (Îã®ÏàúÌôî)
        handlePlayerAction(actionType, chipId);
    }

    function showPlayerSelection(actionType) {
        const currentUsername = getCurrentUsername();
        const otherPlayers = gameState.players.filter(p => 
            p.username !== currentUsername && p.chipCount > 0
        );

        if (otherPlayers.length === 0) {
            showMessage('ÏÉÅÎåÄÌï† ÌîåÎ†àÏù¥Ïñ¥Í∞Ä ÏóÜÏäµÎãàÎã§.');
            return;
        }

        // Ï≤´ Î≤àÏß∏ ÌîåÎ†àÏù¥Ïñ¥ÏôÄ ÏÉÅÌò∏ÏûëÏö© (Îã®ÏàúÌôî)
        const targetPlayer = otherPlayers[0];
        const targetSocketId = targetPlayer.socketId;
        
        if (actionType === 'takeFromPlayer') {
            handlePlayerAction(actionType, { targetPlayerId: targetSocketId, chipId: 'first' });
        } else if (actionType === 'exchangeWithPlayer') {
            handlePlayerAction(actionType, { targetPlayerId: targetSocketId, myChipId: 'first', targetChipId: 'first' });
        }
    }

    function showExchangeSelection(actionType) {
        if (!gameState || !gameState.centerChips || gameState.centerChips.length === 0) {
            showMessage('Í∞ÄÏö¥Îç∞Ïóê ÍµêÌôòÌï† Ïπ©Ïù¥ ÏóÜÏäµÎãàÎã§.');
            return;
        }

        const centerChipId = gameState.centerChips[0].id;
        handlePlayerAction(actionType, { myChipId: 'first', centerChipId: centerChipId });
    }

    function handlePlayerAction(action, data) {
        if (!gameState.roomId) {
            showMessage('Î∞© IDÍ∞Ä ÏóÜÏäµÎãàÎã§.');
            return;
        }

        const actionData = {
            roomId: gameState.roomId,
            action: action,
            targetId: data
        };

        console.log('=== [CLIENT REQUEST] ===');
        console.log('Sending playerAction:', actionData);
        console.log('Action:', action);
        console.log('Target ID (chipId):', data);
        console.log('Room ID:', gameState.roomId);
        
        socket.emit('playerAction', actionData);
    }

    function handleChipClick(chipId, source, targetUsername) {
        console.log('handleChipClick Ìò∏Ï∂ú:', chipId, source, targetUsername);
        
        const currentUsername = getCurrentUsername();
        const myPlayer = gameState.players ? gameState.players.find(p => p.username === currentUsername) : null;
        
        if (!myPlayer) {
            showMessage('ÌîåÎ†àÏù¥Ïñ¥ Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
            return;
        }

        const hasMyChips = myPlayer.chips && myPlayer.chips.length > 0;
        
        // ÏöîÏïΩÌåêÏóêÏÑú Ïπ© ÌÅ¥Î¶≠ Ï≤òÎ¶¨
        if (source === 'player' && targetUsername) {
            if (targetUsername === currentUsername) {
                // ÎÇ¥ Ïπ© ÌÅ¥Î¶≠ - ÏïÑÎ¨¥ ÎèôÏûë Ïïà Ìï®
                return;
            }
            
            // Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Ïùò Ïπ© Ï∞æÍ∏∞
            const targetPlayer = gameState.players.find(p => p.username === targetUsername);
            if (!targetPlayer) {
                showMessage('ÎåÄÏÉÅ ÌîåÎ†àÏù¥Ïñ¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            // ÏÜåÏºì ID Ï∞æÍ∏∞
            let targetSocketId = targetPlayer.socketId || targetUsername;
            
            // Ïπ© Ï†ïÎ≥¥ Ï∞æÍ∏∞
            const chip = targetPlayer.chips.find(c => c.id === chipId);
            if (!chip) {
                showMessage('Ìï¥Îãπ Ïπ©ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            // Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Ïùò Ïπ© ÌÅ¥Î¶≠
            // ÌòÑÏû¨ ÎùºÏö¥ÎìúÏùò Ïû†Í∏∞ÏßÄ ÏïäÏùÄ Ïπ©ÏùÑ Í∞ÄÏßÄÍ≥† ÏûàÎäîÏßÄ ÌôïÏù∏
            const hasUnlockedChip = myPlayer.chips && myPlayer.chips.some(c => c.locked === false);

            if (hasUnlockedChip) {
                // ÌòÑÏû¨ ÎùºÏö¥Îìú Ïπ©ÏùÑ Í∞ÄÏßÄÍ≥† ÏûàÏúºÎ©¥ ÍµêÌôò
                const myUnlockedChip = myPlayer.chips.find(c => c.locked === false);
                handlePlayerAction('exchangeWithPlayer', {
                    targetPlayerId: targetSocketId,
                    myChipId: myUnlockedChip.id,
                    targetChipId: chipId
                });
                showMessage(`${targetUsername}Ïùò Ïπ© ${chip.value}ÏôÄ ÎÇ¥ Ïπ© ${myUnlockedChip.value}Î•º ÍµêÌôòÌï©ÎãàÎã§.`);
            } else {
                // ÌòÑÏû¨ ÎùºÏö¥Îìú Ïπ©Ïù¥ ÏóÜÏúºÎ©¥ Í∞ÄÏ†∏Ïò§Í∏∞
                handlePlayerAction('takeFromPlayer', {
                    targetPlayerId: targetSocketId,
                    chipId: chipId
                });
                showMessage(`${targetUsername}ÏóêÍ≤åÏÑú Ïπ© ${chip.value}Î•º Í∞ÄÏ†∏ÏòµÎãàÎã§.`);
            }
        } else if (source === 'center') {
            // Í∞ÄÏö¥Îç∞ Ïπ© ÌÅ¥Î¶≠ Ï≤òÎ¶¨
            const chip = gameState.centerChips ? gameState.centerChips.find(c => c.id === chipId) : null;
            if (!chip) {
                showMessage('Ìï¥Îãπ Ïπ©ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }

            // ÌòÑÏû¨ ÎùºÏö¥ÎìúÏùò Ïû†Í∏∞ÏßÄ ÏïäÏùÄ Ïπ©ÏùÑ Í∞ÄÏßÄÍ≥† ÏûàÎäîÏßÄ ÌôïÏù∏
            const hasUnlockedChip = myPlayer.chips && myPlayer.chips.some(c => c.locked === false);

            if (hasUnlockedChip) {
                // ÌòÑÏû¨ ÎùºÏö¥Îìú Ïπ©ÏùÑ Í∞ÄÏßÄÍ≥† ÏûàÏúºÎ©¥ ÍµêÌôò
                const myUnlockedChip = myPlayer.chips.find(c => c.locked === false);
                handlePlayerAction('exchangeWithCenter', {
                    myChipId: myUnlockedChip.id,
                    centerChipId: chipId
                });
                showMessage(`Í∞ÄÏö¥Îç∞ Ïπ© ${chip.value}ÏôÄ ÎÇ¥ Ïπ© ${myUnlockedChip.value}Î•º ÍµêÌôòÌï©ÎãàÎã§.`);
            } else {
                // ÌòÑÏû¨ ÎùºÏö¥Îìú Ïπ©Ïù¥ ÏóÜÏúºÎ©¥ Í∞ÄÏ†∏Ïò§Í∏∞
                console.log(`[CLIENT] Taking chip ${chipId} from center`);
                handlePlayerAction('takeFromCenter', chipId);
                showMessage(`Í∞ÄÏö¥Îç∞ÏóêÏÑú Ïπ© ${chip.value}Î•º Í∞ÄÏ†∏Ïò§Îäî Ï§ë...`);
            }
        }
    }

    function updateCenterChips(centerChips) {
        console.log('\n=== [updateCenterChips START] ===');
        console.log('Input centerChips:', centerChips);
        console.log('centerChips length:', centerChips?.length);
        
        const centerChipsContainer = document.querySelector('.casino-chips-container .chips-stack');
        if (!centerChipsContainer) {
            console.error('[updateCenterChips] Container not found!');
            console.error('Available elements:', document.querySelectorAll('.casino-chips-container, .chips-stack'));
            return;
        }

        console.log('[updateCenterChips] Container found:', centerChipsContainer);
        console.log('Current container HTML before clear:', centerChipsContainer.innerHTML.length);
        
        // Í∏∞Ï°¥ ÎÇ¥Ïö© ÏôÑÏ†Ñ Ï†úÍ±∞
        centerChipsContainer.innerHTML = '';
        centerChipsContainer.textContent = ''; // Ï∂îÍ∞Ä Î≥¥Ïû•
        
        console.log('Container cleared, current HTML length:', centerChipsContainer.innerHTML.length);

        // Ïπ©Ïù¥ ÏóÜÏúºÎ©¥ Î©îÏãúÏßÄ ÌëúÏãú
        if (!centerChips || centerChips.length === 0) {
            const noChipsMessage = '<div class="no-chips-message" style="text-align: center; color: #666; padding: 20px;">Í∞ÄÏö¥Îç∞ Ïπ©Ïù¥ ÏóÜÏäµÎãàÎã§</div>';
            centerChipsContainer.innerHTML = noChipsMessage;
            console.log('[updateCenterChips] No chips - message set');
            console.log('Final container HTML:', centerChipsContainer.innerHTML);
            console.log('=== [updateCenterChips END - NO CHIPS] ===\n');
            return;
        }

        // Ïπ©Îì§ÏùÑ ÌôîÎ©¥Ïóê ÌëúÏãú (Ïù¥Ï†Ñ updateCasinoChips Ïä§ÌÉÄÏùº Ï†ÅÏö©)
        console.log(`[updateCenterChips] Creating ${centerChips.length} chips:`);
        centerChips.forEach((chip, index) => {
            console.log(`  Chip ${index}: ${chip.id} (${chip.color} ${chip.value})`);
            
            const chipElement = document.createElement('div');
            chipElement.className = `casino-chip ${chip.color}`; // ÏÉâÏÉÅ ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
            chipElement.dataset.chipIndex = index;
            chipElement.setAttribute('data-chip-id', chip.id);
            
            // Ïó¨Îü¨ Î∞©Î≤ïÏúºÎ°ú ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê ÌôïÏù∏
            const currentUsername = socket.data?.username || localStorage.getItem('username') || 
                                   sessionStorage.getItem('username') || window.currentUser;
            
            // ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÍ∞Ä Ïπ¥ÎìúÎ•º Î∞õÏïòÎäîÏßÄ ÌôïÏù∏
            const myPlayer = gameState?.players?.find(p => p.username === currentUsername);
            const hasMyCards = myPlayer && myPlayer.cards && myPlayer.cards.length > 0;

            // Ïπ©Ïù¥ Ïû†Í≤®ÏûàÍ±∞ÎÇò Ïù¥Ï†Ñ ÎùºÏö¥Îìú Í≤ÉÏù∏ÏßÄ ÌôïÏù∏
            const isLocked = chip.locked === true;
            const isCurrentRound = !chip.round || chip.round === gameState?.currentRound;
            const isClickable = hasMyCards && !isLocked && isCurrentRound;

            if (isClickable) {
                chipElement.style.cursor = 'pointer';
                chipElement.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.3)';
            } else {
                chipElement.style.opacity = '0.5';
                chipElement.style.cursor = 'not-allowed';
                chipElement.style.filter = 'grayscale(50%)';
                if (isLocked || !isCurrentRound) {
                    chipElement.title = 'Ïù¥Ï†Ñ ÎùºÏö¥ÎìúÏùò Ïπ©ÏûÖÎãàÎã§';
                }
            }
            
            // Î≥Ñ Ïª®ÌÖåÏù¥ÎÑà ÏÉùÏÑ± (Ïù¥Ï†Ñ Î∞©ÏãùÍ≥º ÎèôÏùº)
            const starsContainer = document.createElement('div');
            starsContainer.className = 'chip-stars';
            
            // Í∞Å Ïπ©ÎßàÎã§ Îã§Î•∏ Î≥Ñ Í∞úÏàò (chip.stars ÎòêÎäî index + 1)
            const starCount = chip.stars || (index + 1);
            console.log(`Ïπ© ${index + 1}: ${starCount}Í∞úÏùò Î≥Ñ ÏÉùÏÑ±`);
            
            for (let j = 0; j < starCount; j++) {
                const star = document.createElement('div');
                star.className = 'chip-star';
                star.textContent = '‚òÖ';
                star.style.animationDelay = `${j * 0.2}s`;
                
                // Î≥ÑÏù¥ ÎßéÏùÑ Îïå ÌÅ¨Í∏∞ Ï°∞Ï†ï
                if (starCount > 4) {
                    star.style.fontSize = '8px';
                } else if (starCount > 2) {
                    star.style.fontSize = '9px';
                } else {
                    star.style.fontSize = '12px';
                }
                
                // Î≥Ñ ÏÉâÏÉÅÏùÑ Í≤ÄÏùÄÏÉâÏúºÎ°ú ÏÑ§Ï†ï
                star.style.color = 'black';
                star.style.textShadow = '0 0 1px rgba(255,255,255,0.8)';
                
                starsContainer.appendChild(star);
                console.log(`Î≥Ñ ${j + 1} Ï∂îÍ∞ÄÎê®, ÌÅ¨Í∏∞: ${star.style.fontSize}`);
            }
            
            chipElement.appendChild(starsContainer);

            // Ïπ© ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ - ÏÉàÎ°úÏö¥ Î∞©Ïãù ÏÇ¨Ïö© (Ïù¥Ï†ÑÍ≥º ÎèôÏùº)
            chipElement.addEventListener('click', function() {
                if (!hasMyCards) {
                    showMessage('Ïπ¥ÎìúÎ•º Î®ºÏ†Ä Î∞õÏïÑÏïº Ïπ©ÏùÑ Í∞ÄÏ†∏Ïò¨ Ïàò ÏûàÏäµÎãàÎã§.');
                } else if (isLocked || !isCurrentRound) {
                    showMessage('Ïù¥Ï†Ñ ÎùºÏö¥ÎìúÏùò Ïπ©ÏùÄ Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
                } else {
                    console.log('[CENTER CHIPS] Clicking chip:', chip.id);
                    handleChipClick(chip.id, 'center', null);
                }
            });
            
            centerChipsContainer.appendChild(chipElement);
        });
    }

    function updatePlayerChips(players) {
        const currentUsername = getCurrentUsername();
        const myPlayer = players.find(p => p.username === currentUsername);
        
        console.log('[updatePlayerChips] ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥ ÏÉÅÌÉú:', myPlayer);
        
        if (myPlayer) {
            const myChipsEl = document.getElementById('myChips');
            if (myChipsEl) {
                myChipsEl.innerHTML = '';
                
                if (myPlayer.chips && myPlayer.chips.length > 0) {
                    const chipsContainer = document.createElement('div');
                    chipsContainer.className = 'my-chips-container';
                    chipsContainer.innerHTML = '<div class="chips-title">ÎÇ¥ Ïπ©:</div>';
                    
                    console.log('[updatePlayerChips] ÎÇ¥ Ïπ© Î™©Î°ù:', myPlayer.chips);
                    
                    myPlayer.chips.forEach((chip, index) => {
                        const chipEl = document.createElement('div');
                        chipEl.className = `casino-chip my-chip ${chip.color}`; // ÏÉâÏÉÅ ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
                        chipEl.dataset.chipIndex = index;
                        chipEl.setAttribute('data-chip-id', chip.id);

                        // Ïπ©Ïù¥ Ïû†Í≤®ÏûàÍ±∞ÎÇò Ïù¥Ï†Ñ ÎùºÏö¥Îìú Í≤ÉÏù∏ÏßÄ ÌôïÏù∏
                        const isLocked = chip.locked === true;
                        const isCurrentRound = !chip.round || chip.round === gameState?.currentRound;

                        if (isLocked || !isCurrentRound) {
                            chipEl.style.opacity = '0.6';
                            chipEl.style.border = '2px dashed #666';
                            chipEl.title = `ÎùºÏö¥Îìú ${chip.round} Ïπ© (Ïû†ÍπÄ)`;
                        }

                        // Î≥Ñ Ïª®ÌÖåÏù¥ÎÑà ÏÉùÏÑ± (Ï§ëÏïô Ïπ©Í≥º ÎèôÏùºÌïú Î∞©Ïãù)
                        const starsContainer = document.createElement('div');
                        starsContainer.className = 'chip-stars';
                        
                        // Í∞Å Ïπ©ÎßàÎã§ Îã§Î•∏ Î≥Ñ Í∞úÏàò (chip.stars ÎòêÎäî chip.value)
                        const starCount = chip.stars || chip.value || (index + 1);
                        console.log(`ÎÇ¥ Ïπ© ${index + 1}: ${starCount}Í∞úÏùò Î≥Ñ ÏÉùÏÑ±`);
                        
                        for (let j = 0; j < starCount; j++) {
                            const star = document.createElement('div');
                            star.className = 'chip-star';
                            star.textContent = '‚òÖ';
                            star.style.animationDelay = `${j * 0.2}s`;
                            
                            // Î≥ÑÏù¥ ÎßéÏùÑ Îïå ÌÅ¨Í∏∞ Ï°∞Ï†ï
                            if (starCount > 4) {
                                star.style.fontSize = '6px';
                            } else if (starCount > 2) {
                                star.style.fontSize = '8px';
                            } else {
                                star.style.fontSize = '10px';
                            }
                            
                            // Î≥Ñ ÏÉâÏÉÅÏùÑ Í≤ÄÏùÄÏÉâÏúºÎ°ú ÏÑ§Ï†ï
                            star.style.color = 'black';
                            star.style.textShadow = '0 0 1px rgba(255,255,255,0.8)';
                            
                            starsContainer.appendChild(star);
                        }
                        
                        chipEl.appendChild(starsContainer);
                        chipsContainer.appendChild(chipEl);
                    });
                    
                    myChipsEl.appendChild(chipsContainer);
                } else {
                    myChipsEl.innerHTML = '<div class="no-chips">Ïπ©Ïù¥ ÏóÜÏäµÎãàÎã§</div>';
                }
            }
        }

        // Îã§Î•∏ ÌîåÎ†àÏù¥Ïñ¥Îì§Ïùò Ïπ© ÌëúÏãú (ÏÉÅÎã® ÏöîÏïΩÏ∞Ω)
        const allPlayersEl = document.getElementById('allPlayersList');
        if (allPlayersEl && players) {
            players.forEach(player => {
                const playerEl = allPlayersEl.querySelector(`[data-username="${player.username}"]`);
                if (playerEl) {
                    let chipInfo = playerEl.querySelector('.chip-info');
                    if (!chipInfo) {
                        chipInfo = document.createElement('div');
                        chipInfo.className = 'chip-info';
                        playerEl.appendChild(chipInfo);
                    }
                    
                    chipInfo.innerHTML = '';
                    
                    if (player.chips && player.chips.length > 0) {
                        const chipsContainer = document.createElement('div');
                        chipsContainer.className = 'player-chips-display';
                        chipsContainer.style.cssText = `
                            display: flex;
                            gap: 2px;
                            margin-top: 4px;
                            flex-wrap: wrap;
                        `;
                        
                        player.chips.forEach((chip, index) => {
                            const chipEl = document.createElement('div');
                            chipEl.className = 'casino-chip player-chip'; // Î≥Ñ ÎîîÏûêÏù∏ÏùÑ ÏúÑÌï¥ casino-chip ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
                            chipEl.dataset.chipIndex = index;
                            chipEl.setAttribute('data-chip-id', chip.id);
                            chipEl.setAttribute('data-player-username', player.username);
                            
                            // CSS Ïä§ÌÉÄÏùºÏùÑ ÏûëÏùÄ ÌÅ¨Í∏∞Î°ú Ï°∞Ï†ï
                            chipEl.style.cssText = `
                                width: 20px;
                                height: 20px;
                                cursor: pointer;
                                transition: all 0.2s;
                                margin: 1px;
                            `;
                            
                            // Î≥Ñ Ïª®ÌÖåÏù¥ÎÑà ÏÉùÏÑ± (Ï§ëÏïô Ïπ©Í≥º ÎèôÏùºÌïú Î∞©ÏãùÏù¥ÏßÄÎßå ÏûëÏùÄ ÌÅ¨Í∏∞)
                            const starsContainer = document.createElement('div');
                            starsContainer.className = 'chip-stars';
                            starsContainer.style.cssText = `
                                display: flex;
                                flex-wrap: wrap;
                                justify-content: center;
                                align-items: center;
                                width: 100%;
                                height: 100%;
                                gap: 0;
                            `;
                            
                            // Í∞Å Ïπ©ÎßàÎã§ Îã§Î•∏ Î≥Ñ Í∞úÏàò (chip.stars ÎòêÎäî chip.value)
                            const starCount = chip.stars || chip.value || (index + 1);
                            console.log(`ÌîåÎ†àÏù¥Ïñ¥ ${player.username} Ïπ© ${index + 1}: ${starCount}Í∞úÏùò Î≥Ñ ÏÉùÏÑ±`);
                            
                            for (let j = 0; j < starCount; j++) {
                                const star = document.createElement('div');
                                star.className = 'chip-star';
                                star.textContent = '‚òÖ';
                                star.style.cssText = `
                                    font-size: 4px;
                                    color: black;
                                    text-shadow: 0 0 1px rgba(255,255,255,0.8);
                                    animation: sparkle 2s infinite;
                                    animation-delay: ${j * 0.2}s;
                                    line-height: 1;
                                `;
                                
                                starsContainer.appendChild(star);
                            }
                            
                            chipEl.appendChild(starsContainer);
                            
                            // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä (ÎÇ¥ ÌÑ¥Ïù¥Í≥† ÎÇ¥Í∞Ä ÏïÑÎãå Í≤ΩÏö∞ÏóêÎßå)
                            if (player.username !== currentUsername) {
                                chipEl.addEventListener('click', () => handleChipClick('player', chip, player));
                                chipEl.addEventListener('mouseenter', () => {
                                    chipEl.style.transform = 'scale(1.2)';
                                    chipEl.style.boxShadow = '0 2px 8px rgba(0,0,0,0.3)';
                                });
                                chipEl.addEventListener('mouseleave', () => {
                                    chipEl.style.transform = 'scale(1)';
                                    chipEl.style.boxShadow = 'none';
                                });
                            }
                            
                            chipsContainer.appendChild(chipEl);
                        });
                        
                        chipInfo.appendChild(chipsContainer);
                    } else {
                        chipInfo.innerHTML = '<div class="no-chips-small">Ïπ© ÏóÜÏùå</div>';
                    }
                }
            });
        }
    }

    function getChipColor(color) {
        const colors = {
            'blue': '#4285f4',
            'red': '#ea4335',
            'green': '#34a853',
            'yellow': '#fbbc04',
            'purple': '#9c27b0',
            'orange': '#ff9800',
            'white': '#ffffff'
        };
        return colors[color] || '#666';
    }

    function getChipStyle(color) {
        const baseStyle = {
            background: getChipColor(color),
            color: color === 'white' ? '#000' : '#fff',
            border: color === 'white' ? '2px solid #333' : '1px solid rgba(255,255,255,0.2)'
        };
        return baseStyle;
    }

    function getCurrentUsername() {
        return localStorage.getItem('username') || 
               sessionStorage.getItem('username') || 
               window.currentUser || 
               socket.data?.username;
    }

    function updatePlayerTurnIndicators(currentPlayerUsername) {
        // Î™®Îì† ÌîåÎ†àÏù¥Ïñ¥ ÏöîÏÜåÏóêÏÑú ÌÑ¥ ÌëúÏãú Ï†úÍ±∞
        const allPlayerElements = document.querySelectorAll('[data-username]');
        allPlayerElements.forEach(playerEl => {
            playerEl.classList.remove('current-turn');
            const turnIndicator = playerEl.querySelector('.turn-indicator');
            if (turnIndicator) {
                turnIndicator.remove();
            }
        });

        // ÌòÑÏû¨ ÌÑ¥ ÌîåÎ†àÏù¥Ïñ¥ÏóêÍ≤å ÌëúÏãú Ï∂îÍ∞Ä
        const currentPlayerEl = document.querySelector(`[data-username="${currentPlayerUsername}"]`);
        if (currentPlayerEl) {
            currentPlayerEl.classList.add('current-turn');
            
            const turnIndicator = document.createElement('div');
            turnIndicator.className = 'turn-indicator';
            turnIndicator.textContent = 'üëà ÌòÑÏû¨ ÌÑ¥';
            turnIndicator.style.cssText = `
                color: #ffd700;
                font-weight: bold;
                font-size: 12px;
                margin-left: 10px;
                animation: blink 1s infinite;
            `;
            currentPlayerEl.appendChild(turnIndicator);
        }

        console.log('ÌÑ¥ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏:', currentPlayerUsername);
    }

    function updateGamePhase(phase) {
         const phaseNames = {
             'preflop': 'ÌîÑÎ¶¨ÌîåÎûç',
             'flop': 'ÌîåÎûç',
             'turn': 'ÌÑ¥',
             'river': 'Î¶¨Î≤Ñ',
             'showdown': 'ÏáºÎã§Ïö¥',
             'playing': 'Í≤åÏûÑ ÏßÑÌñâ Ï§ë'
         };
         document.getElementById('gamePhase').textContent = `Í≤åÏûÑ Îã®Í≥Ñ: ${phaseNames[phase] || phase}`;
     }
     

    

    
    function showMessage(message) {
        document.getElementById('gameMessage').textContent = message;
    }
    
    function showGameOver(result) {
        const message = `Í≤åÏûÑ Ï¢ÖÎ£å! ${result.winner}ÎãòÏù¥ ÏäπÎ¶¨ÌñàÏäµÎãàÎã§!`;
        document.getElementById('gameMessage').innerHTML = `<span class=\"winner\">${message}</span>`;
        setTimeout(() => { window.location.href = '/lobby.html'; }, 3000);
    }

         let cardsDealRequested = false; // Í∞úÎ≥Ñ ÏÇ¨Ïö©ÏûêÏùò Ïπ¥Îìú Î∞õÍ∏∞ ÏöîÏ≤≠ ÏÉÅÌÉú
     let gameActionMode = 'deal'; // 'deal' ÎòêÎäî 'pass'
     
     // Ïπ¥Îìú Î¨∏Ïñë Î≥ÄÌôò Ìï®Ïàò
     function getSuitSymbol(suit) {
         console.log('getSuitSymbol Ìò∏Ï∂úÎê®, suit:', suit, 'type:', typeof suit);
         
         // suitÍ∞Ä undefinedÎÇò nullÏù∏ Í≤ΩÏö∞ Ï≤òÎ¶¨
         if (!suit) {
             console.warn('suitÍ∞Ä undefined ÎòêÎäî nullÏûÖÎãàÎã§:', suit);
             return '?';
         }
         
         // Î¨∏ÏûêÏó¥Î°ú Î≥ÄÌôò
         const suitStr = String(suit).toLowerCase().trim();
         console.log('Ï†ïÍ∑úÌôîÎêú suit:', suitStr);
         
         const suitMap = {
             'h': '‚ô•', // ÌïòÌä∏
             'd': '‚ô¶', // Îã§Ïù¥ÏïÑÎ™¨Îìú
             'c': '‚ô£', // ÌÅ¥ÎüΩ
             's': '‚ô†'  // Ïä§ÌéòÏù¥Îìú
         };
         
         const result = suitMap[suitStr] || suitStr;
         console.log('Î≥ÄÌôò Í≤∞Í≥º:', result);
         return result;
     }
    
    // ÌÜµÌï©Îêú Í≤åÏûÑ Ïï°ÏÖò Ìï®Ïàò
    // Ïπ¥Îìú Î∞õÍ∏∞ Í∏∞Îä• Ï†úÍ±∞Î°ú Ïù∏Ìï¥ ÎπÑÌôúÏÑ±Ìôî
    function handleGameAction() {
        console.log('handleGameAction Ìï®ÏàòÎäî Ïã§ÏãúÍ∞Ñ Í≤åÏûÑÏúºÎ°ú Ïù∏Ìï¥ ÎπÑÌôúÏÑ±ÌôîÎê®');
        // Ïã§ÏãúÍ∞Ñ Í≤åÏûÑÏóêÏÑúÎäî ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏùå
        return;
    }

    // The Gang 1ÎùºÏö¥Îìú ÏãúÏûë Ìï®Ïàò
    function startRound1() {
        if (!gameState.roomId) {
            showMessage('Î∞© IDÍ∞Ä ÏóÜÏäµÎãàÎã§.');
            return;
        }

        console.log('1ÎùºÏö¥Îìú ÏãúÏûë ÏöîÏ≤≠ Ï†ÑÏÜ°');
        socket.emit('startRound1', { roomId: gameState.roomId });
    }
    
    // Î≤ÑÌäºÏùÑ Ìå®Ïä§ Î™®ÎìúÎ°ú Ï†ÑÌôòÌïòÎäî Ìï®Ïàò
    function switchToPassMode() {
        const btn = document.getElementById('gameActionBtn');
        if (btn) {
            gameActionMode = 'pass';
            btn.textContent = 'Ìå®Ïä§';
            btn.className = 'btn btn-info pass-mode';
            
            // ÏàòÏßëÎêú Ïπ©Ïù¥ ÏûàÎäîÏßÄ ÌôïÏù∏Ìï¥ÏÑú Î≤ÑÌäº ÌôúÏÑ±Ìôî/ÎπÑÌôúÏÑ±Ìôî
            const hasCollectedChips = gameState?.collectedChips && gameState.collectedChips.length > 0;
            btn.disabled = !hasCollectedChips;
            
            console.log('Î≤ÑÌäºÏù¥ Ìå®Ïä§ Î™®ÎìúÎ°ú Ï†ÑÌôòÎê®, Ïπ© Î≥¥Ïú†:', hasCollectedChips);
        }
    }
    
    // Ïπ¥Îìú Î∞õÍ∏∞ Í∏∞Îä• Ï†úÍ±∞Î°ú Ïù∏Ìï¥ ÎπÑÌôúÏÑ±Ìôî
    function resetToDealMode() {
        console.log('resetToDealMode Ìï®ÏàòÎäî Ïã§ÏãúÍ∞Ñ Í≤åÏûÑÏúºÎ°ú Ïù∏Ìï¥ ÎπÑÌôúÏÑ±ÌôîÎê®');
        return; // Ïã§ÏãúÍ∞Ñ Í≤åÏûÑÏóêÏÑúÎäî ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏùå
    }
    
    // Ïπ¥Îìú Î∞õÍ∏∞ Í∏∞Îä• Ï†úÍ±∞Î°ú Ïù∏Ìï¥ ÎπÑÌôúÏÑ±Ìôî
    function dealCards() {
        console.log('dealCards Ìï®ÏàòÎäî Ïã§ÏãúÍ∞Ñ Í≤åÏûÑÏúºÎ°ú Ïù∏Ìï¥ ÎπÑÌôúÏÑ±ÌôîÎê®');
        return; // Ïã§ÏãúÍ∞Ñ Í≤åÏûÑÏóêÏÑúÎäî ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏùå
        
        // Ïù¥ÎØ∏ Ïù¥ ÏÇ¨Ïö©ÏûêÍ∞Ä Ïπ¥ÎìúÎ•º Î∞õÏïòÎäîÏßÄ ÌôïÏù∏ (Í∞úÏù∏Î≥Ñ Ï≤¥ÌÅ¨)
        if (cardsDealRequested) {
            console.log('Ïù¥ÎØ∏ Ïπ¥Îìú Î∞õÍ∏∞ ÏöîÏ≤≠ÏùÑ ÌñàÏäµÎãàÎã§.');
            showMessage('Ïù¥ÎØ∏ Ïπ¥ÎìúÎ•º ÏöîÏ≤≠ÌñàÏäµÎãàÎã§.');
            return;
        }
        
        // Ïù¥ÎØ∏ Ïπ¥ÎìúÎ•º Î≥¥Ïú†ÌïòÍ≥† ÏûàÎäîÏßÄ ÌôïÏù∏
        const myPlayer = gameState?.players?.find(p => p.username === socket.data?.username);
        if (myPlayer && myPlayer.cards && myPlayer.cards.length > 0) {
            console.log('Ïù¥ÎØ∏ Ïπ¥ÎìúÎ•º Î≥¥Ïú†ÌïòÍ≥† ÏûàÏäµÎãàÎã§.');
            showMessage('Ïù¥ÎØ∏ Ïπ¥ÎìúÎ•º Î≥¥Ïú†ÌïòÍ≥† ÏûàÏäµÎãàÎã§.');
            return;
        }
        
        // socket Ïó∞Í≤∞ ÏÉÅÌÉú ÌôïÏù∏
        if (!socket) {
            console.error('SocketÏù¥ Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
            showMessage('Ïó∞Í≤∞ÏùÑ ÌôïÏù∏ Ï§ëÏûÖÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
            return;
        }
        
        let roomId = null;
        
        // 1. gameStateÏóêÏÑú roomId Í∞ÄÏ†∏Ïò§Í∏∞ (Ïö∞ÏÑ†ÏàúÏúÑ 1)
        if (gameState?.roomId) {
            roomId = gameState.roomId;
            console.log('gameStateÏóêÏÑú Í∞ÄÏ†∏Ïò® roomId:', roomId);
        }
        
        // 2. URLÏóêÏÑú roomId Í∞ÄÏ†∏Ïò§Í∏∞ (Ïö∞ÏÑ†ÏàúÏúÑ 2)
        if (!roomId) {
            // urlParamsÎäî Ï†ÑÏó≠ÏóêÏÑú ÏÑ†Ïñ∏Îê®
            roomId = urlParams.get('roomId');
            console.log('URLÏóêÏÑú Í∞ÄÏ†∏Ïò® roomId:', roomId);
        }
        
        // 3. socket.dataÏóêÏÑú roomId Í∞ÄÏ†∏Ïò§Í∏∞ (Ïö∞ÏÑ†ÏàúÏúÑ 3)
        if (!roomId && socket?.data?.roomId) {
            roomId = socket?.data?.roomId;
            console.log('socket.dataÏóêÏÑú Í∞ÄÏ†∏Ïò® roomId:', roomId);
        }
        
        // roomIdÍ∞Ä ÏóÜÏúºÎ©¥ Í∏∞Ï°¥ ÎåÄÍ∏∞ Î∞©Ïóê Ï∞∏Ïó¨ÌïòÍ±∞ÎÇò ÏÉà Î∞© ÏÉùÏÑ± ÏöîÏ≤≠
        if (!roomId) {
            console.log('roomIdÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏñ¥ Í≤åÏûÑ Î∞© Ï∞æÍ∏∞ ÎòêÎäî ÏÉùÏÑ± ÏöîÏ≤≠...');
            socket.emit('findOrCreateGameRoom', {});
            showMessage('Í≤åÏûÑ Î∞©ÏùÑ Ï∞æÎäî Ï§ëÏûÖÎãàÎã§...');
            return;
        }
        
        console.log('ÏµúÏ¢Ö ÏÇ¨Ïö©Ìï† roomId:', roomId);
        
        // Ïù¥ ÏÇ¨Ïö©ÏûêÎßå Ïπ¥Îìú Î∞õÍ∏∞ ÏöîÏ≤≠ ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤Ω (Îã§Î•∏ ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏòÅÌñ• ÏóÜÏùå)
        cardsDealRequested = true;
        
        // Î≥∏Ïù∏Îßå Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäº ÏûÑÏãú ÎπÑÌôúÏÑ±Ìôî
        const dealCardsBtn = document.getElementById('dealCardsBtn');
        // Ïπ¥Îìú Î∞õÍ∏∞ Î≤ÑÌäº Ï†úÍ±∞Îê®
        if (false && dealCardsBtn) {
            dealCardsBtn.disabled = true;
            dealCardsBtn.textContent = 'ÎÇ¥ Ïπ¥Îìú Î∞õÎäî Ï§ë...';
        }
        
        // Ïπ¥Îìú Î∞õÍ∏∞ Ïï†ÎãàÎ©îÏù¥ÏÖò ÏãúÏûë
        showCardDealingAnimation();
        
        socket.emit('requestDealCards', { roomId: roomId });
        showMessage('Ïπ¥ÎìúÎ•º Î∞õÍ≥† ÏûàÏäµÎãàÎã§...');
    }
    
    function pass() {
        console.log('Ìå®Ïä§ Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
        
        // ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Ïπ©ÏùÑ Í∞ÄÏßÄÍ≥† ÏûàÎäîÏßÄ ÌôïÏù∏
        const currentUsername = getCurrentUsername();
        const myPlayer = gameState?.players?.find(p => p.username === currentUsername);
        
        if (!myPlayer?.chips || myPlayer.chips.length === 0) {
            showMessage('Ìå®Ïä§ÌïòÎ†§Î©¥ Î®ºÏ†Ä Ïπ©ÏùÑ ÏàòÏßëÌï¥Ïïº Ìï©ÎãàÎã§.');
            return;
        }
        
        // ÏÑúÎ≤ÑÏóê Ìå®Ïä§ Ïã†Ìò∏ Ï†ÑÏÜ°
        socket.emit('playerPass', { 
            roomId: gameState.roomId,
            username: currentUsername
        });
        
        showMessage('Ìå®Ïä§ÌñàÏäµÎãàÎã§!');
        
        const passBtn = document.getElementById('passBtn');
        if (passBtn) {
            passBtn.disabled = true;
        }
    }
    
         // ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ï∏°ÏóêÏÑú ÏàòÏßëÌïú Ïπ©ÏùÑ Ï∂îÏ†ÅÌïòÎäî Î≥ÄÏàò (Ï†ÑÏó≠ Î≥ÄÏàòÎ°ú ÏÑ§Ï†ï)
     let myCollectedChipIndex = null;
    
    // Ïπ©Í≥º Î≥Ñ ÏÉùÏÑ± Ìï®Ïàò
    function updateCasinoChips(playerCount, collectedChips = []) {
        console.log('updateCasinoChips Ìò∏Ï∂úÎê®:', { playerCount, collectedChips });
        
        const chipsContainer = document.getElementById('casinoChipsContainer');
        const chipsStack = chipsContainer.querySelector('.chips-stack');
        
        if (!chipsContainer || !chipsStack) {
            console.error('Ïπ© Ïª®ÌÖåÏù¥ÎÑàÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå');
            return;
        }
        
        chipsStack.innerHTML = '';
        
        for (let i = 0; i < playerCount; i++) {
            const chip = document.createElement('div');
            chip.className = 'casino-chip';
            chip.dataset.chipIndex = i;
            
            const isCollected = collectedChips.includes(i);
            
                         if (isCollected) {
                 // Í∞ÄÏ†∏Í∞Ñ Ïπ©ÏùÄ ÏôÑÏ†ÑÌûà Ïà®ÍπÄ
                 chip.style.display = 'none';
                 // return Ï†úÍ±∞ - Îã§Ïùå Ïπ©ÏúºÎ°ú Í≥ÑÏÜç ÏßÑÌñâ
             } else {
                // Ïó¨Îü¨ Î∞©Î≤ïÏúºÎ°ú ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê ÌôïÏù∏
                const currentUsername = socket.data?.username || localStorage.getItem('username') || 
                                       sessionStorage.getItem('username') || window.currentUser;
                
                // ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÍ∞Ä Ïπ¥ÎìúÎ•º Î∞õÏïòÎäîÏßÄ ÌôïÏù∏
                const myPlayer = gameState?.players?.find(p => p.username === currentUsername);
                const hasMyCards = myPlayer && myPlayer.cards && myPlayer.cards.length > 0;
                
                // ÏÉàÎ°úÏö¥ handleChipClick ÏÇ¨Ïö©
                if (hasMyCards) {
                    chip.style.cursor = 'pointer';
                    chip.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.3)';
                } else {
                    chip.style.opacity = '0.5';
                    chip.style.cursor = 'not-allowed';
                    chip.style.filter = 'grayscale(50%)';
                }
                
                // Ïπ© ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ - ÏÉàÎ°úÏö¥ Î∞©Ïãù ÏÇ¨Ïö©
                chip.addEventListener('click', function() {
                    if (hasMyCards && gameState.centerChips && gameState.centerChips[i]) {
                        const chipId = gameState.centerChips[i].id;
                        console.log('[OLD CHIPS] Clicking chip:', chipId);
                        handleChipClick(chipId, 'center', null);
                    } else if (!hasMyCards) {
                        showMessage('Ïπ¥ÎìúÎ•º Î®ºÏ†Ä Î∞õÏïÑÏïº Ïπ©ÏùÑ Í∞ÄÏ†∏Ïò¨ Ïàò ÏûàÏäµÎãàÎã§.');
                    }
                });
            }
            
            const starsContainer = document.createElement('div');
            starsContainer.className = 'chip-stars';
            
            // Í∞Å Ïπ©ÎßàÎã§ Îã§Î•∏ Î≥Ñ Í∞úÏàò (Ï≤´ Î≤àÏß∏ Ïπ©ÏùÄ 1Í∞ú, Îëê Î≤àÏß∏ Ïπ©ÏùÄ 2Í∞ú, ...)
            const starCount = i + 1;
            console.log(`Ïπ© ${i + 1}: ${starCount}Í∞úÏùò Î≥Ñ ÏÉùÏÑ±`);
            
            for (let j = 0; j < starCount; j++) {
                const star = document.createElement('div');
                star.className = 'chip-star';
                star.textContent = '‚òÖ';
                star.style.animationDelay = `${j * 0.2}s`;
                
                // Î≥ÑÏù¥ ÎßéÏùÑ Îïå ÌÅ¨Í∏∞ Ï°∞Ï†ï
                if (starCount > 4) {
                    star.style.fontSize = '8px';
                } else if (starCount > 2) {
                    star.style.fontSize = '9px';
                } else {
                    star.style.fontSize = '12px'; // Î≥ÑÏù¥ Ï†ÅÏùÑ ÎïåÎäî Îçî ÌÅ¨Í≤å
                }
                
                starsContainer.appendChild(star);
                console.log(`Î≥Ñ ${j + 1} Ï∂îÍ∞ÄÎê®, ÌÅ¨Í∏∞: ${star.style.fontSize}`);
            }
            
            chip.appendChild(starsContainer);
            chipsStack.appendChild(chip);
        }
    }
    
    // Ïπ© ÏàòÏßë Ìï®Ïàò
    function collectChip(chipElement, chipIndex) {
        console.log('collectChip Ìï®ÏàòÎäî Îçî Ïù¥ÏÉÅ ÏÇ¨Ïö©ÎêòÏßÄ ÏïäÏäµÎãàÎã§. handleChipClickÏùÑ ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî.');
        return;
        console.log('ÌòÑÏû¨ gameState:', gameState);
        console.log('socket.data:', socket?.data);
        console.log('localStorage username:', localStorage.getItem('username'));
        
        // Ïó¨Îü¨ Î∞©Î≤ïÏúºÎ°ú ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê ÌôïÏù∏
        const currentUsername = socket.data?.username || localStorage.getItem('username') || 
                               sessionStorage.getItem('username') || window.currentUser;
        
        console.log('ÌôïÏù∏Îêú ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÎ™Ö:', currentUsername);
        console.log('gameState.players:', gameState?.players);
        
        // Ïπ¥ÎìúÎ•º Î∞õÏïòÎäîÏßÄ ÌôïÏù∏
        const myPlayer = gameState?.players?.find(p => p.username === currentUsername);
        console.log('Ï∞æÏùÄ ÎÇ¥ ÌîåÎ†àÏù¥Ïñ¥:', myPlayer);
        console.log('ÎÇ¥ Ïπ¥Îìú:', myPlayer?.cards);
        
        if (!myPlayer || !myPlayer.cards || myPlayer.cards.length === 0) {
            console.log('Ïπ¥ÎìúÎ•º Î®ºÏ†Ä Î∞õÏïÑÏïº Ïπ©ÏùÑ ÏàòÏßëÌï† Ïàò ÏûàÏäµÎãàÎã§');
            console.log('Ï°∞Í±¥ Ï≤¥ÌÅ¨:', {
                myPlayer: !!myPlayer,
                hasCards: !!(myPlayer?.cards),
                cardsLength: myPlayer?.cards?.length
            });
            showMessage('Ïπ¥ÎìúÎ•º Î®ºÏ†Ä Î∞õÏïÑÏïº Ïπ©ÏùÑ ÏàòÏßëÌï† Ïàò ÏûàÏäµÎãàÎã§!');
            
            // Ïπ©ÏùÑ ÌùîÎì§Ïñ¥ÏÑú ÏãúÍ∞ÅÏ†Å ÌîºÎìúÎ∞± Ï†úÍ≥µ
            chipElement.style.animation = 'chipShake 0.5s ease-in-out';
            setTimeout(() => {
                chipElement.style.animation = '';
            }, 500);
            return;
        }
        
        // Ïù¥ÎØ∏ Ïπ©ÏùÑ ÏàòÏßëÌñàÎäîÏßÄ ÌôïÏù∏ (ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ï∏° Î≥ÄÏàò ÏÇ¨Ïö©)
        if (myCollectedChipIndex !== null) {
            console.log('Ïù¥ÎØ∏ Ïπ©ÏùÑ ÏàòÏßëÌñàÏäµÎãàÎã§');
            showMessage('Ïù¥ÎØ∏ Ïπ©ÏùÑ ÏàòÏßëÌñàÏäµÎãàÎã§! Ìïú Î™ÖÎãπ ÌïòÎÇòÏùò Ïπ©Îßå ÏàòÏßëÌï† Ïàò ÏûàÏäµÎãàÎã§.');
            
            // Ïπ©ÏùÑ ÌùîÎì§Ïñ¥ÏÑú ÏãúÍ∞ÅÏ†Å ÌîºÎìúÎ∞± Ï†úÍ≥µ
            chipElement.style.animation = 'chipShake 0.5s ease-in-out';
            setTimeout(() => {
                chipElement.style.animation = '';
            }, 500);
            return;
        }
        
        if (chipElement.classList.contains('clicked') || chipElement.classList.contains('collected')) {
            console.log('Ïù¥ÎØ∏ ÏàòÏßëÎêú Ïπ©ÏûÖÎãàÎã§');
            return;
        }
        
        chipElement.classList.add('clicked');
        
        // ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ï∏° Î≥ÄÏàò ÏóÖÎç∞Ïù¥Ìä∏
        myCollectedChipIndex = chipIndex;
        
        // ÏÑúÎ≤ÑÏóê Ïπ© Í∞ÄÏ†∏Í∞ÄÍ∏∞ Ïï°ÏÖò Ï†ÑÏÜ° (Ïò¨Î∞îÎ•∏ Ïù¥Î≤§Ìä∏Î™Ö ÏÇ¨Ïö©)
        socket.emit('playerAction', {
            roomId: gameState.roomId,
            action: 'takeFromCenter',
            targetId: gameState.centerChips[chipIndex].id
        });
        
        setTimeout(() => {
            chipElement.classList.remove('clicked');
            chipElement.classList.add('collected');
            // Í∞ÄÏ†∏Í∞Ñ Ïπ©ÏùÄ ÏôÑÏ†ÑÌûà Ïà®ÍπÄ
            chipElement.style.display = 'none';
            chipElement.style.pointerEvents = 'none';
            
            // Ï¶âÏãú UI ÏóÖÎç∞Ïù¥Ìä∏ (ÏÑúÎ≤Ñ ÏùëÎãµÏùÑ Í∏∞Îã§Î¶¨ÏßÄ ÏïäÍ≥†)
            if (gameState && gameState.players) {
                const currentUsername = socket.data?.username || localStorage.getItem('username') || 
                                       sessionStorage.getItem('username') || window.currentUser;
                const myPlayer = gameState.players.find(p => p.username === currentUsername);
                if (myPlayer) {
                    updateMyPlayer(myPlayer);
                }
                
                // ÏöîÏïΩÏ∞ΩÎèÑ Ï¶âÏãú ÏóÖÎç∞Ïù¥Ìä∏ÌïòÏó¨ Ïπ© ÏàòÏßë ÏÉÅÌÉú Î∞òÏòÅ
                updatePlayers(gameState.players);
                
                // Í≤åÏûÑ ÏÉÅÌÉúÎèÑ ÏûÑÏãúÎ°ú ÏóÖÎç∞Ïù¥Ìä∏ (ÏÑúÎ≤Ñ ÏùëÎãµ Ï†ÑÍπåÏßÄ)
                if (!gameState.collectedChips) {
                    gameState.collectedChips = [];
                }
                if (!gameState.collectedChips.includes(chipIndex)) {
                    gameState.collectedChips.push(chipIndex);
                }
                
                console.log('Ïπ© ÏàòÏßë ÌõÑ Ï¶âÏãú UI ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å, collectedChips:', gameState.collectedChips);
            }
        }, 500);
        
        showMessage(`Ïπ© ${chipIndex + 1}ÏùÑ ÏàòÏßëÌñàÏäµÎãàÎã§!`);
    }
    
    // Ïπ¥Îìú Î∞õÍ∏∞ Ïï†ÎãàÎ©îÏù¥ÏÖò
    function showCardDealingAnimation() {
        const existingAnimation = document.querySelector('.card-dealing-animation');
        if (existingAnimation) {
            existingAnimation.remove();
        }
        
        const animationContainer = document.createElement('div');
        animationContainer.className = 'card-dealing-animation';
        animationContainer.style.cssText = `
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
                gap: 10px;
        `;
        
        for (let i = 0; i < 2; i++) {
            const card = document.createElement('div');
            card.className = 'dealing-card';
            card.style.cssText = `
                width: 60px;
                height: 90px;
                background: linear-gradient(45deg, #2c3e50, #34495e);
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                transform: translateY(-100px);
                opacity: 0;
                transition: all 0.6s ease-out;
                border: 2px solid #fff;
            `;
            
            card.innerHTML = `
                <div style="
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    font-size: 24px;
                    color: #fff;
                    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
                ">‚ô†</div>
            `;
            
            animationContainer.appendChild(card);
        }
        
        document.body.appendChild(animationContainer);
        
        setTimeout(() => {
            const cards = animationContainer.querySelectorAll('.dealing-card');
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.style.transform = 'translateY(0)';
                    card.style.opacity = '1';
                }, index * 200);
            });
        }, 100);
        
        setTimeout(() => {
            if (animationContainer.parentNode) {
                animationContainer.remove();
            }
        }, 3000);
    }
    
    window.addEventListener('load', async () => {
        // Î≤ÑÏ†Ñ Ï†ïÎ≥¥ Ï∂úÎ†• (Ï∫êÏãú ÌôïÏù∏Ïö©)
        console.log('=== Í≤åÏûÑ ÌéòÏù¥ÏßÄ v2.1 Î°úÎìúÎê® ===');
        console.log('Current URL:', window.location.href);
        console.log('URL Params:', window.location.search);
        
        console.log('Room ID from URL:', urlParams.get('roomId'));
        console.log('üîß existingCollectedChips ÏóêÎü¨ ÏàòÏ†ïÎê®');
        console.log('ÏàòÏ†ïÎêú handleChipClick Ìï®Ïàò:', typeof handleChipClick);
        console.log('Ïπ© ÏÉâÏÉÅ Ï†ÅÏö© Ïó¨Î∂Ä ÌôïÏù∏ Ï§ë...');
        
        // Ï¥àÍ∏∞ ÌîåÎ†àÏù¥Ïñ¥ ÏàòÎäî Ïã§Ï†ú Í≤åÏûÑ ÏÉÅÌÉúÏóêÏÑú Í∞ÄÏ†∏Ïò¥
        console.log('ÌîåÎ†àÏù¥Ïñ¥ ÏàòÎäî Í≤åÏûÑ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ÏóêÏÑú ÏÑ§Ï†ïÎê©ÎãàÎã§.');
        
        
        // Î°úÎπÑÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
        const backToLobbyBtn = document.getElementById('backToLobbyBtn');
        if (backToLobbyBtn) {
            backToLobbyBtn.addEventListener('click', () => {
                console.log('Î°úÎπÑ Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
                if (confirm('Í≤åÏûÑÏùÑ Ï¢ÖÎ£åÌïòÍ≥† Î°úÎπÑÎ°ú ÎèåÏïÑÍ∞ÄÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    // ÌòÑÏû¨ Î∞©ÏóêÏÑú ÎÇòÍ∞ÄÍ∏∞ (Ïó¨Îü¨ Î∞©Î≤ïÏúºÎ°ú roomId ÌôïÏù∏)
                    // urlParamsÎäî Ï†ÑÏó≠ÏóêÏÑú ÏÑ†Ïñ∏Îê®
                    const urlRoomId = urlParams.get('roomId');
                    const currentRoomId = gameState?.roomId || urlRoomId;
                    
                    console.log('Î°úÎπÑÎ°ú Ïù¥Îèô - gameState.roomId:', gameState?.roomId, 'urlRoomId:', urlRoomId, 'currentRoomId:', currentRoomId);
                    
                    if (currentRoomId) {
                        socket.emit('leaveRoom', { roomId: currentRoomId });
                    }
                    
                    // Î°úÎπÑÎ°ú Ïù¥Îèô
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 100);
                }
            });
            
            // Ï∂îÍ∞ÄÏ†ÅÏù∏ onclick Ìï∏Îì§Îü¨ (Î∞±ÏóÖÏö©)
            backToLobbyBtn.onclick = () => {
                console.log('Î°úÎπÑ Î≤ÑÌäº onclick Ìï∏Îì§Îü¨ Ìò∏Ï∂úÎê®');
            };
        }
        
        // Ï¥àÍ∏∞ Í≤åÏûÑ ÏÉÅÌÉú ÏÑ§Ï†ï
        gameState.phase = 'playing';
        updateControls();
        console.log('Ï¥àÍ∏∞ Í≤åÏûÑ ÏÉÅÌÉú ÏÑ§Ï†ï ÏôÑÎ£å');
        
        // URLÏóêÏÑú roomId Í∞ÄÏ†∏ÏôÄÏÑú gameStateÏóê ÏÑ§Ï†ï
        // urlParamsÎäî Ï†ÑÏó≠ÏóêÏÑú ÏÑ†Ïñ∏Îê®
        const roomId = urlParams.get('roomId');
        if (roomId) {
            gameState.roomId = roomId;
            console.log('ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú roomId ÏÑ§Ï†ï:', roomId);
        }
        
        connectSocket();
        
        // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
        isAdmin = await checkAdminStatus();
        console.log('Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏ Í≤∞Í≥º:', isAdmin);
        
        // Í≤åÏûÑ ÏãúÏûëÏùÄ registerUserSuccess Ïù¥Î≤§Ìä∏ÏóêÏÑú Ï≤òÎ¶¨Îê®
        console.log('ÌéòÏù¥ÏßÄ Î°úÎìú ÏôÑÎ£å, ÏÇ¨Ïö©Ïûê Îì±Î°ù ÎåÄÍ∏∞ Ï§ë...');
        
        // Í≤åÏûÑ ÏûêÎèô ÏãúÏûëÏùÄ registerUserSuccess Ïù¥Î≤§Ìä∏ÏóêÏÑú Ï≤òÎ¶¨Îê®
        console.log('ÏÇ¨Ïö©Ïûê Îì±Î°ù ÏôÑÎ£å ÎåÄÍ∏∞ Ï§ë... (registerUserSuccess Ïù¥Î≤§Ìä∏ÏóêÏÑú Í≤åÏûÑ ÏãúÏûë)');
        
        // Ï¥àÍ∏∞ Ïπ© ÌëúÏãú (Í∏∞Î≥∏Í∞í 2Í∞ú, ÏàòÏßëÎêú Ïπ© ÏóÜÏùå)
        console.log('ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞ Ïπ© ÌëúÏãú');
        // updateCasinoChips(2, []); // ÎπÑÌôúÏÑ±Ìôî: updateCenterChips ÏÇ¨Ïö©
        
        // Ïπ© ÏÉâÏÉÅ ÌôïÏù∏
        setTimeout(() => {
            const chipElements = document.querySelectorAll('.casino-chip');
            if (chipElements.length > 0) {
                const chipStyle = window.getComputedStyle(chipElements[0]);
                console.log('Ïπ© Î∞∞Í≤ΩÏÉâ:', chipStyle.background);
                console.log('Ïπ© ÏöîÏÜå Í∞úÏàò:', chipElements.length);
            } else {
                console.log('Ïπ© ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå');
            }
        }, 1000);
    });
    </script>
</body>
</html> 