<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì‹œê°„ ë°ì´í„° ì €ì¥ í…ŒìŠ¤íŠ¸</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/game-client-realtime.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2, h3, h4 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .game-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .card-container {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        .card {
            width: 60px;
            height: 80px;
            border: 2px solid #333;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: white;
            font-weight: bold;
        }
        .card.red { border-color: #dc3545; }
        .card.black { border-color: #343a40; }
        .card-rank { font-size: 18px; margin-bottom: 5px; }
        .card-suit { font-size: 24px; }
        .player-item {
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }
        .my-player {
            background: #e3f2fd;
            border-color: #2196f3;
        }
        .player-name { font-weight: bold; margin-right: 15px; }
        .player-chips { color: #28a745; margin-right: 15px; }
        .player-action { color: #6c757d; font-style: italic; }
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .betting-controls {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        .pot-amount {
            font-size: 24px;
            font-weight: bold;
            color: #28a745;
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .game-results {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #28a745;
        }
        .player-result {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
        }
        .winner {
            background: #fff3cd;
            border: 2px solid #ffc107;
        }
        .positive { color: #28a745; }
        .negative { color: #dc3545; }
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-online { background-color: #28a745; }
        .status-offline { background-color: #dc3545; }
    </style>
</head>
<body>
    <h1>ğŸ® ì‹¤ì‹œê°„ ë°ì´í„° ì €ì¥ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="container">
        <h2>ğŸ“Š ì—°ê²° ìƒíƒœ</h2>
        <div id="connectionStatus">
            <p><span class="status-indicator status-offline"></span>ì†Œì¼“ ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...</p>
            <p>í˜„ì¬ ì‚¬ìš©ì: <span id="currentUser">ë¡œê·¸ì¸ í•„ìš”</span></p>
            <p>ë°© ID: <span id="currentRoom">ì—†ìŒ</span></p>
        </div>
    </div>

    <!-- ê²Œì„ ì„¤ì • -->
    <div class="game-section">
        <h2>âš™ï¸ ê²Œì„ ì„¤ì •</h2>
        <div class="form-group">
            <label>ì‚¬ìš©ìëª…:</label>
            <input type="text" id="username" placeholder="ì‚¬ìš©ìëª… ì…ë ¥" value="í…ŒìŠ¤íŠ¸ìœ ì €">
        </div>
        <div class="form-group">
            <label>ë°© ID:</label>
            <input type="text" id="roomId" placeholder="ë°© ID ì…ë ¥" value="test_room">
        </div>
        <button onclick="connectToGame()" class="btn btn-primary">ê²Œì„ ì—°ê²°</button>
        <button onclick="disconnectFromGame()" class="btn btn-secondary">ì—°ê²° í•´ì œ</button>
    </div>

    <!-- ê²Œì„ ì •ë³´ -->
    <div class="game-section">
        <h2>ğŸ¯ ê²Œì„ ì •ë³´</h2>
        <div id="gameInfo">
            <p>ê²Œì„ì— ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
        </div>
    </div>

    <!-- í”Œë ˆì´ì–´ ëª©ë¡ -->
    <div class="game-section">
        <h2>ğŸ‘¥ í”Œë ˆì´ì–´ ëª©ë¡</h2>
        <div id="playerList">
            <p>í”Œë ˆì´ì–´ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
    </div>

    <!-- ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ -->
    <div class="game-section">
        <h2>ğŸƒ ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ</h2>
        <div id="communityCards">
            <p>ì•„ì§ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
    </div>

    <!-- ë‚´ ì¹´ë“œ -->
    <div class="game-section">
        <h2>ğŸ´ ë‚´ ì¹´ë“œ</h2>
        <div id="myCards">
            <p>ì¹´ë“œë¥¼ ë°›ì•„ì£¼ì„¸ìš”.</p>
        </div>
    </div>

    <!-- íŒŸ -->
    <div class="game-section">
        <h2>ğŸ’° íŒŸ</h2>
        <div id="pot">
            <p>0 ì¹©</p>
        </div>
    </div>

    <!-- ê²Œì„ ì»¨íŠ¸ë¡¤ -->
    <div class="game-section">
        <h2>ğŸ® ê²Œì„ ì»¨íŠ¸ë¡¤</h2>
        <div class="action-buttons">
            <button onclick="startGame()" class="btn btn-primary">ì¹´ë“œ ë°›ê¸°</button>
            <button onclick="proceedToNextRound()" class="btn btn-warning">ë‹¤ìŒ ë¼ìš´ë“œ</button>
            <button onclick="endGame()" class="btn btn-danger">ê²Œì„ ì¢…ë£Œ</button>
        </div>
        <div id="actionButtons">
            <p>ê²Œì„ì„ ì‹œì‘í•´ì£¼ì„¸ìš”.</p>
        </div>
    </div>

    <!-- ê²Œì„ ê²°ê³¼ -->
    <div class="game-section">
        <h2>ğŸ† ê²Œì„ ê²°ê³¼</h2>
        <div id="gameResults">
            <p>ì•„ì§ ê²Œì„ì´ ì¢…ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
        </div>
    </div>

    <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
    <div id="errorMessage"></div>

    <script>
        let socket = null;
        let gameClient = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            checkConnectionStatus();
        };

        // ì—°ê²° ìƒíƒœ í™•ì¸
        function checkConnectionStatus() {
            const statusElement = document.getElementById('connectionStatus');
            if (socket && socket.connected) {
                statusElement.innerHTML = `
                    <p><span class="status-indicator status-online"></span>ì†Œì¼“ ì—°ê²°ë¨</p>
                    <p>í˜„ì¬ ì‚¬ìš©ì: ${document.getElementById('username').value}</p>
                    <p>ë°© ID: ${document.getElementById('roomId').value}</p>
                `;
            } else {
                statusElement.innerHTML = `
                    <p><span class="status-indicator status-offline"></span>ì†Œì¼“ ì—°ê²° ì•ˆë¨</p>
                    <p>í˜„ì¬ ì‚¬ìš©ì: ë¡œê·¸ì¸ í•„ìš”</p>
                    <p>ë°© ID: ì—†ìŒ</p>
                `;
            }
        }

        // ê²Œì„ì— ì—°ê²°
        function connectToGame() {
            const username = document.getElementById('username').value;
            const roomId = document.getElementById('roomId').value;

            if (!username || !roomId) {
                showError('ì‚¬ìš©ìëª…ê³¼ ë°© IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                // Socket.io ì—°ê²°
                socket = io();
                
                // ì—°ê²° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                socket.on('connect', () => {
                    console.log('[Socket] ì—°ê²°ë¨:', socket.id);
                    
                    // ê²Œì„ í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
                    gameClient = initializeGame(socket, roomId, username);
                    
                    // ë°©ì— ì°¸ê°€
                    socket.emit('joinRoom', { roomId: roomId, username: username });
                    
                    checkConnectionStatus();
                    showError('ê²Œì„ì— ì„±ê³µì ìœ¼ë¡œ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.');
                });

                socket.on('disconnect', () => {
                    console.log('[Socket] ì—°ê²° í•´ì œë¨');
                    checkConnectionStatus();
                    showError('ê²Œì„ ì—°ê²°ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                });

                socket.on('connect_error', (error) => {
                    console.error('[Socket] ì—°ê²° ì˜¤ë¥˜:', error);
                    showError('ê²Œì„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                });

            } catch (error) {
                console.error('[Game] ê²Œì„ ì—°ê²° ì‹¤íŒ¨:', error);
                showError('ê²Œì„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ê²Œì„ ì—°ê²° í•´ì œ
        function disconnectFromGame() {
            if (socket) {
                socket.disconnect();
                socket = null;
            }
            if (gameClient) {
                gameClient = null;
            }
            checkConnectionStatus();
            showError('ê²Œì„ ì—°ê²°ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ê²Œì„ ì‹œì‘
        function startGame() {
            if (gameClient) {
                gameClient.requestCards();
            } else {
                showError('ë¨¼ì € ê²Œì„ì— ì—°ê²°í•´ì£¼ì„¸ìš”.');
            }
        }

        // ë‹¤ìŒ ë¼ìš´ë“œ ì§„í–‰
        function proceedToNextRound() {
            if (gameClient) {
                gameClient.nextRound(1, 'preflop', []);
            } else {
                showError('ë¨¼ì € ê²Œì„ì— ì—°ê²°í•´ì£¼ì„¸ìš”.');
            }
        }

        // ê²Œì„ ì¢…ë£Œ
        function endGame() {
            if (gameClient) {
                const gameResult = {
                    players: [
                        {
                            username: document.getElementById('username').value,
                            initialChips: 1000,
                            finalChips: 1200,
                            finalRank: 1
                        }
                    ]
                };
                gameClient.endGame(gameResult);
            } else {
                showError('ë¨¼ì € ê²Œì„ì— ì—°ê²°í•´ì£¼ì„¸ìš”.');
            }
        }

        // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            if (errorElement) {
                errorElement.innerHTML = `<div class="error-message">${message}</div>`;
                setTimeout(() => {
                    errorElement.innerHTML = '';
                }, 5000);
            }
        }

        // í¼ ê·¸ë£¹ ìŠ¤íƒ€ì¼
        document.querySelectorAll('.form-group').forEach(group => {
            group.style.marginBottom = '15px';
        });

        document.querySelectorAll('.form-group label').forEach(label => {
            label.style.display = 'block';
            label.style.marginBottom = '5px';
            label.style.fontWeight = 'bold';
            label.style.color = '#555';
        });

        document.querySelectorAll('.form-group input').forEach(input => {
            input.style.width = '100%';
            input.style.padding = '8px';
            input.style.border = '1px solid #ddd';
            input.style.borderRadius = '4px';
            input.style.boxSizing = 'border-box';
        });
    </script>
</body>
</html>
